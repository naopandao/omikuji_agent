# AI ãŠã¿ãã˜ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ ğŸ´âœ¨

AWS Bedrock AgentCore Runtime ã‚’ä½¿ã£ãŸAIå ã„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

## æ¦‚è¦

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãŠã¿ãã˜ã‚’å¼•ãã¨ã€AIãŒé‹å‹¢ã‚’å ã„ã€ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªã‚®ãƒ£ãƒ«èªé¢¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ãƒ©ãƒƒã‚­ãƒ¼ã‚¢ã‚¤ãƒ†ãƒ ã‚„ã‚¹ãƒãƒƒãƒˆã‚’ãŠçŸ¥ã‚‰ã›ã—ã¾ã™ã€‚Memoryæ©Ÿèƒ½ã«ã‚ˆã‚Šéå»ã®å±¥æ­´ã‚’è¨˜æ†¶ã—ã€ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºã•ã‚ŒãŸã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’æä¾›ã—ã¾ã™ã€‚

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ç›®æ¨™æ§‹æˆ: Amplify Gen2 + AgentCore Runtime + S3 Vector Storeï¼ˆRAGï¼‰

Amplify Gen2ã‹ã‚‰**AgentCore Runtimeï¼ˆECRï¼‰**ã‚’ç›´æ¥å‘¼ã³å‡ºã—ã€ãŠã¿ãã˜å±¥æ­´ã‚’**S3 Vector Store**ã«ä¿å­˜ã—ã¦RAGæ¤œç´¢ã‚’è¡Œã„ã¾ã™ã€‚**Lambdaä¸è¦**ã§ã‚·ãƒ³ãƒ—ãƒ«ã‹ã¤é«˜é€Ÿãªæ§‹æˆã§ã™ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              AWS Cloud                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                          ap-northeast-1                                 â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚  â”‚                    Amplify Gen2                                  â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  Next.js    â”‚    â”‚  AppSync    â”‚                             â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  Frontend   â”‚â”€â”€â”€â–¶â”‚  GraphQL    â”‚â”€â”€â”€â”€â”€â”€â”€â”                     â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â”‚             â”‚    â”‚  API        â”‚       â”‚ Custom Resolver     â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚                     â”‚   â”‚ â”‚
â”‚  â”‚  â”‚        â”‚                   â”‚               â”‚                     â”‚   â”‚ â”‚
â”‚  â”‚  â”‚        â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”       â”‚                     â”‚   â”‚ â”‚
â”‚  â”‚  â”‚        â”‚           â”‚   Cognito     â”‚       â”‚                     â”‚   â”‚ â”‚
â”‚  â”‚  â”‚        â”‚           â”‚  User Pool    â”‚       â”‚                     â”‚   â”‚ â”‚
â”‚  â”‚  â”‚        â”‚           â”‚  (èªè¨¼)       â”‚       â”‚                     â”‚   â”‚ â”‚
â”‚  â”‚  â”‚        â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚                     â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜                     â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                                 â”‚                       â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                                 â–¼                       â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                  â”‚   Bedrock AgentCore Runtime        â”‚ â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                  â”‚   â”‚  omikuji_agent.py            â”‚ â”‚ â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                  â”‚   â”‚  (ECR Container)             â”‚ â”‚ â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                  â”‚   â”‚  Python 3.10-3.13            â”‚ â”‚ â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                  â”‚              â”‚                     â”‚ â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚ â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                  â”‚   â”‚                      â”‚         â”‚ â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                  â”‚   â–¼                      â–¼         â”‚ â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                  â”‚ â”‚  Memory    â”‚ â”‚ Code Interpreterâ”‚ â”‚ â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                  â”‚ â”‚ (ä¼šè©±å±¥æ­´) â”‚ â”‚ (çµ±è¨ˆãƒ»ã‚°ãƒ©ãƒ•)  â”‚ â”‚ â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                  â”‚              â”‚                     â”‚ â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                  â”‚              â–¼                     â”‚ â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚ â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                  â”‚   â”‚   Bedrock Claude     â”‚         â”‚ â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                  â”‚   â”‚   (Haiku 3 / Sonnet) â”‚         â”‚ â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                  â”‚              â”‚                     â”‚ â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                  â”‚              â–¼                     â”‚ â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚ â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                  â”‚   â”‚   RAG Tool           â”‚         â”‚ â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                  â”‚   â”‚   (S3 Vector Search) â”‚         â”‚ â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                                 â”‚                       â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                                 â–¼                       â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                  â”‚   S3 Vector Store                  â”‚ â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                  â”‚   - ãŠã¿ãã˜å±¥æ­´ï¼ˆEmbeddingsï¼‰     â”‚ â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                  â”‚   - ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢             â”‚ â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                  â”‚   - ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºå¿œç­”             â”‚ â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚ â”‚
â”‚  â”‚           â”‚                                                         â”‚   â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  CloudWatch    â”‚                         â”‚  CloudWatch GenAI   â”‚ â”‚   â”‚ â”‚
â”‚  â”‚  â”‚  Logs          â”‚                         â”‚  Dashboard          â”‚ â”‚   â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚ â”‚
â”‚  â”‚                                                                       â”‚   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Client   â”‚
        â”‚  (Browser) â”‚
        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
              â”‚ HTTPS
              â–¼
```

### æ§‹æˆã®æ¯”è¼ƒ

| æ§‹æˆ | Lambda | DynamoDB | ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢ | ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢ | è¤‡é›‘ã• |
|------|--------|----------|-------------|-------------------|--------|
| **Amplify Gen2 + AgentCore + S3 Vectorï¼ˆç›®æ¨™ï¼‰** | âŒ ä¸è¦ | âŒ ä¸è¦ | S3 Vector Store | âœ… å¯èƒ½ | ğŸŸ¢ ã‚·ãƒ³ãƒ—ãƒ« |
| Next.js API Route + AgentCoreï¼ˆç¾è¡Œï¼‰ | âŒ ä¸è¦ | âŒ æœªä½¿ç”¨ | ãªã— | âŒ ä¸å¯ | ğŸŸ¡ æš«å®š |
| AppSync + DynamoDBï¼ˆéæ¨å¥¨ï¼‰ | âŒ ä¸è¦ | âœ… å¿…è¦ | DynamoDB | âŒ ä¸å¯ | ğŸ”´ ä¸é©åˆ‡ |
| Lambda çµŒç”±ï¼ˆå¾“æ¥ï¼‰ | âœ… å¿…è¦ | âœ… å¿…è¦ | DynamoDB | âŒ ä¸å¯ | ğŸ”´ è¤‡é›‘ |

**é‡è¦:** ãŠã¿ãã˜å±¥æ­´ã¯ã€Œéå»ã«ä¼¼ãŸé‹å‹¢ã®æ™‚ã©ã†ã ã£ãŸï¼Ÿã€ã¨ã„ã†ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢ãŒå¿…è¦ãªãŸã‚ã€**S3 Vector Store + RAG**ãŒæœ€é©ã§ã™ã€‚DynamoDBã§ã®å˜ç´”ãªCRUDæ“ä½œã¯ä¸è¦ã§ã™ã€‚

## AgentCore Runtime ã¨ã¯

**Amazon Bedrock AgentCore Runtime** ã¯ã€AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ»å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ãƒ•ãƒ«ãƒãƒãƒ¼ã‚¸ãƒ‰ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ç’°å¢ƒã§ã™ã€‚

### ä¸»ãªç‰¹å¾´

- **ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹**: ã‚¤ãƒ³ãƒ•ãƒ©ç®¡ç†ä¸è¦ã€ã‚³ãƒ³ãƒ†ãƒŠã‚’ç›´æ¥ãƒ›ã‚¹ãƒˆ
- **ä½ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·**: ã‚³ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ¼ãƒˆãªã—
- **ç›´æ¥HTTPå‘¼ã³å‡ºã—**: `InvokeAgentRuntime` APIã§ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ç›´æ¥å©ã‘ã‚‹
- **ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ†é›¢**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã«ãƒã‚¤ã‚¯ãƒ­VMã§å®Œå…¨åˆ†é›¢
- **æœ€å¤§8æ™‚é–“å®Ÿè¡Œ**: é•·æ™‚é–“ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå‡¦ç†ã«å¯¾å¿œ
- **100MBãƒšã‚¤ãƒ­ãƒ¼ãƒ‰**: ãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆãƒ†ã‚­ã‚¹ãƒˆãƒ»ç”»åƒãƒ»éŸ³å£°ï¼‰å¯¾å¿œ
- **ãƒãƒ«ãƒãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯å¯¾å¿œ**: Strands, LangChain, LangGraph, CrewAI ãªã©

### ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•

AgentCore Runtime ã«ã¯2ã¤ã®ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•ãŒã‚ã‚Šã¾ã™ï¼š

#### 1. Direct Code Deploymentï¼ˆæ¨å¥¨ãƒ»è»½é‡ï¼‰

```bash
# AgentCore Starter Toolkit ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install bedrock-agentcore-starter-toolkit

# ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’è¨­å®š
agentcore configure --entrypoint omikuji_agent.py --name omikuji-agent

# ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆzipãƒ•ã‚¡ã‚¤ãƒ«ã‚’S3ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼‰
agentcore deploy
```

- Dockerãƒ•ã‚¡ã‚¤ãƒ«ä¸è¦
- zipãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆæœ€å¤§250MBï¼‰ã‚’S3ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- Python 3.10-3.13 å¯¾å¿œ
- è¿…é€Ÿãªã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å‘ã

#### 2. Container Deploymentï¼ˆECRï¼‰

```bash
# Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ï¼ˆARM64ï¼‰
docker build --platform linux/arm64 -t omikuji-agent .

# ECRã«ãƒ—ãƒƒã‚·ãƒ¥
aws ecr get-login-password | docker login --username AWS --password-stdin $ECR_URI
docker tag omikuji-agent:latest $ECR_URI/omikuji-agent:latest
docker push $ECR_URI/omikuji-agent:latest

# AgentCore Runtimeã«ãƒ‡ãƒ—ãƒ­ã‚¤
agentcore configure --entrypoint main.py --name omikuji-agent --deployment-type container
agentcore deploy
```

- ã‚«ã‚¹ã‚¿ãƒ ä¾å­˜é–¢ä¿‚ãŒå¿…è¦ãªå ´åˆ
- æœ€å¤§2GBã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚µã‚¤ã‚º
- å¤šè¨€èªå¯¾å¿œï¼ˆPythonä»¥å¤–ã‚‚å¯ï¼‰

### InvokeAgentRuntime API

ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã€ä»¥ä¸‹ã®APIã§ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ç›´æ¥å‘¼ã³å‡ºã›ã¾ã™ï¼ˆLambdaä¸è¦ï¼‰ï¼š

```
POST /runtimes/{agentRuntimeArn}/invocations

Headers:
  Content-Type: application/json
  X-Amzn-Bedrock-AgentCore-Runtime-Session-Id: {sessionId}

Body:
  {
    "prompt": "ãŠã¿ãã˜ã‚’å¼•ããŸã„ï¼"
  }
```

**Python (boto3) ã§ã®å‘¼ã³å‡ºã—ä¾‹ï¼š**

```python
import boto3
import json

client = boto3.client('bedrock-agentcore', region_name='ap-northeast-1')

response = client.invoke_agent_runtime(
    agentRuntimeArn='arn:aws:bedrock-agentcore:ap-northeast-1:123456789012:runtime/omikuji-agent',
    runtimeSessionId='user-session-123',
    payload=json.dumps({'prompt': 'ãŠã¿ãã˜ã‚’å¼•ã„ã¦ï¼'}).encode('utf-8')
)

# ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¬ã‚¹ãƒãƒ³ã‚¹èª­ã¿å–ã‚Š
for chunk in response['response']:
    print(chunk.decode('utf-8'))
```

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆAgentCore Runtimeï¼‰
| æŠ€è¡“ | ç”¨é€” | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ |
|------|------|-----------|
| Amazon Bedrock AgentCore Runtime | AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆåŸºç›¤ | 2025.12 |
| AWS AppSync | GraphQL API | Amplify Gen2 |
| Strands Agents SDK | ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ | Latest |
| AWS Bedrock Claude | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ | Haiku 3 / Sonnet 4 |
| AgentCore Memory | ä¼šè©±å±¥æ­´ä¿æŒ | Built-in |
| S3 Vector Store | ãŠã¿ãã˜å±¥æ­´ï¼ˆRAGï¼‰ | AWS S3 + Embeddings |
| Python | ãƒ©ãƒ³ã‚¿ã‚¤ãƒ  | 3.10-3.13 |

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
| æŠ€è¡“ | ç”¨é€” | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ |
|------|------|-----------|
| Next.js | ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ | 14.x |
| AWS Amplify Gen2 | ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ãƒ»Backend | Latest |
| AWS Amplify Data | GraphQLã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ | Gen2 |
| TailwindCSS | ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° | 3.x |
| TypeScript | å‹å®‰å…¨ | 5.x |

### ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£
| æŠ€è¡“ | ç”¨é€” |
|------|------|
| AWS Amplify Gen2 | ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ãƒ»Backendãƒ»CI/CD |
| Amazon Cognito | èªè¨¼ |
| Amazon S3 | Vector Storeï¼ˆEmbeddings + ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼‰ |
| Amazon ECR | ã‚³ãƒ³ãƒ†ãƒŠãƒ¬ã‚¸ã‚¹ãƒˆãƒª |
| CloudWatch Logs | ãƒ­ã‚°ç›£è¦– |
| CloudWatch GenAI Dashboard | ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆç›£è¦– |

**æ³¨æ„:** ~~DynamoDB ã¯ä¸è¦~~ï¼ˆã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢ãŒã§ããªã„ãŸã‚ï¼‰

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```
omikuji-agent/
â”œâ”€â”€ README.md                     # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ requirements.txt              # Pythonä¾å­˜é–¢ä¿‚
â”œâ”€â”€ amplify.yml                   # Amplifyãƒ“ãƒ«ãƒ‰è¨­å®š
â”œâ”€â”€ ARCHITECTURE_AUDIT_REPORT.md  # ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ç›£æŸ»ãƒ¬ãƒãƒ¼ãƒˆ
â”‚
â”œâ”€â”€ omikuji_agent.py              # AgentCore Runtimeç”¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ â­
â”œâ”€â”€ my_agent.py                   # AgentCore Runtimeç”¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆåˆ¥ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰
â”‚
â””â”€â”€ nextjs-app/                   # Amplify Gen2 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
    â”œâ”€â”€ amplify/                  # âš ï¸ æœªä½œæˆï¼ˆTODOï¼‰
    â”‚   â”œâ”€â”€ backend.ts            # Backendå®šç¾© + AgentCoreé€£æº
    â”‚   â”œâ”€â”€ auth/                 # Cognitoèªè¨¼
    â”‚   â”‚   â””â”€â”€ resource.ts
    â”‚   â”œâ”€â”€ data/                 # AppSync Custom Resolver
    â”‚   â”‚   â””â”€â”€ resource.ts       # Schemaå®šç¾©
    â”‚   â””â”€â”€ storage/              # S3 Vector Store
    â”‚       â””â”€â”€ resource.ts
    â”œâ”€â”€ app/                      # Next.js App Router
    â”‚   â”œâ”€â”€ api/                  # API Routesï¼ˆæš«å®šå®Ÿè£…ï¼‰
    â”‚   â”‚   â””â”€â”€ omikuji/
    â”‚   â”‚       â””â”€â”€ route.ts      # AgentCoreç›´æ¥å‘¼ã³å‡ºã—
    â”‚   â”œâ”€â”€ page.tsx              # ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸
    â”‚   â”œâ”€â”€ layout.tsx            # ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
    â”‚   â””â”€â”€ globals.css           # ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚¿ã‚¤ãƒ«
    â”œâ”€â”€ lib/
    â”‚   â””â”€â”€ api.ts                # APIå‘¼ã³å‡ºã—ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
    â”œâ”€â”€ next.config.js
    â”œâ”€â”€ package.json
    â”œâ”€â”€ tsconfig.json
    â””â”€â”€ tailwind.config.ts
```

**ç¾çŠ¶:** 
- `nextjs-app/amplify/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒæœªä½œæˆã®ãŸã‚ã€Amplify Gen2 BackendãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“
- ç¾åœ¨ã¯Next.js API Routeã§æš«å®šçš„ã«AgentCoreã‚’å‘¼ã³å‡ºã—ã¦ã„ã¾ã™
- ~~Lambdaé–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«ã¯å‰Šé™¤æ¸ˆã¿~~ï¼ˆLambdaä¸è¦ã®ãŸã‚ï¼‰

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### å‰ææ¡ä»¶
- AWS ã‚¢ã‚«ã‚¦ãƒ³ãƒˆï¼ˆBedrock Claude ãƒ¢ãƒ‡ãƒ«ã‚¢ã‚¯ã‚»ã‚¹æœ‰åŠ¹åŒ–æ¸ˆã¿ï¼‰
- AWS CLI v2 è¨­å®šæ¸ˆã¿
- Node.js 18+
- Python 3.10+

### Step 1: AgentCore Runtime ã«ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install bedrock-agentcore strands-agents bedrock-agentcore-starter-toolkit

# ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè¨­å®š
agentcore configure --entrypoint omikuji_agent.py --name omikuji-agent

# ãƒ‡ãƒ—ãƒ­ã‚¤
agentcore deploy
```

ãƒ‡ãƒ—ãƒ­ã‚¤æˆåŠŸå¾Œã€ARNãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š
```
âœ… AgentCore Runtime deployed!
ARN: arn:aws:bedrock-agentcore:ap-northeast-1:123456789012:runtime/omikuji-agent-xxxxx
```

### Step 2: ç’°å¢ƒå¤‰æ•°è¨­å®š

`nextjs-app/amplify/.env.local` ã‚’ä½œæˆï¼š

```env
AWS_ACCOUNT_ID=123456789012
AWS_REGION=ap-northeast-1
AGENTCORE_RUNTIME_ID=omikuji-agent-xxxxx
AGENTCORE_RUNTIME_ARN=arn:aws:bedrock-agentcore:ap-northeast-1:123456789012:runtime/omikuji-agent-xxxxx
```

### Step 3: Amplify Gen2 Backendä½œæˆ

#### 1. Backendãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ

```bash
cd nextjs-app
mkdir -p amplify/{auth,data,storage}

# Backendå®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆï¼ˆä¸Šè¨˜ã®å®Ÿè£…ä¾‹ã‚’å‚ç…§ï¼‰
touch amplify/backend.ts
touch amplify/auth/resource.ts
touch amplify/data/resource.ts
touch amplify/storage/resource.ts
```

#### 2. é–‹ç™ºç’°å¢ƒï¼ˆSandboxï¼‰

```bash
npm install

# Sandboxèµ·å‹•ï¼ˆAWS ã«é–‹ç™ºç”¨ãƒªã‚½ãƒ¼ã‚¹ä½œæˆï¼‰
npx ampx sandbox --env-file amplify/.env.local
```

Sandbox ãŒèµ·å‹•ã™ã‚‹ã¨ä»¥ä¸‹ãŒè‡ªå‹•ä½œæˆã•ã‚Œã¾ã™ï¼š
- âœ… Cognito User Poolï¼ˆèªè¨¼ï¼‰
- âœ… AppSync GraphQL API
- âœ… S3 Bucketï¼ˆVector Storeï¼‰
- âœ… IAM Roleï¼ˆAgentCoreå‘¼ã³å‡ºã—æ¨©é™ï¼‰

#### 3. æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# GitHubã«ãƒ—ãƒƒã‚·ãƒ¥ â†’ Amplify Hosting ãŒè‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
git push origin main
```

#### 4. æ—¢å­˜DynamoDBãƒ†ãƒ¼ãƒ–ãƒ«ã®å‰Šé™¤

```bash
# æœªä½¿ç”¨ã®DynamoDBãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å‰Šé™¤ï¼ˆã‚³ã‚¹ãƒˆå‰Šæ¸›ï¼‰
aws dynamodb delete-table --table-name ChatMessage-2vlq6e2jnvadxjsogoxuzt4ikm-NONE
aws dynamodb delete-table --table-name FortuneResult-2vlq6e2jnvadxjsogoxuzt4ikm-NONE
```

### Step 4: å‹•ä½œç¢ºèª

```bash
# ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º
http://localhost:3000

# æœ¬ç•ª
https://main.d41aq4729k4l7.amplifyapp.com
```

## Amplify Gen2 Backend å®Ÿè£…ã‚¬ã‚¤ãƒ‰

### Step 1: Backendå®šç¾©ä½œæˆ

`nextjs-app/amplify/backend.ts`:

```typescript
import { defineBackend } from '@aws-amplify/backend';
import { auth } from './auth/resource';
import { data } from './data/resource';
import { storage } from './storage/resource';

export const backend = defineBackend({
  auth,
  data,
  storage,
});

// AgentCore Runtime ARNã‚’ç’°å¢ƒå¤‰æ•°ã‹ã‚‰å–å¾—
const agentCoreRuntimeArn = process.env.AGENTCORE_RUNTIME_ARN || 
  'arn:aws:bedrock-agentcore:ap-northeast-1:226484346947:runtime/my_agent-9NBXM54pmz';

// Backend Stack ã« AgentCore é€£æºã‚’è¿½åŠ 
backend.addOutput({
  custom: {
    agentCoreRuntimeArn,
  },
});
```

### Step 2: AppSync Custom Resolver

`nextjs-app/amplify/data/resource.ts`:

```typescript
import { type ClientSchema, a, defineData } from '@aws-amplify/backend';

const schema = a.schema({
  drawOmikuji: a
    .query()
    .arguments({
      prompt: a.string(),
      sessionId: a.string(),
    })
    .returns(a.customType({
      result: a.string().required(),
      fortune_data: a.json(),
      sessionId: a.string().required(),
    }))
    .authorization((allow) => [allow.authenticated()])
    .handler(
      a.handler.custom({
        entry: './resolvers/drawOmikuji.js',
        dataSource: 'AgentCoreDataSource',
      })
    ),
});

export type Schema = ClientSchema<typeof schema>;
export const data = defineData({
  schema,
  authorizationModes: {
    defaultAuthorizationMode: 'userPool',
  },
});
```

### Step 3: S3 Vector Storeè¨­å®š

`nextjs-app/amplify/storage/resource.ts`:

```typescript
import { defineStorage } from '@aws-amplify/backend';

export const storage = defineStorage({
  name: 'omikujiVectorStore',
  access: (allow) => ({
    'embeddings/*': [
      allow.authenticated.to(['read', 'write']),
      allow.guest.to(['read']),
    ],
    'fortune-history/*': [
      allow.authenticated.to(['read', 'write']),
    ],
  }),
});
```

### Step 4: AgentCore Runtime ã«RAG Toolè¿½åŠ 

`omikuji_agent.py`:

```python
from bedrock_agentcore.tools import S3VectorSearchTool

# S3 Vector Search Toolä½œæˆ
vector_search = S3VectorSearchTool(
    bucket_name=os.environ.get("S3_VECTOR_BUCKET", "omikuji-vector-store"),
    index_name="fortune_history",
    embedding_model="amazon.titan-embed-text-v1"
)

# ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä½œæˆ
agent = Agent(
    tools=[vector_search, code_interpreter],
    session_manager=session_manager
)

# ãŠã¿ãã˜çµæœã‚’Vector Storeã«ä¿å­˜
def save_to_vector_store(result: dict, session_id: str):
    """ãŠã¿ãã˜çµæœã‚’EmbeddingåŒ–ã—ã¦S3ã«ä¿å­˜"""
    text = f"{result['fortune']}: {result['message']}"
    metadata = {
        "session_id": session_id,
        "fortune": result["fortune"],
        "timestamp": result["timestamp"],
        "lucky_color": result["lucky_color"],
        "lucky_item": result["lucky_item"],
    }
    vector_search.add_document(text=text, metadata=metadata)
```

## æ©Ÿèƒ½ä¸€è¦§

### ã‚³ã‚¢æ©Ÿèƒ½
- ğŸ´ **ãŠã¿ãã˜æ©Ÿèƒ½**: AIãŒãƒ©ãƒ³ãƒ€ãƒ ã«é‹å‹¢ã‚’å ã„ã€ã‚®ãƒ£ãƒ«èªé¢¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§çµæœã‚’è¡¨ç¤º
- ğŸ’¬ **ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½**: ãŠã¿ãã˜çµæœã«ã¤ã„ã¦AIã¨ä¼šè©±
- ğŸ“Š **çµ±è¨ˆæ©Ÿèƒ½**: éå»ã®ãŠã¿ãã˜çµæœã‚’Code Interpreterã§ã‚°ãƒ©ãƒ•åŒ–
- ğŸ“œ **å±¥æ­´æ©Ÿèƒ½ï¼ˆRAGï¼‰**: éå»ã®ãŠã¿ãã˜çµæœã‚’S3 Vector Storeã«ä¿å­˜ã—ã€ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢
  - ã€Œéå»ã«ä¼¼ãŸé‹å‹¢ã®æ™‚ã€ã©ã†ã ã£ãŸï¼Ÿã€ã«å›ç­”
  - ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºã•ã‚ŒãŸã‚¢ãƒ‰ãƒã‚¤ã‚¹ç”Ÿæˆ

### AgentCore æ©Ÿèƒ½
- ğŸ§  **Memory**: ä¼šè©±å±¥æ­´ã‚’ä¿æŒã—ã€ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºã•ã‚ŒãŸå¿œç­”
- ğŸ **Code Interpreter**: çµ±è¨ˆåˆ†æã‚„ã‚°ãƒ©ãƒ•ç”Ÿæˆ
- ğŸ” **RAG Tool**: S3 Vector Storeã‚’ä½¿ã£ãŸã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢
- ğŸ” **Observability**: CloudWatch GenAI Dashboard ã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–
- ğŸ” **Session Isolation**: ãƒã‚¤ã‚¯ãƒ­VMã§å®Œå…¨åˆ†é›¢ã•ã‚ŒãŸã‚»ãƒƒã‚·ãƒ§ãƒ³

## ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

### âœ… å®Œäº†ï¼ˆæš«å®šå®Ÿè£…ï¼‰
- [x] AgentCore Runtime ãƒ‡ãƒ—ãƒ­ã‚¤æ¸ˆã¿ï¼ˆmy_agent-9NBXM54pmzï¼‰
- [x] ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®AgentCore Runtimeå‘¼ã³å‡ºã—ãƒ†ã‚¹ãƒˆæˆåŠŸ
- [x] ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰UIå®Œæˆ
- [x] Amplify Hosting ã«ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆSSR / WEB_COMPUTEï¼‰
- [x] **Next.js API Route å®Ÿè£…ï¼ˆ/api/omikujiï¼‰** - æš«å®šå®Ÿè£…
- [x] ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½å®Ÿè£…ï¼ˆAgentCoreæ¥ç¶šå¤±æ•—æ™‚ã®ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ï¼‰
- [x] **AmplifySSRComputeRole è¨­å®šå®Œäº†** - AgentCoreé€£æºå‹•ä½œä¸­ï¼
- [x] **ã‚®ãƒ£ãƒ«èªAIãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º** - æœ¬ç•ªç¨¼åƒä¸­ï¼

### ğŸŸ¢ ç¾åœ¨ã®çŠ¶æ…‹ï¼ˆæš«å®šå®Ÿè£…ã§ç¨¼åƒä¸­ï¼‰

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | çŠ¶æ…‹ | å®Ÿè£…æ–¹å¼ |
|--------------|------|---------|
| ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ | âœ… ç¨¼åƒä¸­ | https://main.d41aq4729k4l7.amplifyapp.com |
| API Route | âœ… ç¨¼åƒä¸­ | **æš«å®šå®Ÿè£…**ï¼ˆAmplify Gen2 Backendæœªä½œæˆï¼‰ |
| AgentCore Runtime | âœ… READY | ã‚®ãƒ£ãƒ«èªAIç”Ÿæˆä¸­ |
| Amplify Compute Role | âœ… è¨­å®šæ¸ˆã¿ | AmplifySSRComputeRole |
| Amplify Gen2 Backend | âŒ æœªä½œæˆ | `amplify/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãªã— |
| S3 Vector Store | âŒ æœªå®Ÿè£… | RAGæ¤œç´¢ãªã— |
| Memory | âŒ æœªä½¿ç”¨ | ä¼šè©±å±¥æ­´ä¿æŒãªã— |

### ğŸš§ TODOï¼ˆæ­£ã—ã„ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¸ã®ç§»è¡Œï¼‰

#### å„ªå…ˆåº¦: é«˜ ğŸ”´
- [ ] **Amplify Gen2 Backendä½œæˆ**
  - `amplify/backend.ts` ã§AgentCoreé€£æºå®šç¾©
  - AppSync Custom Resolverã§ç›´æ¥AgentCoreå‘¼ã³å‡ºã—
  - API Route â†’ AppSyncç§»è¡Œ

- [ ] **S3 Vector Store + RAGå®Ÿè£…**
  - ãŠã¿ãã˜å±¥æ­´ã‚’EmbeddingåŒ–
  - S3ã«ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ä¿å­˜
  - RAG Toolã§éå»å±¥æ­´ã‚’æ¤œç´¢
  - ~~DynamoDBå‰Šé™¤~~ï¼ˆä¸è¦ï¼‰

#### å„ªå…ˆåº¦: ä¸­ ğŸŸ¡
- [ ] Cognitoèªè¨¼é€£æº
- [ ] Memoryæ©Ÿèƒ½ã®æœ‰åŠ¹åŒ–
- [ ] Code Interpreterçµ±è¨ˆæ©Ÿèƒ½

#### å„ªå…ˆåº¦: ä½ ğŸŸ¢
- [ ] CloudWatch GenAI Dashboardè¨­å®š
- [ ] ãƒãƒ«ãƒãƒ¦ãƒ¼ã‚¶ãƒ¼å¯¾å¿œ

### ç¾è¡Œã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆæš«å®šå®Ÿè£…ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            â”‚     â”‚        Amplify Hosting              â”‚     â”‚                     â”‚
â”‚  ãƒ–ãƒ©ã‚¦ã‚¶   â”‚â”€â”€â”€â”€â–¶â”‚  Next.js SSR + API Route           â”‚â”€â”€â”€â”€â–¶â”‚  AgentCore Runtime  â”‚
â”‚  (React)   â”‚     â”‚  /api/omikuji (æš«å®šå®Ÿè£…)            â”‚     â”‚  (omikuji_agent.py) â”‚
â”‚            â”‚     â”‚                                     â”‚     â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚                                           â”‚
                              â”‚ AmplifySSRComputeRole                     â”‚
                              â”‚ (IAMèªè¨¼)                                 â–¼
                              â”‚                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚                                 â”‚   Bedrock Claude    â”‚
                              â”‚                                 â”‚   (ã‚®ãƒ£ãƒ«èªç”Ÿæˆ)    â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å•é¡Œç‚¹:**
- Amplify Gen2 BackendãŒæœªå®šç¾©ï¼ˆIaCãªã—ï¼‰
- å±¥æ­´ä¿å­˜ãªã—
- RAGæ¤œç´¢ãªã—

---

### ç›®æ¨™ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆæ­£ã—ã„æ§‹æˆï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            â”‚     â”‚           Amplify Gen2                       â”‚
â”‚  ãƒ–ãƒ©ã‚¦ã‚¶   â”‚â”€â”€â”€â”€â–¶â”‚  Next.js â†’ AppSync (Custom Resolver)        â”‚
â”‚  (React)   â”‚     â”‚                    â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   AgentCore Runtime (ECR)    â”‚
                          â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
                          â”‚   â”‚  omikuji_agent.py    â”‚   â”‚
                          â”‚   â”‚  + RAG Tool          â”‚   â”‚
                          â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â–¼               â–¼               â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚   Memory    â”‚  â”‚   Claude    â”‚  â”‚  S3 Vector Store â”‚
             â”‚ (ä¼šè©±å±¥æ­´)  â”‚  â”‚   (AIç”Ÿæˆ)  â”‚  â”‚  (RAGæ¤œç´¢)       â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ãƒ¡ãƒªãƒƒãƒˆ:**
- âœ… Amplify Gen2 Backendï¼ˆIaCï¼‰
- âœ… S3 Vector Storeã§ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢
- âœ… éå»å±¥æ­´ã‹ã‚‰ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºå¿œç­”
- âœ… AppSyncçµŒç”±ã§çµ±ä¸€ã•ã‚ŒãŸAPI

### AgentCore Runtime æƒ…å ±

- **Runtime ARN**: `arn:aws:bedrock-agentcore:ap-northeast-1:226484346947:runtime/my_agent-9NBXM54pmz`
- **ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: DEFAULT (READY)
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: READY

## ãƒ‡ãƒ—ãƒ­ã‚¤ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³

ãŠã¿ãã˜ã‚’å¼•ãéš›ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼ã§ã™ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ãƒ–ãƒ©ã‚¦ã‚¶  â”‚     â”‚  Amplify    â”‚     â”‚  API Route      â”‚     â”‚  AgentCore      â”‚     â”‚  Bedrock      â”‚
â”‚ (React)  â”‚     â”‚  Hosting    â”‚     â”‚  /api/omikuji   â”‚     â”‚  Runtime        â”‚     â”‚  Claude       â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                  â”‚                    â”‚                       â”‚                       â”‚
     â”‚  1. ãƒšãƒ¼ã‚¸ã‚¢ã‚¯ã‚»ã‚¹ â”‚                    â”‚                       â”‚                       â”‚
     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚                       â”‚                       â”‚
     â”‚                  â”‚                    â”‚                       â”‚                       â”‚
     â”‚  2. Next.js SSR  â”‚                    â”‚                       â”‚                       â”‚
     â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                    â”‚                       â”‚                       â”‚
     â”‚    (HTML/JS)     â”‚                    â”‚                       â”‚                       â”‚
     â”‚                  â”‚                    â”‚                       â”‚                       â”‚
     â”‚  3. ã€ŒãŠã¿ãã˜ã‚’å¼•ãã€ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯      â”‚                       â”‚                       â”‚
     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚                       â”‚
     â”‚    POST /api/omikuji                  â”‚                       â”‚                       â”‚
     â”‚    {prompt, sessionId}                â”‚                       â”‚                       â”‚
     â”‚                  â”‚                    â”‚                       â”‚                       â”‚
     â”‚                  â”‚                    â”‚  4. InvokeAgentRuntimeâ”‚                       â”‚
     â”‚                  â”‚                    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚
     â”‚                  â”‚                    â”‚   (AWS SDK v3)        â”‚                       â”‚
     â”‚                  â”‚                    â”‚   AmplifySSRComputeRoleâ”‚                      â”‚
     â”‚                  â”‚                    â”‚                       â”‚                       â”‚
     â”‚                  â”‚                    â”‚                       â”‚  5. omikuji_agent.py â”‚
     â”‚                  â”‚                    â”‚                       â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                  â”‚                    â”‚                       â”‚    Agent(prompt)     â”‚
     â”‚                  â”‚                    â”‚                       â”‚                       â”‚
     â”‚                  â”‚                    â”‚                       â”‚  6. AIç”Ÿæˆï¼ˆã‚®ãƒ£ãƒ«èªï¼‰â”‚
     â”‚                  â”‚                    â”‚                       â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                  â”‚                    â”‚                       â”‚    {result, fortune} â”‚
     â”‚                  â”‚                    â”‚                       â”‚                       â”‚
     â”‚                  â”‚                    â”‚  7. Streaming Responseâ”‚                       â”‚
     â”‚                  â”‚                    â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚
     â”‚                  â”‚                    â”‚    JSON chunks        â”‚                       â”‚
     â”‚                  â”‚                    â”‚                       â”‚                       â”‚
     â”‚  8. JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ â”‚                    â”‚                       â”‚                       â”‚
     â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚                       â”‚
     â”‚    {result, fortune_data, sessionId}  â”‚                       â”‚                       â”‚
     â”‚                  â”‚                    â”‚                       â”‚                       â”‚
     â”‚  9. UIæ›´æ–°       â”‚                    â”‚                       â”‚                       â”‚
     â”‚    - é‹å‹¢è¡¨ç¤º    â”‚                    â”‚                       â”‚                       â”‚
     â”‚    - AIãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ â”‚                    â”‚                       â”‚                       â”‚
     â”‚    - ãƒ©ãƒƒã‚­ãƒ¼æƒ…å ± â”‚                    â”‚                       â”‚                       â”‚
     â”‚                  â”‚                    â”‚                       â”‚                       â”‚
```

### å„ã‚¹ãƒ†ãƒƒãƒ—ã®è©³ç´°

| Step | å‡¦ç† | ãƒ•ã‚¡ã‚¤ãƒ« | èª¬æ˜ |
|------|------|----------|------|
| 1-2 | ãƒšãƒ¼ã‚¸è¡¨ç¤º | `page.tsx` | Next.js SSRã§HTMLã‚’ç”Ÿæˆ |
| 3 | ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ | `lib/api.ts` | `fetchOmikuji()` ã§ APIå‘¼ã³å‡ºã— |
| 4 | AgentCoreå‘¼ã³å‡ºã— | `route.ts` | AWS SDK v3 ã§ `InvokeAgentRuntimeCommand` |
| 5-6 | AIç”Ÿæˆ | `omikuji_agent.py` | Strands Agent + Bedrock Claude |
| 7-8 | ãƒ¬ã‚¹ãƒãƒ³ã‚¹ | `route.ts` | JSONãƒ‘ãƒ¼ã‚¹ãƒ»æ­£è¦åŒ– |
| 9 | UIæ›´æ–° | `page.tsx` | React stateæ›´æ–°ãƒ»è¡¨ç¤º |

### IAMèªè¨¼ãƒ•ãƒ­ãƒ¼

```
Amplify SSR å®Ÿè¡Œç’°å¢ƒ
        â”‚
        â”‚ AssumeRole
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AmplifySSRComputeRole   â”‚
â”‚                         â”‚
â”‚ Policy:                 â”‚
â”‚ bedrock-agentcore:      â”‚
â”‚   InvokeAgentRuntime    â”‚
â”‚                         â”‚
â”‚ Resource:               â”‚
â”‚ arn:aws:bedrock-agentcore:ap-northeast-1:226484346947:runtime/*
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
    AgentCore Runtime
    (my_agent-9NBXM54pmz)
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

#### 1. Amplify Gen2 Backend ãŒæœªä½œæˆ

**ç—‡çŠ¶:** `amplify/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå­˜åœ¨ã—ãªã„

**è§£æ±ºç­–:**
```bash
cd nextjs-app
npx ampx generate backend
# ä¸Šè¨˜ã®å®Ÿè£…ä¾‹ã‚’å‚è€ƒã« backend.ts ã‚’ä½œæˆ
```

#### 2. AgentCore ã¸ã®æ¥ç¶šã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶:** `InvokeAgentRuntime` ãŒå¤±æ•—ã™ã‚‹

**è§£æ±ºç­–:** 
- IAM Role ã« `bedrock-agentcore:InvokeAgentRuntime` æ¨©é™ã‚’è¿½åŠ 
- AgentCore Runtime ARN ãŒæ­£ã—ã„ã‹ç¢ºèª
- ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ãŒ `ap-northeast-1` ã‹ç¢ºèª

#### 3. S3 Vector Store ãŒå‹•ä½œã—ãªã„

**ç—‡çŠ¶:** RAGæ¤œç´¢ãŒã§ããªã„

**è§£æ±ºç­–:**
- S3 Bucket ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
- IAM Role ã« S3 ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚‹ã‹ç¢ºèª
- Embedding ãƒ¢ãƒ‡ãƒ«ï¼ˆTitan Embedï¼‰ãŒæœ‰åŠ¹ã‹ç¢ºèª

#### 4. ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã‚¨ãƒ©ãƒ¼

**è§£æ±ºç­–:**
- ã‚»ãƒƒã‚·ãƒ§ãƒ³IDã¯33æ–‡å­—ä»¥ä¸Šã®ä¸€æ„ãªå€¤ã‚’ä½¿ç”¨ï¼ˆUUIDæ¨å¥¨ï¼‰
- AgentCore Memory IDãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

#### 5. Claude ãƒ¢ãƒ‡ãƒ«ã‚¢ã‚¯ã‚»ã‚¹ã‚¨ãƒ©ãƒ¼

**è§£æ±ºç­–:** 
```
AWS Console â†’ Bedrock â†’ Model access ã§
Claude 3 Haiku / Sonnet ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’æœ‰åŠ¹åŒ–
```

#### 6. DynamoDBãƒ†ãƒ¼ãƒ–ãƒ«ãŒæ®‹ã£ã¦ã„ã‚‹

**ç—‡çŠ¶:** æœªä½¿ç”¨ã®ãƒ†ãƒ¼ãƒ–ãƒ«ãŒã‚³ã‚¹ãƒˆã‚’ç™ºç”Ÿã•ã›ã¦ã„ã‚‹

**è§£æ±ºç­–:**
```bash
# å‰Šé™¤ï¼ˆã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢ã«ã¯ä¸è¦ï¼‰
aws dynamodb delete-table --table-name ChatMessage-xxx-NONE
aws dynamodb delete-table --table-name FortuneResult-xxx-NONE
```

## å‚è€ƒãƒªãƒ³ã‚¯

- [Amazon Bedrock AgentCore](https://aws.amazon.com/bedrock/agentcore/)
- [AgentCore Runtime ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/agents-tools-runtime.html)
- [InvokeAgentRuntime API](https://docs.aws.amazon.com/bedrock-agentcore/latest/APIReference/API_InvokeAgentRuntime.html)
- [Amplify Gen2 - HTTP Data Source](https://docs.amplify.aws/react/build-a-backend/data/custom-business-logic/connect-http-datasource/)
- [Strands Agents SDK](https://strandsagents.com/latest/)

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License

## ä½œè€…

Made with ğŸ’•

---

## ğŸ“Š å®Ÿè£…ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

| é …ç›® | çŠ¶æ…‹ | å‚™è€ƒ |
|------|------|------|
| **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰** | âœ… ç¨¼åƒä¸­ | https://main.d41aq4729k4l7.amplifyapp.com |
| **AgentCore Runtime** | âœ… ç¨¼åƒä¸­ | my_agent-9NBXM54pmz |
| **Amplify Gen2 Backend** | âŒ æœªä½œæˆ | `amplify/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãªã— |
| **S3 Vector Store** | âŒ æœªå®Ÿè£… | RAGæ¤œç´¢ãªã— |
| **DynamoDB** | âš ï¸ å‰Šé™¤æ¨å¥¨ | æœªä½¿ç”¨ãƒªã‚½ãƒ¼ã‚¹ |

---

**ãƒ‡ãƒ—ãƒ­ã‚¤æ¸ˆã¿ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: https://main.d41aq4729k4l7.amplifyapp.com

**2025.12 å¯¾å¿œç‰ˆ** - Lambdaä¸è¦ï¼AgentCore Runtime + S3 Vector Storeï¼ˆRAGï¼‰æ§‹æˆ

**ç¾çŠ¶:** æš«å®šå®Ÿè£…ï¼ˆNext.js API Routeï¼‰ã§ç¨¼åƒä¸­ã€‚Amplify Gen2 Backend ã¸ã®ç§»è¡ŒãŒå¿…è¦ã€‚
