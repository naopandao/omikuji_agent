var Wn=Object.defineProperty;var Rr=e=>{throw TypeError(e)};var Vn=(e,t,r)=>t in e?Wn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var p=(e,t,r)=>Vn(e,typeof t!="symbol"?t+"":t,r),qt=(e,t,r)=>t.has(e)||Rr("Cannot "+r);var g=(e,t,r)=>(qt(e,t,"read from private field"),r?r.call(e):t.get(e)),A=(e,t,r)=>t.has(e)?Rr("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),E=(e,t,r,s)=>(qt(e,t,"write to private field"),s?s.call(e,r):t.set(e,r),r),T=(e,t,r)=>(qt(e,t,"access private method"),r);var vr=(e,t,r,s)=>({set _(n){E(e,t,n,r)},get _(){return g(e,t,s)}});var Dr=(e,t,r)=>(s,n)=>{let i=-1;return o(0);async function o(a){if(a<=i)throw new Error("next() called multiple times");i=a;let c,u=!1,l;if(e[a]?(l=e[a][0][0],s.req.routeIndex=a):l=a===e.length&&n||void 0,l)try{c=await l(s,()=>o(a+1))}catch(d){if(d instanceof Error&&t)s.error=d,c=await t(d,s),u=!0;else throw d}else s.finalized===!1&&r&&(c=await r(s));return c&&(s.finalized===!1||u)&&(s.res=c),s}},Jn=Symbol(),Kn=async(e,t=Object.create(null))=>{const{all:r=!1,dot:s=!1}=t,i=(e instanceof Ls?e.raw.headers:e.headers).get("Content-Type");return i!=null&&i.startsWith("multipart/form-data")||i!=null&&i.startsWith("application/x-www-form-urlencoded")?Xn(e,{all:r,dot:s}):{}};async function Xn(e,t){const r=await e.formData();return r?Qn(r,t):{}}function Qn(e,t){const r=Object.create(null);return e.forEach((s,n)=>{t.all||n.endsWith("[]")?Yn(r,n,s):r[n]=s}),t.dot&&Object.entries(r).forEach(([s,n])=>{s.includes(".")&&(Zn(r,s,n),delete r[s])}),r}var Yn=(e,t,r)=>{e[t]!==void 0?Array.isArray(e[t])?e[t].push(r):e[t]=[e[t],r]:t.endsWith("[]")?e[t]=[r]:e[t]=r},Zn=(e,t,r)=>{let s=e;const n=t.split(".");n.forEach((i,o)=>{o===n.length-1?s[i]=r:((!s[i]||typeof s[i]!="object"||Array.isArray(s[i])||s[i]instanceof File)&&(s[i]=Object.create(null)),s=s[i])})},_s=e=>{const t=e.split("/");return t[0]===""&&t.shift(),t},ei=e=>{const{groups:t,path:r}=ti(e),s=_s(r);return ri(s,t)},ti=e=>{const t=[];return e=e.replace(/\{[^}]+\}/g,(r,s)=>{const n=`@${s}`;return t.push([n,r]),n}),{groups:t,path:e}},ri=(e,t)=>{for(let r=t.length-1;r>=0;r--){const[s]=t[r];for(let n=e.length-1;n>=0;n--)if(e[n].includes(s)){e[n]=e[n].replace(s,t[r][1]);break}}return e},bt={},si=(e,t)=>{if(e==="*")return"*";const r=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(r){const s=`${e}#${t}`;return bt[s]||(r[2]?bt[s]=t&&t[0]!==":"&&t[0]!=="*"?[s,r[1],new RegExp(`^${r[2]}(?=/${t})`)]:[e,r[1],new RegExp(`^${r[2]}$`)]:bt[s]=[e,r[1],!0]),bt[s]}return null},pr=(e,t)=>{try{return t(e)}catch{return e.replace(/(?:%[0-9A-Fa-f]{2})+/g,r=>{try{return t(r)}catch{return r}})}},ni=e=>pr(e,decodeURI),Fs=e=>{const t=e.url,r=t.indexOf("/",t.indexOf(":")+4);let s=r;for(;s<t.length;s++){const n=t.charCodeAt(s);if(n===37){const i=t.indexOf("?",s),o=t.slice(r,i===-1?void 0:i);return ni(o.includes("%25")?o.replace(/%25/g,"%2525"):o)}else if(n===63)break}return t.slice(r,s)},ii=e=>{const t=Fs(e);return t.length>1&&t.at(-1)==="/"?t.slice(0,-1):t},Pe=(e,t,...r)=>(r.length&&(t=Pe(t,...r)),`${(e==null?void 0:e[0])==="/"?"":"/"}${e}${t==="/"?"":`${(e==null?void 0:e.at(-1))==="/"?"":"/"}${(t==null?void 0:t[0])==="/"?t.slice(1):t}`}`),Us=e=>{if(e.charCodeAt(e.length-1)!==63||!e.includes(":"))return null;const t=e.split("/"),r=[];let s="";return t.forEach(n=>{if(n!==""&&!/\:/.test(n))s+="/"+n;else if(/\:/.test(n))if(/\?/.test(n)){r.length===0&&s===""?r.push("/"):r.push(s);const i=n.replace("?","");s+="/"+i,r.push(s)}else s+="/"+n}),r.filter((n,i,o)=>o.indexOf(n)===i)},Gt=e=>/[%+]/.test(e)?(e.indexOf("+")!==-1&&(e=e.replace(/\+/g," ")),e.indexOf("%")!==-1?pr(e,js):e):e,Hs=(e,t,r)=>{let s;if(!r&&t&&!/[%+]/.test(t)){let o=e.indexOf("?",8);if(o===-1)return;for(e.startsWith(t,o+1)||(o=e.indexOf(`&${t}`,o+1));o!==-1;){const a=e.charCodeAt(o+t.length+1);if(a===61){const c=o+t.length+2,u=e.indexOf("&",c);return Gt(e.slice(c,u===-1?void 0:u))}else if(a==38||isNaN(a))return"";o=e.indexOf(`&${t}`,o+1)}if(s=/[%+]/.test(e),!s)return}const n={};s??(s=/[%+]/.test(e));let i=e.indexOf("?",8);for(;i!==-1;){const o=e.indexOf("&",i+1);let a=e.indexOf("=",i);a>o&&o!==-1&&(a=-1);let c=e.slice(i+1,a===-1?o===-1?void 0:o:a);if(s&&(c=Gt(c)),i=o,c==="")continue;let u;a===-1?u="":(u=e.slice(a+1,o===-1?void 0:o),s&&(u=Gt(u))),r?(n[c]&&Array.isArray(n[c])||(n[c]=[]),n[c].push(u)):n[c]??(n[c]=u)}return t?n[t]:n},oi=Hs,ai=(e,t)=>Hs(e,t,!0),js=decodeURIComponent,Ir=e=>pr(e,js),je,j,oe,zs,qs,ir,de,Ds,Ls=(Ds=class{constructor(e,t="/",r=[[]]){A(this,oe);p(this,"raw");A(this,je);A(this,j);p(this,"routeIndex",0);p(this,"path");p(this,"bodyCache",{});A(this,de,e=>{const{bodyCache:t,raw:r}=this,s=t[e];if(s)return s;const n=Object.keys(t)[0];return n?t[n].then(i=>(n==="json"&&(i=JSON.stringify(i)),new Response(i)[e]())):t[e]=r[e]()});this.raw=e,this.path=t,E(this,j,r),E(this,je,{})}param(e){return e?T(this,oe,zs).call(this,e):T(this,oe,qs).call(this)}query(e){return oi(this.url,e)}queries(e){return ai(this.url,e)}header(e){if(e)return this.raw.headers.get(e)??void 0;const t={};return this.raw.headers.forEach((r,s)=>{t[s]=r}),t}async parseBody(e){var t;return(t=this.bodyCache).parsedBody??(t.parsedBody=await Kn(this,e))}json(){return g(this,de).call(this,"text").then(e=>JSON.parse(e))}text(){return g(this,de).call(this,"text")}arrayBuffer(){return g(this,de).call(this,"arrayBuffer")}blob(){return g(this,de).call(this,"blob")}formData(){return g(this,de).call(this,"formData")}addValidatedData(e,t){g(this,je)[e]=t}valid(e){return g(this,je)[e]}get url(){return this.raw.url}get method(){return this.raw.method}get[Jn](){return g(this,j)}get matchedRoutes(){return g(this,j)[0].map(([[,e]])=>e)}get routePath(){return g(this,j)[0].map(([[,e]])=>e)[this.routeIndex].path}},je=new WeakMap,j=new WeakMap,oe=new WeakSet,zs=function(e){const t=g(this,j)[0][this.routeIndex][1][e],r=T(this,oe,ir).call(this,t);return r&&/\%/.test(r)?Ir(r):r},qs=function(){const e={},t=Object.keys(g(this,j)[0][this.routeIndex][1]);for(const r of t){const s=T(this,oe,ir).call(this,g(this,j)[0][this.routeIndex][1][r]);s!==void 0&&(e[r]=/\%/.test(s)?Ir(s):s)}return e},ir=function(e){return g(this,j)[1]?g(this,j)[1][e]:e},de=new WeakMap,Ds),ci={Stringify:1},Gs=async(e,t,r,s,n)=>{typeof e=="object"&&!(e instanceof String)&&(e instanceof Promise||(e=e.toString()),e instanceof Promise&&(e=await e));const i=e.callbacks;return i!=null&&i.length?(n?n[0]+=e:n=[e],Promise.all(i.map(a=>a({phase:t,buffer:n,context:s}))).then(a=>Promise.all(a.filter(Boolean).map(c=>Gs(c,t,!1,s,n))).then(()=>n[0]))):Promise.resolve(e)},ui="text/plain; charset=UTF-8",Wt=(e,t)=>({"Content-Type":e,...t}),ht,pt,ee,Le,te,P,mt,ze,qe,Ce,gt,yt,fe,_e,Is,li=(Is=class{constructor(e,t){A(this,fe);A(this,ht);A(this,pt);p(this,"env",{});A(this,ee);p(this,"finalized",!1);p(this,"error");A(this,Le);A(this,te);A(this,P);A(this,mt);A(this,ze);A(this,qe);A(this,Ce);A(this,gt);A(this,yt);p(this,"render",(...e)=>(g(this,ze)??E(this,ze,t=>this.html(t)),g(this,ze).call(this,...e)));p(this,"setLayout",e=>E(this,mt,e));p(this,"getLayout",()=>g(this,mt));p(this,"setRenderer",e=>{E(this,ze,e)});p(this,"header",(e,t,r)=>{this.finalized&&E(this,P,new Response(g(this,P).body,g(this,P)));const s=g(this,P)?g(this,P).headers:g(this,Ce)??E(this,Ce,new Headers);t===void 0?s.delete(e):r!=null&&r.append?s.append(e,t):s.set(e,t)});p(this,"status",e=>{E(this,Le,e)});p(this,"set",(e,t)=>{g(this,ee)??E(this,ee,new Map),g(this,ee).set(e,t)});p(this,"get",e=>g(this,ee)?g(this,ee).get(e):void 0);p(this,"newResponse",(...e)=>T(this,fe,_e).call(this,...e));p(this,"body",(e,t,r)=>T(this,fe,_e).call(this,e,t,r));p(this,"text",(e,t,r)=>!g(this,Ce)&&!g(this,Le)&&!t&&!r&&!this.finalized?new Response(e):T(this,fe,_e).call(this,e,t,Wt(ui,r)));p(this,"json",(e,t,r)=>T(this,fe,_e).call(this,JSON.stringify(e),t,Wt("application/json",r)));p(this,"html",(e,t,r)=>{const s=n=>T(this,fe,_e).call(this,n,t,Wt("text/html; charset=UTF-8",r));return typeof e=="object"?Gs(e,ci.Stringify,!1,{}).then(s):s(e)});p(this,"redirect",(e,t)=>{const r=String(e);return this.header("Location",/[^\x00-\xFF]/.test(r)?encodeURI(r):r),this.newResponse(null,t??302)});p(this,"notFound",()=>(g(this,qe)??E(this,qe,()=>new Response),g(this,qe).call(this,this)));E(this,ht,e),t&&(E(this,te,t.executionCtx),this.env=t.env,E(this,qe,t.notFoundHandler),E(this,yt,t.path),E(this,gt,t.matchResult))}get req(){return g(this,pt)??E(this,pt,new Ls(g(this,ht),g(this,yt),g(this,gt))),g(this,pt)}get event(){if(g(this,te)&&"respondWith"in g(this,te))return g(this,te);throw Error("This context has no FetchEvent")}get executionCtx(){if(g(this,te))return g(this,te);throw Error("This context has no ExecutionContext")}get res(){return g(this,P)||E(this,P,new Response(null,{headers:g(this,Ce)??E(this,Ce,new Headers)}))}set res(e){if(g(this,P)&&e){e=new Response(e.body,e);for(const[t,r]of g(this,P).headers.entries())if(t!=="content-type")if(t==="set-cookie"){const s=g(this,P).headers.getSetCookie();e.headers.delete("set-cookie");for(const n of s)e.headers.append("set-cookie",n)}else e.headers.set(t,r)}E(this,P,e),this.finalized=!0}get var(){return g(this,ee)?Object.fromEntries(g(this,ee)):{}}},ht=new WeakMap,pt=new WeakMap,ee=new WeakMap,Le=new WeakMap,te=new WeakMap,P=new WeakMap,mt=new WeakMap,ze=new WeakMap,qe=new WeakMap,Ce=new WeakMap,gt=new WeakMap,yt=new WeakMap,fe=new WeakSet,_e=function(e,t,r){const s=g(this,P)?new Headers(g(this,P).headers):g(this,Ce)??new Headers;if(typeof t=="object"&&"headers"in t){const i=t.headers instanceof Headers?t.headers:new Headers(t.headers);for(const[o,a]of i)o.toLowerCase()==="set-cookie"?s.append(o,a):s.set(o,a)}if(r)for(const[i,o]of Object.entries(r))if(typeof o=="string")s.set(i,o);else{s.delete(i);for(const a of o)s.append(i,a)}const n=typeof t=="number"?t:(t==null?void 0:t.status)??g(this,Le);return new Response(e,{status:n,headers:s})},Is),I="ALL",di="all",fi=["get","post","put","delete","options","patch"],Ws="Can not add a route since the matcher is already built.",Vs=class extends Error{},hi="__COMPOSED_HANDLER",pi=e=>e.text("404 Not Found",404),Mr=(e,t)=>{if("getResponse"in e){const r=e.getResponse();return t.newResponse(r.body,r)}return console.error(e),t.text("Internal Server Error",500)},z,M,Ks,q,xe,At,Ct,Ms,Js=(Ms=class{constructor(t={}){A(this,M);p(this,"get");p(this,"post");p(this,"put");p(this,"delete");p(this,"options");p(this,"patch");p(this,"all");p(this,"on");p(this,"use");p(this,"router");p(this,"getPath");p(this,"_basePath","/");A(this,z,"/");p(this,"routes",[]);A(this,q,pi);p(this,"errorHandler",Mr);p(this,"onError",t=>(this.errorHandler=t,this));p(this,"notFound",t=>(E(this,q,t),this));p(this,"fetch",(t,...r)=>T(this,M,Ct).call(this,t,r[1],r[0],t.method));p(this,"request",(t,r,s,n)=>t instanceof Request?this.fetch(r?new Request(t,r):t,s,n):(t=t.toString(),this.fetch(new Request(/^https?:\/\//.test(t)?t:`http://localhost${Pe("/",t)}`,r),s,n)));p(this,"fire",()=>{addEventListener("fetch",t=>{t.respondWith(T(this,M,Ct).call(this,t.request,t,void 0,t.request.method))})});[...fi,di].forEach(i=>{this[i]=(o,...a)=>(typeof o=="string"?E(this,z,o):T(this,M,xe).call(this,i,g(this,z),o),a.forEach(c=>{T(this,M,xe).call(this,i,g(this,z),c)}),this)}),this.on=(i,o,...a)=>{for(const c of[o].flat()){E(this,z,c);for(const u of[i].flat())a.map(l=>{T(this,M,xe).call(this,u.toUpperCase(),g(this,z),l)})}return this},this.use=(i,...o)=>(typeof i=="string"?E(this,z,i):(E(this,z,"*"),o.unshift(i)),o.forEach(a=>{T(this,M,xe).call(this,I,g(this,z),a)}),this);const{strict:s,...n}=t;Object.assign(this,n),this.getPath=s??!0?t.getPath??Fs:ii}route(t,r){const s=this.basePath(t);return r.routes.map(n=>{var o;let i;r.errorHandler===Mr?i=n.handler:(i=async(a,c)=>(await Dr([],r.errorHandler)(a,()=>n.handler(a,c))).res,i[hi]=n.handler),T(o=s,M,xe).call(o,n.method,n.path,i)}),this}basePath(t){const r=T(this,M,Ks).call(this);return r._basePath=Pe(this._basePath,t),r}mount(t,r,s){let n,i;s&&(typeof s=="function"?i=s:(i=s.optionHandler,s.replaceRequest===!1?n=c=>c:n=s.replaceRequest));const o=i?c=>{const u=i(c);return Array.isArray(u)?u:[u]}:c=>{let u;try{u=c.executionCtx}catch{}return[c.env,u]};n||(n=(()=>{const c=Pe(this._basePath,t),u=c==="/"?0:c.length;return l=>{const d=new URL(l.url);return d.pathname=d.pathname.slice(u)||"/",new Request(d,l)}})());const a=async(c,u)=>{const l=await r(n(c.req.raw),...o(c));if(l)return l;await u()};return T(this,M,xe).call(this,I,Pe(t,"*"),a),this}},z=new WeakMap,M=new WeakSet,Ks=function(){const t=new Js({router:this.router,getPath:this.getPath});return t.errorHandler=this.errorHandler,E(t,q,g(this,q)),t.routes=this.routes,t},q=new WeakMap,xe=function(t,r,s){t=t.toUpperCase(),r=Pe(this._basePath,r);const n={basePath:this._basePath,path:r,method:t,handler:s};this.router.add(t,r,[s,n]),this.routes.push(n)},At=function(t,r){if(t instanceof Error)return this.errorHandler(t,r);throw t},Ct=function(t,r,s,n){if(n==="HEAD")return(async()=>new Response(null,await T(this,M,Ct).call(this,t,r,s,"GET")))();const i=this.getPath(t,{env:s}),o=this.router.match(n,i),a=new li(t,{path:i,matchResult:o,env:s,executionCtx:r,notFoundHandler:g(this,q)});if(o[0].length===1){let u;try{u=o[0][0][0][0](a,async()=>{a.res=await g(this,q).call(this,a)})}catch(l){return T(this,M,At).call(this,l,a)}return u instanceof Promise?u.then(l=>l||(a.finalized?a.res:g(this,q).call(this,a))).catch(l=>T(this,M,At).call(this,l,a)):u??g(this,q).call(this,a)}const c=Dr(o[0],this.errorHandler,g(this,q));return(async()=>{try{const u=await c(a);if(!u.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return u.res}catch(u){return T(this,M,At).call(this,u,a)}})()},Ms),Xs=[];function mi(e,t){const r=this.buildAllMatchers(),s=(n,i)=>{const o=r[n]||r[I],a=o[2][i];if(a)return a;const c=i.match(o[0]);if(!c)return[[],Xs];const u=c.indexOf("",1);return[o[1][u],c]};return this.match=s,s(e,t)}var It="[^/]+",et=".*",tt="(?:|/.*)",Fe=Symbol(),gi=new Set(".\\+*[^]$()");function yi(e,t){return e.length===1?t.length===1?e<t?-1:1:-1:t.length===1||e===et||e===tt?1:t===et||t===tt?-1:e===It?1:t===It?-1:e.length===t.length?e<t?-1:1:t.length-e.length}var Te,Re,G,Os,or=(Os=class{constructor(){A(this,Te);A(this,Re);A(this,G,Object.create(null))}insert(t,r,s,n,i){if(t.length===0){if(g(this,Te)!==void 0)throw Fe;if(i)return;E(this,Te,r);return}const[o,...a]=t,c=o==="*"?a.length===0?["","",et]:["","",It]:o==="/*"?["","",tt]:o.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let u;if(c){const l=c[1];let d=c[2]||It;if(l&&c[2]&&(d===".*"||(d=d.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(d))))throw Fe;if(u=g(this,G)[d],!u){if(Object.keys(g(this,G)).some(f=>f!==et&&f!==tt))throw Fe;if(i)return;u=g(this,G)[d]=new or,l!==""&&E(u,Re,n.varIndex++)}!i&&l!==""&&s.push([l,g(u,Re)])}else if(u=g(this,G)[o],!u){if(Object.keys(g(this,G)).some(l=>l.length>1&&l!==et&&l!==tt))throw Fe;if(i)return;u=g(this,G)[o]=new or}u.insert(a,r,s,n,i)}buildRegExpStr(){const r=Object.keys(g(this,G)).sort(yi).map(s=>{const n=g(this,G)[s];return(typeof g(n,Re)=="number"?`(${s})@${g(n,Re)}`:gi.has(s)?`\\${s}`:s)+n.buildRegExpStr()});return typeof g(this,Te)=="number"&&r.unshift(`#${g(this,Te)}`),r.length===0?"":r.length===1?r[0]:"(?:"+r.join("|")+")"}},Te=new WeakMap,Re=new WeakMap,G=new WeakMap,Os),kt,wt,Bs,wi=(Bs=class{constructor(){A(this,kt,{varIndex:0});A(this,wt,new or)}insert(e,t,r){const s=[],n=[];for(let o=0;;){let a=!1;if(e=e.replace(/\{[^}]+\}/g,c=>{const u=`@\\${o}`;return n[o]=[u,c],o++,a=!0,u}),!a)break}const i=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let o=n.length-1;o>=0;o--){const[a]=n[o];for(let c=i.length-1;c>=0;c--)if(i[c].indexOf(a)!==-1){i[c]=i[c].replace(a,n[o][1]);break}}return g(this,wt).insert(i,t,s,g(this,kt),r),s}buildRegExp(){let e=g(this,wt).buildRegExpStr();if(e==="")return[/^$/,[],[]];let t=0;const r=[],s=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,(n,i,o)=>i!==void 0?(r[++t]=Number(i),"$()"):(o!==void 0&&(s[Number(o)]=++t),"")),[new RegExp(`^${e}`),r,s]}},kt=new WeakMap,wt=new WeakMap,Bs),Si=[/^$/,[],Object.create(null)],Tt=Object.create(null);function Qs(e){return Tt[e]??(Tt[e]=new RegExp(e==="*"?"":`^${e.replace(/\/\*$|([.\\+*[^\]$()])/g,(t,r)=>r?`\\${r}`:"(?:|/.*)")}$`))}function bi(){Tt=Object.create(null)}function xi(e){var u;const t=new wi,r=[];if(e.length===0)return Si;const s=e.map(l=>[!/\*|\/:/.test(l[0]),...l]).sort(([l,d],[f,h])=>l?1:f?-1:d.length-h.length),n=Object.create(null);for(let l=0,d=-1,f=s.length;l<f;l++){const[h,m,y]=s[l];h?n[m]=[y.map(([S])=>[S,Object.create(null)]),Xs]:d++;let w;try{w=t.insert(m,d,h)}catch(S){throw S===Fe?new Vs(m):S}h||(r[d]=y.map(([S,b])=>{const x=Object.create(null);for(b-=1;b>=0;b--){const[C,R]=w[b];x[C]=R}return[S,x]}))}const[i,o,a]=t.buildRegExp();for(let l=0,d=r.length;l<d;l++)for(let f=0,h=r[l].length;f<h;f++){const m=(u=r[l][f])==null?void 0:u[1];if(!m)continue;const y=Object.keys(m);for(let w=0,S=y.length;w<S;w++)m[y[w]]=a[m[y[w]]]}const c=[];for(const l in o)c[l]=r[o[l]];return[i,c,n]}function Ne(e,t){if(e){for(const r of Object.keys(e).sort((s,n)=>n.length-s.length))if(Qs(r).test(t))return[...e[r]]}}var he,pe,Pt,Ys,$s,Ei=($s=class{constructor(){A(this,Pt);p(this,"name","RegExpRouter");A(this,he);A(this,pe);p(this,"match",mi);E(this,he,{[I]:Object.create(null)}),E(this,pe,{[I]:Object.create(null)})}add(e,t,r){var a;const s=g(this,he),n=g(this,pe);if(!s||!n)throw new Error(Ws);s[e]||[s,n].forEach(c=>{c[e]=Object.create(null),Object.keys(c[I]).forEach(u=>{c[e][u]=[...c[I][u]]})}),t==="/*"&&(t="*");const i=(t.match(/\/:/g)||[]).length;if(/\*$/.test(t)){const c=Qs(t);e===I?Object.keys(s).forEach(u=>{var l;(l=s[u])[t]||(l[t]=Ne(s[u],t)||Ne(s[I],t)||[])}):(a=s[e])[t]||(a[t]=Ne(s[e],t)||Ne(s[I],t)||[]),Object.keys(s).forEach(u=>{(e===I||e===u)&&Object.keys(s[u]).forEach(l=>{c.test(l)&&s[u][l].push([r,i])})}),Object.keys(n).forEach(u=>{(e===I||e===u)&&Object.keys(n[u]).forEach(l=>c.test(l)&&n[u][l].push([r,i]))});return}const o=Us(t)||[t];for(let c=0,u=o.length;c<u;c++){const l=o[c];Object.keys(n).forEach(d=>{var f;(e===I||e===d)&&((f=n[d])[l]||(f[l]=[...Ne(s[d],l)||Ne(s[I],l)||[]]),n[d][l].push([r,i-u+c+1]))})}}buildAllMatchers(){const e=Object.create(null);return Object.keys(g(this,pe)).concat(Object.keys(g(this,he))).forEach(t=>{e[t]||(e[t]=T(this,Pt,Ys).call(this,t))}),E(this,he,E(this,pe,void 0)),bi(),e}},he=new WeakMap,pe=new WeakMap,Pt=new WeakSet,Ys=function(e){const t=[];let r=e===I;return[g(this,he),g(this,pe)].forEach(s=>{const n=s[e]?Object.keys(s[e]).map(i=>[i,s[e][i]]):[];n.length!==0?(r||(r=!0),t.push(...n)):e!==I&&t.push(...Object.keys(s[I]).map(i=>[i,s[I][i]]))}),r?xi(t):null},$s),me,re,Ns,Ai=(Ns=class{constructor(e){p(this,"name","SmartRouter");A(this,me,[]);A(this,re,[]);E(this,me,e.routers)}add(e,t,r){if(!g(this,re))throw new Error(Ws);g(this,re).push([e,t,r])}match(e,t){if(!g(this,re))throw new Error("Fatal error");const r=g(this,me),s=g(this,re),n=r.length;let i=0,o;for(;i<n;i++){const a=r[i];try{for(let c=0,u=s.length;c<u;c++)a.add(...s[c]);o=a.match(e,t)}catch(c){if(c instanceof Vs)continue;throw c}this.match=a.match.bind(a),E(this,me,[a]),E(this,re,void 0);break}if(i===n)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,o}get activeRouter(){if(g(this,re)||g(this,me).length!==1)throw new Error("No active router has been determined yet.");return g(this,me)[0]}},me=new WeakMap,re=new WeakMap,Ns),Xe=Object.create(null),ge,N,ve,Ge,B,se,Ee,ks,Zs=(ks=class{constructor(e,t,r){A(this,se);A(this,ge);A(this,N);A(this,ve);A(this,Ge,0);A(this,B,Xe);if(E(this,N,r||Object.create(null)),E(this,ge,[]),e&&t){const s=Object.create(null);s[e]={handler:t,possibleKeys:[],score:0},E(this,ge,[s])}E(this,ve,[])}insert(e,t,r){E(this,Ge,++vr(this,Ge)._);let s=this;const n=ei(t),i=[];for(let o=0,a=n.length;o<a;o++){const c=n[o],u=n[o+1],l=si(c,u),d=Array.isArray(l)?l[0]:c;if(d in g(s,N)){s=g(s,N)[d],l&&i.push(l[1]);continue}g(s,N)[d]=new Zs,l&&(g(s,ve).push(l),i.push(l[1])),s=g(s,N)[d]}return g(s,ge).push({[e]:{handler:r,possibleKeys:i.filter((o,a,c)=>c.indexOf(o)===a),score:g(this,Ge)}}),s}search(e,t){var a;const r=[];E(this,B,Xe);let n=[this];const i=_s(t),o=[];for(let c=0,u=i.length;c<u;c++){const l=i[c],d=c===u-1,f=[];for(let h=0,m=n.length;h<m;h++){const y=n[h],w=g(y,N)[l];w&&(E(w,B,g(y,B)),d?(g(w,N)["*"]&&r.push(...T(this,se,Ee).call(this,g(w,N)["*"],e,g(y,B))),r.push(...T(this,se,Ee).call(this,w,e,g(y,B)))):f.push(w));for(let S=0,b=g(y,ve).length;S<b;S++){const x=g(y,ve)[S],C=g(y,B)===Xe?{}:{...g(y,B)};if(x==="*"){const ae=g(y,N)["*"];ae&&(r.push(...T(this,se,Ee).call(this,ae,e,g(y,B))),E(ae,B,C),f.push(ae));continue}const[R,v,O]=x;if(!l&&!(O instanceof RegExp))continue;const H=g(y,N)[R],Z=i.slice(c).join("/");if(O instanceof RegExp){const ae=O.exec(Z);if(ae){if(C[v]=ae[0],r.push(...T(this,se,Ee).call(this,H,e,g(y,B),C)),Object.keys(g(H,N)).length){E(H,B,C);const zt=((a=ae[0].match(/\//))==null?void 0:a.length)??0;(o[zt]||(o[zt]=[])).push(H)}continue}}(O===!0||O.test(l))&&(C[v]=l,d?(r.push(...T(this,se,Ee).call(this,H,e,C,g(y,B))),g(H,N)["*"]&&r.push(...T(this,se,Ee).call(this,g(H,N)["*"],e,C,g(y,B)))):(E(H,B,C),f.push(H)))}}n=f.concat(o.shift()??[])}return r.length>1&&r.sort((c,u)=>c.score-u.score),[r.map(({handler:c,params:u})=>[c,u])]}},ge=new WeakMap,N=new WeakMap,ve=new WeakMap,Ge=new WeakMap,B=new WeakMap,se=new WeakSet,Ee=function(e,t,r,s){const n=[];for(let i=0,o=g(e,ge).length;i<o;i++){const a=g(e,ge)[i],c=a[t]||a[I],u={};if(c!==void 0&&(c.params=Object.create(null),n.push(c),r!==Xe||s&&s!==Xe))for(let l=0,d=c.possibleKeys.length;l<d;l++){const f=c.possibleKeys[l],h=u[c.score];c.params[f]=s!=null&&s[f]&&!h?s[f]:r[f]??(s==null?void 0:s[f]),u[c.score]=!0}}return n},ks),De,Ps,Ci=(Ps=class{constructor(){p(this,"name","TrieRouter");A(this,De);E(this,De,new Zs)}add(e,t,r){const s=Us(t);if(s){for(let n=0,i=s.length;n<i;n++)g(this,De).insert(e,s[n],r);return}g(this,De).insert(e,t,r)}match(e,t){return g(this,De).search(e,t)}},De=new WeakMap,Ps),en=class extends Js{constructor(e={}){super(e),this.router=e.router??new Ai({routers:[new Ei,new Ci]})}},Ti=e=>{const r={...{origin:"*",allowMethods:["GET","HEAD","PUT","POST","DELETE","PATCH"],allowHeaders:[],exposeHeaders:[]},...e},s=(i=>typeof i=="string"?i==="*"?()=>i:o=>i===o?o:null:typeof i=="function"?i:o=>i.includes(o)?o:null)(r.origin),n=(i=>typeof i=="function"?i:Array.isArray(i)?()=>i:()=>[])(r.allowMethods);return async function(o,a){var l;function c(d,f){o.res.headers.set(d,f)}const u=await s(o.req.header("origin")||"",o);if(u&&c("Access-Control-Allow-Origin",u),r.credentials&&c("Access-Control-Allow-Credentials","true"),(l=r.exposeHeaders)!=null&&l.length&&c("Access-Control-Expose-Headers",r.exposeHeaders.join(",")),o.req.method==="OPTIONS"){r.origin!=="*"&&c("Vary","Origin"),r.maxAge!=null&&c("Access-Control-Max-Age",r.maxAge.toString());const d=await n(o.req.header("origin")||"",o);d.length&&c("Access-Control-Allow-Methods",d.join(","));let f=r.allowHeaders;if(!(f!=null&&f.length)){const h=o.req.header("Access-Control-Request-Headers");h&&(f=h.split(/\s*,\s*/))}return f!=null&&f.length&&(c("Access-Control-Allow-Headers",f.join(",")),o.res.headers.append("Vary","Access-Control-Request-Headers")),o.res.headers.delete("Content-Length"),o.res.headers.delete("Content-Type"),new Response(null,{headers:o.res.headers,status:204,statusText:"No Content"})}await a(),r.origin!=="*"&&o.header("Vary","Origin",{append:!0})}},Ri=/^\s*(?:text\/(?!event-stream(?:[;\s]|$))[^;\s]+|application\/(?:javascript|json|xml|xml-dtd|ecmascript|dart|postscript|rtf|tar|toml|vnd\.dart|vnd\.ms-fontobject|vnd\.ms-opentype|wasm|x-httpd-php|x-javascript|x-ns-proxy-autoconfig|x-sh|x-tar|x-virtualbox-hdd|x-virtualbox-ova|x-virtualbox-ovf|x-virtualbox-vbox|x-virtualbox-vdi|x-virtualbox-vhd|x-virtualbox-vmdk|x-www-form-urlencoded)|font\/(?:otf|ttf)|image\/(?:bmp|vnd\.adobe\.photoshop|vnd\.microsoft\.icon|vnd\.ms-dds|x-icon|x-ms-bmp)|message\/rfc822|model\/gltf-binary|x-shader\/x-fragment|x-shader\/x-vertex|[^;\s]+?\+(?:json|text|xml|yaml))(?:[;\s]|$)/i,Or=(e,t=Di)=>{const r=/\.([a-zA-Z0-9]+?)$/,s=e.match(r);if(!s)return;let n=t[s[1]];return n&&n.startsWith("text")&&(n+="; charset=utf-8"),n},vi={aac:"audio/aac",avi:"video/x-msvideo",avif:"image/avif",av1:"video/av1",bin:"application/octet-stream",bmp:"image/bmp",css:"text/css",csv:"text/csv",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gif:"image/gif",gz:"application/gzip",htm:"text/html",html:"text/html",ico:"image/x-icon",ics:"text/calendar",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsonld:"application/ld+json",map:"application/json",mid:"audio/x-midi",midi:"audio/x-midi",mjs:"text/javascript",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",opus:"audio/opus",otf:"font/otf",pdf:"application/pdf",png:"image/png",rtf:"application/rtf",svg:"image/svg+xml",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",ttf:"font/ttf",txt:"text/plain",wasm:"application/wasm",webm:"video/webm",weba:"audio/webm",webmanifest:"application/manifest+json",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xml:"application/xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2",gltf:"model/gltf+json",glb:"model/gltf-binary"},Di=vi,Ii=(...e)=>{let t=e.filter(n=>n!=="").join("/");t=t.replace(new RegExp("(?<=\\/)\\/+","g"),"");const r=t.split("/"),s=[];for(const n of r)n===".."&&s.length>0&&s.at(-1)!==".."?s.pop():n!=="."&&s.push(n);return s.join("/")||"."},tn={br:".br",zstd:".zst",gzip:".gz"},Mi=Object.keys(tn),Oi="index.html",Bi=e=>{const t=e.root??"./",r=e.path,s=e.join??Ii;return async(n,i)=>{var l,d,f,h;if(n.finalized)return i();let o;if(e.path)o=e.path;else try{if(o=decodeURIComponent(n.req.path),/(?:^|[\/\\])\.\.(?:$|[\/\\])/.test(o))throw new Error}catch{return await((l=e.onNotFound)==null?void 0:l.call(e,n.req.path,n)),i()}let a=s(t,!r&&e.rewriteRequestPath?e.rewriteRequestPath(o):o);e.isDir&&await e.isDir(a)&&(a=s(a,Oi));const c=e.getContent;let u=await c(a,n);if(u instanceof Response)return n.newResponse(u.body,u);if(u){const m=e.mimes&&Or(a,e.mimes)||Or(a);if(n.header("Content-Type",m||"application/octet-stream"),e.precompressed&&(!m||Ri.test(m))){const y=new Set((d=n.req.header("Accept-Encoding"))==null?void 0:d.split(",").map(w=>w.trim()));for(const w of Mi){if(!y.has(w))continue;const S=await c(a+tn[w],n);if(S){u=S,n.header("Content-Encoding",w),n.header("Vary","Accept-Encoding",{append:!0});break}}}return await((f=e.onFound)==null?void 0:f.call(e,a,n)),n.body(u)}await((h=e.onNotFound)==null?void 0:h.call(e,a,n)),await i()}},$i=async(e,t)=>{let r;t&&t.manifest?typeof t.manifest=="string"?r=JSON.parse(t.manifest):r=t.manifest:typeof __STATIC_CONTENT_MANIFEST=="string"?r=JSON.parse(__STATIC_CONTENT_MANIFEST):r=__STATIC_CONTENT_MANIFEST;let s;t&&t.namespace?s=t.namespace:s=__STATIC_CONTENT;const n=r[e]||e;if(!n)return null;const i=await s.get(n,{type:"stream"});return i||null},Ni=e=>async function(r,s){return Bi({...e,getContent:async i=>$i(i,{manifest:e.manifest,namespace:e.namespace?e.namespace:r.env?r.env.__STATIC_CONTENT:void 0})})(r,s)},ki=e=>Ni(e);const Pi=e=>({setHttpHandler(t){e.httpHandler=t},httpHandler(){return e.httpHandler},updateHttpClientConfig(t,r){var s;(s=e.httpHandler)==null||s.updateHttpClientConfig(t,r)},httpHandlerConfigs(){return e.httpHandler.httpHandlerConfigs()}}),_i=e=>({httpHandler:e.httpHandler()});var ot;(function(e){e.HTTP="http",e.HTTPS="https"})(ot||(ot={}));var Mt;(function(e){e.MD5="md5",e.CRC32="crc32",e.CRC32C="crc32c",e.SHA1="sha1",e.SHA256="sha256"})(Mt||(Mt={}));const Br="__smithy_context";class F{constructor(t){p(this,"method");p(this,"protocol");p(this,"hostname");p(this,"port");p(this,"path");p(this,"query");p(this,"headers");p(this,"username");p(this,"password");p(this,"fragment");p(this,"body");this.method=t.method||"GET",this.hostname=t.hostname||"localhost",this.port=t.port,this.query=t.query||{},this.headers=t.headers||{},this.body=t.body,this.protocol=t.protocol?t.protocol.slice(-1)!==":"?`${t.protocol}:`:t.protocol:"https:",this.path=t.path?t.path.charAt(0)!=="/"?`/${t.path}`:t.path:"/",this.username=t.username,this.password=t.password,this.fragment=t.fragment}static clone(t){const r=new F({...t,headers:{...t.headers}});return r.query&&(r.query=Fi(r.query)),r}static isInstance(t){if(!t)return!1;const r=t;return"method"in r&&"protocol"in r&&"hostname"in r&&"path"in r&&typeof r.query=="object"&&typeof r.headers=="object"}clone(){return F.clone(this)}}function Fi(e){return Object.keys(e).reduce((t,r)=>{const s=e[r];return{...t,[r]:Array.isArray(s)?[...s]:s}},{})}class We{constructor(t){p(this,"statusCode");p(this,"reason");p(this,"headers");p(this,"body");this.statusCode=t.statusCode,this.reason=t.reason,this.headers=t.headers||{},this.body=t.body}static isInstance(t){if(!t)return!1;const r=t;return typeof r.statusCode=="number"&&typeof r.headers=="object"}}const Ui=e=>t=>async r=>{if(!F.isInstance(r.request))return t(r);const{request:s}=r,{handlerProtocol:n=""}=e.requestHandler.metadata||{};if(n.indexOf("h2")>=0&&!s.headers[":authority"])delete s.headers.host,s.headers[":authority"]=s.hostname+(s.port?":"+s.port:"");else if(!s.headers.host){let i=s.hostname;s.port!=null&&(i+=`:${s.port}`),s.headers.host=i}return t(r)},Hi={name:"hostHeaderMiddleware",step:"build",priority:"low",tags:["HOST"],override:!0},ji=e=>({applyToStack:t=>{t.add(Ui(e),Hi)}}),Li=()=>(e,t)=>async r=>{var s,n;try{const i=await e(r),{clientName:o,commandName:a,logger:c,dynamoDbDocumentClientOptions:u={}}=t,{overrideInputFilterSensitiveLog:l,overrideOutputFilterSensitiveLog:d}=u,f=l??t.inputFilterSensitiveLog,h=d??t.outputFilterSensitiveLog,{$metadata:m,...y}=i.output;return(s=c==null?void 0:c.info)==null||s.call(c,{clientName:o,commandName:a,input:f(r.input),output:h(y),metadata:m}),i}catch(i){const{clientName:o,commandName:a,logger:c,dynamoDbDocumentClientOptions:u={}}=t,{overrideInputFilterSensitiveLog:l}=u,d=l??t.inputFilterSensitiveLog;throw(n=c==null?void 0:c.error)==null||n.call(c,{clientName:o,commandName:a,input:d(r.input),error:i,metadata:i.$metadata}),i}},zi={name:"loggerMiddleware",tags:["LOGGER"],step:"initialize",override:!0},qi=e=>({applyToStack:t=>{t.add(Li(),zi)}}),Gi={step:"build",tags:["RECURSION_DETECTION"],name:"recursionDetectionMiddleware",override:!0,priority:"low"},Wi=()=>e=>async t=>e(t),Vi=e=>({applyToStack:t=>{t.add(Wi(),Gi)}}),St=e=>e[Br]||(e[Br]={}),ie=e=>{if(typeof e=="function")return e;const t=Promise.resolve(e);return()=>t},Ji=(e,t)=>{if(!t||t.length===0)return e;const r=[];for(const s of t)for(const n of e)n.schemeId.split("#")[1]===s&&r.push(n);for(const s of e)r.find(({schemeId:n})=>n===s.schemeId)||r.push(s);return r};function Ki(e){const t=new Map;for(const r of e)t.set(r.schemeId,r);return t}const Xi=(e,t)=>(r,s)=>async n=>{var d;const i=e.httpAuthSchemeProvider(await t.httpAuthSchemeParametersProvider(e,s,n.input)),o=e.authSchemePreference?await e.authSchemePreference():[],a=Ji(i,o),c=Ki(e.httpAuthSchemes),u=St(s),l=[];for(const f of a){const h=c.get(f.schemeId);if(!h){l.push(`HttpAuthScheme \`${f.schemeId}\` was not enabled for this service.`);continue}const m=h.identityProvider(await t.identityProviderConfigProvider(e));if(!m){l.push(`HttpAuthScheme \`${f.schemeId}\` did not have an IdentityProvider configured.`);continue}const{identityProperties:y={},signingProperties:w={}}=((d=f.propertiesExtractor)==null?void 0:d.call(f,e,s))||{};f.identityProperties=Object.assign(f.identityProperties||{},y),f.signingProperties=Object.assign(f.signingProperties||{},w),u.selectedHttpAuthScheme={httpAuthOption:f,identity:await m(f.identityProperties),signer:h.signer};break}if(!u.selectedHttpAuthScheme)throw new Error(l.join(`
`));return r(n)},Qi={step:"serialize",tags:["HTTP_AUTH_SCHEME"],name:"httpAuthSchemeMiddleware",override:!0,relation:"before",toMiddleware:"endpointV2Middleware"},Yi=(e,{httpAuthSchemeParametersProvider:t,identityProviderConfigProvider:r})=>({applyToStack:s=>{s.addRelativeTo(Xi(e,{httpAuthSchemeParametersProvider:t,identityProviderConfigProvider:r}),Qi)}}),Zi=e=>t=>{throw t},eo=(e,t)=>{},to=e=>(t,r)=>async s=>{if(!F.isInstance(s.request))return t(s);const i=St(r).selectedHttpAuthScheme;if(!i)throw new Error("No HttpAuthScheme was selected: unable to sign request");const{httpAuthOption:{signingProperties:o={}},identity:a,signer:c}=i,u=await t({...s,request:await c.sign(s.request,a,o)}).catch((c.errorHandler||Zi)(o));return(c.successHandler||eo)(u.response,o),u},ro={step:"finalizeRequest",tags:["HTTP_SIGNING"],name:"httpSigningMiddleware",aliases:["apiKeyMiddleware","tokenMiddleware","awsAuthMiddleware"],override:!0,relation:"after",toMiddleware:"retryMiddleware"},so=e=>({applyToStack:t=>{t.addRelativeTo(to(),ro)}}),rt=e=>{if(typeof e=="function")return e;const t=Promise.resolve(e);return()=>t},rn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",$r=Object.entries(rn).reduce((e,[t,r])=>(e[r]=Number(t),e),{}),no=rn.split(""),He=6,st=8,io=63,Ve=e=>{let t=e.length/4*3;e.slice(-2)==="=="?t-=2:e.slice(-1)==="="&&t--;const r=new ArrayBuffer(t),s=new DataView(r);for(let n=0;n<e.length;n+=4){let i=0,o=0;for(let u=n,l=n+3;u<=l;u++)if(e[u]!=="="){if(!(e[u]in $r))throw new TypeError(`Invalid character ${e[u]} in base64 string.`);i|=$r[e[u]]<<(l-u)*He,o+=He}else i>>=He;const a=n/4*3;i>>=o%st;const c=Math.floor(o/st);for(let u=0;u<c;u++){const l=(c-u-1)*st;s.setUint8(a+u,(i&255<<l)>>l)}}return new Uint8Array(r)},we=e=>new TextEncoder().encode(e),at=e=>typeof e=="string"?we(e):ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(e),Be=e=>{if(typeof e=="string")return e;if(typeof e!="object"||typeof e.byteOffset!="number"||typeof e.byteLength!="number")throw new Error("@smithy/util-utf8: toUtf8 encoder function only accepts string | Uint8Array.");return new TextDecoder("utf-8").decode(e)};function Oe(e){let t;typeof e=="string"?t=we(e):t=e;const r=typeof t=="object"&&typeof t.length=="number",s=typeof t=="object"&&typeof t.byteOffset=="number"&&typeof t.byteLength=="number";if(!r&&!s)throw new Error("@smithy/util-base64: toBase64 encoder function only accepts string | Uint8Array.");let n="";for(let i=0;i<t.length;i+=3){let o=0,a=0;for(let u=i,l=Math.min(i+3,t.length);u<l;u++)o|=t[u]<<(l-u-1)*st,a+=st;const c=Math.ceil(a/He);o<<=c*He-a;for(let u=1;u<=c;u++){const l=(c-u)*He;n+=no[(o&io<<l)>>l]}n+="==".slice(0,4-c)}return n}class Ie extends Uint8Array{static fromString(t,r="utf-8"){if(typeof t=="string")return r==="base64"?Ie.mutate(Ve(t)):Ie.mutate(we(t));throw new Error(`Unsupported conversion from ${typeof t} to Uint8ArrayBlobAdapter.`)}static mutate(t){return Object.setPrototypeOf(t,Ie.prototype),t}transformToString(t="utf-8"){return t==="base64"?Oe(this):Be(this)}}const Nr=e=>{var t;return typeof ReadableStream=="function"&&(((t=e==null?void 0:e.constructor)==null?void 0:t.name)===ReadableStream.name||e instanceof ReadableStream)},Me=e=>encodeURIComponent(e).replace(/[!'()*]/g,oo),oo=e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`;function ao(e){const t=[];for(let r of Object.keys(e).sort()){const s=e[r];if(r=Me(r),Array.isArray(s))for(let n=0,i=s.length;n<i;n++)t.push(`${r}=${Me(s[n])}`);else{let n=r;(s||typeof s=="string")&&(n+=`=${Me(s)}`),t.push(n)}}return t.join("&")}function kr(e,t){return new Request(e,t)}function co(e=0){return new Promise((t,r)=>{e&&setTimeout(()=>{const s=new Error(`Request did not complete within ${e} ms`);s.name="TimeoutError",r(s)},e)})}const Vt={supported:void 0};class mr{constructor(t){p(this,"config");p(this,"configProvider");typeof t=="function"?this.configProvider=t().then(r=>r||{}):(this.config=t??{},this.configProvider=Promise.resolve(this.config)),Vt.supported===void 0&&(Vt.supported=typeof Request<"u"&&"keepalive"in kr("https://[::1]"))}static create(t){return typeof(t==null?void 0:t.handle)=="function"?t:new mr(t)}destroy(){}async handle(t,{abortSignal:r,requestTimeout:s}={}){var b;this.config||(this.config=await this.configProvider);const n=s??this.config.requestTimeout,i=this.config.keepAlive===!0,o=this.config.credentials;if(r!=null&&r.aborted){const x=new Error("Request aborted");return x.name="AbortError",Promise.reject(x)}let a=t.path;const c=ao(t.query||{});c&&(a+=`?${c}`),t.fragment&&(a+=`#${t.fragment}`);let u="";if(t.username!=null||t.password!=null){const x=t.username??"",C=t.password??"";u=`${x}:${C}@`}const{port:l,method:d}=t,f=`${t.protocol}//${u}${t.hostname}${l?`:${l}`:""}${a}`,h=d==="GET"||d==="HEAD"?void 0:t.body,m={body:h,headers:new Headers(t.headers),method:d,credentials:o};(b=this.config)!=null&&b.cache&&(m.cache=this.config.cache),h&&(m.duplex="half"),typeof AbortController<"u"&&(m.signal=r),Vt.supported&&(m.keepalive=i),typeof this.config.requestInit=="function"&&Object.assign(m,this.config.requestInit(t));let y=()=>{};const w=kr(f,m),S=[fetch(w).then(x=>{const C=x.headers,R={};for(const O of C.entries())R[O[0]]=O[1];return x.body!=null?{response:new We({headers:R,reason:x.statusText,statusCode:x.status,body:x.body})}:x.blob().then(O=>({response:new We({headers:R,reason:x.statusText,statusCode:x.status,body:O})}))}),co(n)];return r&&S.push(new Promise((x,C)=>{const R=()=>{const v=new Error("Request aborted");v.name="AbortError",C(v)};if(typeof r.addEventListener=="function"){const v=r;v.addEventListener("abort",R,{once:!0}),y=()=>v.removeEventListener("abort",R)}else r.onabort=R})),Promise.race(S).finally(y)}updateHttpClientConfig(t,r){this.config=void 0,this.configProvider=this.configProvider.then(s=>(s[t]=r,s))}httpHandlerConfigs(){return this.config??{}}}const sn=async e=>{var t;return typeof Blob=="function"&&e instanceof Blob||((t=e.constructor)==null?void 0:t.name)==="Blob"?Blob.prototype.arrayBuffer!==void 0?new Uint8Array(await e.arrayBuffer()):uo(e):lo(e)};async function uo(e){const t=await fo(e),r=Ve(t);return new Uint8Array(r)}async function lo(e){const t=[],r=e.getReader();let s=!1,n=0;for(;!s;){const{done:a,value:c}=await r.read();c&&(t.push(c),n+=c.length),s=a}const i=new Uint8Array(n);let o=0;for(const a of t)i.set(a,o),o+=a.length;return i}function fo(e){return new Promise((t,r)=>{const s=new FileReader;s.onloadend=()=>{if(s.readyState!==2)return r(new Error("Reader aborted too early"));const n=s.result??"",i=n.indexOf(","),o=i>-1?i+1:n.length;t(n.substring(o))},s.onabort=()=>r(new Error("Read aborted")),s.onerror=()=>r(s.error),s.readAsDataURL(e)})}const nn={},ar={};for(let e=0;e<256;e++){let t=e.toString(16).toLowerCase();t.length===1&&(t=`0${t}`),nn[e]=t,ar[t]=e}function on(e){if(e.length%2!==0)throw new Error("Hex encoded strings must have an even number length");const t=new Uint8Array(e.length/2);for(let r=0;r<e.length;r+=2){const s=e.slice(r,r+2).toLowerCase();if(s in ar)t[r/2]=ar[s];else throw new Error(`Cannot decode unrecognized sequence ${s} as hexadecimal`)}return t}function _(e){let t="";for(let r=0;r<e.byteLength;r++)t+=nn[e[r]];return t}const Pr="The stream has already been transformed.",ho=e=>{var n,i;if(!_r(e)&&!Nr(e)){const o=((i=(n=e==null?void 0:e.__proto__)==null?void 0:n.constructor)==null?void 0:i.name)||e;throw new Error(`Unexpected stream implementation, expect Blob or ReadableStream, got ${o}`)}let t=!1;const r=async()=>{if(t)throw new Error(Pr);return t=!0,await sn(e)},s=o=>{if(typeof o.stream!="function")throw new Error(`Cannot transform payload Blob to web stream. Please make sure the Blob.stream() is polyfilled.
If you are using React Native, this API is not yet supported, see: https://react-native.canny.io/feature-requests/p/fetch-streaming-body`);return o.stream()};return Object.assign(e,{transformToByteArray:r,transformToString:async o=>{const a=await r();if(o==="base64")return Oe(a);if(o==="hex")return _(a);if(o===void 0||o==="utf8"||o==="utf-8")return Be(a);if(typeof TextDecoder=="function")return new TextDecoder(o).decode(a);throw new Error("TextDecoder is not available, please make sure polyfill is provided.")},transformToWebStream:()=>{if(t)throw new Error(Pr);if(t=!0,_r(e))return s(e);if(Nr(e))return e;throw new Error(`Cannot transform payload to web stream, got ${e}`)}})},_r=e=>typeof Blob=="function"&&e instanceof Blob,Ze=async(e=new Uint8Array,t)=>{if(e instanceof Uint8Array)return Ie.mutate(e);if(!e)return Ie.mutate(new Uint8Array);const r=t.streamCollector(e);return Ie.mutate(await r)};function Fr(e){return encodeURIComponent(e).replace(/[!'()*]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()})}const Jt=e=>typeof e=="function"?e():e,an=(e,t,r,s,n)=>({name:t,namespace:e,traits:r,input:s,output:n}),po=e=>(t,r)=>async s=>{var d,f,h,m;const{response:n}=await t(s),{operationSchema:i}=St(r),[,o,a,c,u,l]=i??[];try{const y=await e.protocol.deserializeResponse(an(o,a,c,u,l),{...e,...r},n);return{response:n,output:y}}catch(y){if(Object.defineProperty(y,"$response",{value:n,enumerable:!1,writable:!1,configurable:!1}),!("$metadata"in y)){const w="Deserialization error: to see the raw response, inspect the hidden field {error}.$response on this object.";try{y.message+=`
  `+w}catch{!r.logger||((f=(d=r.logger)==null?void 0:d.constructor)==null?void 0:f.name)==="NoOpLogger"?console.warn(w):(m=(h=r.logger)==null?void 0:h.warn)==null||m.call(h,w)}typeof y.$responseBodyText<"u"&&y.$response&&(y.$response.body=y.$responseBodyText);try{if(We.isInstance(n)){const{headers:S={}}=n,b=Object.entries(S);y.$metadata={httpStatusCode:n.statusCode,requestId:Kt(/^x-[\w-]+-request-?id$/,b),extendedRequestId:Kt(/^x-[\w-]+-id-2$/,b),cfId:Kt(/^x-[\w-]+-cf-id$/,b)}}}catch{}}throw y}},Kt=(e,t)=>(t.find(([r])=>r.match(e))||[void 0,void 0])[1],mo=e=>(t,r)=>async s=>{var f;const{operationSchema:n}=St(r),[,i,o,a,c,u]=n??[],l=(f=r.endpointV2)!=null&&f.url&&e.urlParser?async()=>e.urlParser(r.endpointV2.url):e.endpoint,d=await e.protocol.serializeRequest(an(i,o,a,c,u),s.input,{...e,...r,endpoint:l});return t({...s,request:d})},go={name:"deserializerMiddleware",step:"deserialize",tags:["DESERIALIZER"],override:!0},yo={name:"serializerMiddleware",step:"serialize",tags:["SERIALIZER"],override:!0};function wo(e){return{applyToStack:t=>{t.add(mo(e),yo),t.add(po(e),go),e.protocol.setSerdeContext(e)}}}function Ue(e){if(typeof e=="object")return e;e=e|0;const t={};let r=0;for(const s of["httpLabel","idempotent","idempotencyToken","sensitive","httpPayload","httpResponseCode","httpQueryParams"])(e>>r++&1)===1&&(t[s]=1);return t}const le=class le{constructor(t,r){p(this,"ref");p(this,"memberName");p(this,"symbol",le.symbol);p(this,"name");p(this,"schema");p(this,"_isMemberSchema");p(this,"traits");p(this,"memberTraits");p(this,"normalizedTraits");this.ref=t,this.memberName=r;const s=[];let n=t,i=t;for(this._isMemberSchema=!1;Xt(n);)s.push(n[1]),n=n[0],i=Jt(n),this._isMemberSchema=!0;if(s.length>0){this.memberTraits={};for(let o=s.length-1;o>=0;--o){const a=s[o];Object.assign(this.memberTraits,Ue(a))}}else this.memberTraits=0;if(i instanceof le){const o=this.memberTraits;Object.assign(this,i),this.memberTraits=Object.assign({},o,i.getMemberTraits(),this.getMemberTraits()),this.normalizedTraits=void 0,this.memberName=r??i.memberName;return}if(this.schema=Jt(i),So(this.schema)?(this.name=`${this.schema[1]}#${this.schema[2]}`,this.traits=this.schema[3]):(this.name=this.memberName??String(i),this.traits=0),this._isMemberSchema&&!r)throw new Error(`@smithy/core/schema - NormalizedSchema member init ${this.getName(!0)} missing member name.`)}static[Symbol.hasInstance](t){const r=this.prototype.isPrototypeOf(t);return!r&&typeof t=="object"&&t!==null?t.symbol===this.symbol:r}static of(t){const r=Jt(t);if(r instanceof le)return r;if(Xt(r)){const[s,n]=r;if(s instanceof le)return Object.assign(s.getMergedTraits(),Ue(n)),s;throw new Error(`@smithy/core/schema - may not init unwrapped member schema=${JSON.stringify(t,null,2)}.`)}return new le(r)}getSchema(){const t=this.schema;return t[0]===0?t[4]:t}getName(t=!1){const{name:r}=this;return!t&&r&&r.includes("#")?r.split("#")[1]:r||void 0}getMemberName(){return this.memberName}isMemberSchema(){return this._isMemberSchema}isListSchema(){const t=this.getSchema();return typeof t=="number"?t>=64&&t<128:t[0]===1}isMapSchema(){const t=this.getSchema();return typeof t=="number"?t>=128&&t<=255:t[0]===2}isStructSchema(){const t=this.getSchema();return t[0]===3||t[0]===-3}isBlobSchema(){const t=this.getSchema();return t===21||t===42}isTimestampSchema(){const t=this.getSchema();return typeof t=="number"&&t>=4&&t<=7}isUnitSchema(){return this.getSchema()==="unit"}isDocumentSchema(){return this.getSchema()===15}isStringSchema(){return this.getSchema()===0}isBooleanSchema(){return this.getSchema()===2}isNumericSchema(){return this.getSchema()===1}isBigIntegerSchema(){return this.getSchema()===17}isBigDecimalSchema(){return this.getSchema()===19}isStreaming(){const{streaming:t}=this.getMergedTraits();return!!t||this.getSchema()===42}isIdempotencyToken(){const t=i=>(i&4)===4||!!(i!=null&&i.idempotencyToken),{normalizedTraits:r,traits:s,memberTraits:n}=this;return t(r)||t(s)||t(n)}getMergedTraits(){return this.normalizedTraits??(this.normalizedTraits={...this.getOwnTraits(),...this.getMemberTraits()})}getMemberTraits(){return Ue(this.memberTraits)}getOwnTraits(){return Ue(this.traits)}getKeySchema(){const[t,r]=[this.isDocumentSchema(),this.isMapSchema()];if(!t&&!r)throw new Error(`@smithy/core/schema - cannot get key for non-map: ${this.getName(!0)}`);const s=this.getSchema(),n=t?15:s[4]??0;return Qe([n,0],"key")}getValueSchema(){const t=this.getSchema(),[r,s,n]=[this.isDocumentSchema(),this.isMapSchema(),this.isListSchema()],i=typeof t=="number"?63&t:t&&typeof t=="object"&&(s||n)?t[3+t[0]]:r?15:void 0;if(i!=null)return Qe([i,0],s?"value":"member");throw new Error(`@smithy/core/schema - ${this.getName(!0)} has no value member.`)}getMemberSchema(t){const r=this.getSchema();if(this.isStructSchema()&&r[4].includes(t)){const s=r[4].indexOf(t),n=r[5][s];return Qe(Xt(n)?n:[n,0],t)}if(this.isDocumentSchema())return Qe([15,0],t);throw new Error(`@smithy/core/schema - ${this.getName(!0)} has no no member=${t}.`)}getMemberSchemas(){const t={};try{for(const[r,s]of this.structIterator())t[r]=s}catch{}return t}getEventStreamMember(){if(this.isStructSchema()){for(const[t,r]of this.structIterator())if(r.isStreaming()&&r.isStructSchema())return t}return""}*structIterator(){if(this.isUnitSchema())return;if(!this.isStructSchema())throw new Error("@smithy/core/schema - cannot iterate non-struct schema.");const t=this.getSchema();for(let r=0;r<t[4].length;++r)yield[t[4][r],Qe([t[5][r],0],t[4][r])]}};p(le,"symbol",Symbol.for("@smithy/nor"));let D=le;function Qe(e,t){if(e instanceof D)return Object.assign(e,{memberName:t,_isMemberSchema:!0});const r=D;return new r(e,t)}const Xt=e=>Array.isArray(e)&&e.length===2,So=e=>Array.isArray(e)&&e.length>=5,K=class K{constructor(t,r=new Map,s=new Map){p(this,"namespace");p(this,"schemas");p(this,"exceptions");this.namespace=t,this.schemas=r,this.exceptions=s}static for(t){return K.registries.has(t)||K.registries.set(t,new K(t)),K.registries.get(t)}register(t,r){const s=this.normalizeShapeId(t);K.for(s.split("#")[0]).schemas.set(s,r)}getSchema(t){const r=this.normalizeShapeId(t);if(!this.schemas.has(r))throw new Error(`@smithy/core/schema - schema not found for ${r}`);return this.schemas.get(r)}registerError(t,r){const s=t,n=K.for(s[1]);n.schemas.set(s[1]+"#"+s[2],s),n.exceptions.set(s,r)}getErrorCtor(t){const r=t;return K.for(r[1]).exceptions.get(r)}getBaseException(){for(const t of this.exceptions.keys())if(Array.isArray(t)){const[,r,s]=t,n=r+"#"+s;if(n.startsWith("smithy.ts.sdk.synthetic.")&&n.endsWith("ServiceException"))return t}}find(t){return[...this.schemas.values()].find(t)}clear(){this.schemas.clear(),this.exceptions.clear()}normalizeShapeId(t){return t.includes("#")?t:this.namespace+"#"+t}};p(K,"registries",new Map);let ct=K;const cr=e=>{if(e!=null){if(typeof e=="string"){const t=parseFloat(e);if(!Number.isNaN(t))return String(t)!==String(e)&&Do.warn(vo(`Expected number but observed string: ${e}`)),t}if(typeof e=="number")return e;throw new TypeError(`Expected number, got ${typeof e}: ${e}`)}},bo=Math.ceil(2**127*(2-2**-23)),Ur=e=>{const t=cr(e);if(t!==void 0&&!Number.isNaN(t)&&t!==1/0&&t!==-1/0&&Math.abs(t)>bo)throw new TypeError(`Expected 32-bit float, got ${e}`);return t},xo=e=>{if(e!=null){if(Number.isInteger(e)&&!Number.isNaN(e))return e;throw new TypeError(`Expected integer, got ${typeof e}: ${e}`)}},Hr=e=>cn(e,16),jr=e=>cn(e,8),cn=(e,t)=>{const r=xo(e);if(r!==void 0&&Eo(r,t)!==r)throw new TypeError(`Expected ${t}-bit integer, got ${e}`);return r},Eo=(e,t)=>{switch(t){case 32:return Int32Array.of(e)[0];case 16:return Int16Array.of(e)[0];case 8:return Int8Array.of(e)[0]}},Ao=e=>cr(typeof e=="string"?Ft(e):e),Co=e=>Ur(typeof e=="string"?Ft(e):e),To=/(-?(?:0|[1-9]\d*)(?:\.\d+)?(?:[eE][+-]?\d+)?)|(-?Infinity)|(NaN)/g,Ft=e=>{const t=e.match(To);if(t===null||t[0].length!==e.length)throw new TypeError("Expected real number, got implicit NaN");return parseFloat(e)},Ot=e=>Hr(typeof e=="string"?Ft(e):e),Ro=e=>jr(typeof e=="string"?Ft(e):e),vo=e=>String(new TypeError(e).stack||e).split(`
`).slice(0,5).filter(t=>!t.includes("stackTraceWarning")).join(`
`),Do={warn:console.warn},Io=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],gr=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function un(e){const t=e.getUTCFullYear(),r=e.getUTCMonth(),s=e.getUTCDay(),n=e.getUTCDate(),i=e.getUTCHours(),o=e.getUTCMinutes(),a=e.getUTCSeconds(),c=n<10?`0${n}`:`${n}`,u=i<10?`0${i}`:`${i}`,l=o<10?`0${o}`:`${o}`,d=a<10?`0${a}`:`${a}`;return`${Io[s]}, ${c} ${gr[r]} ${t} ${u}:${l}:${d} GMT`}const Mo=new RegExp(/^(\d{4})-(\d{2})-(\d{2})[tT](\d{2}):(\d{2}):(\d{2})(?:\.(\d+))?(([-+]\d{2}\:\d{2})|[zZ])$/),Oo=e=>{if(e==null)return;if(typeof e!="string")throw new TypeError("RFC-3339 date-times must be expressed as strings");const t=Mo.exec(e);if(!t)throw new TypeError("Invalid RFC-3339 date-time value");const[r,s,n,i,o,a,c,u,l]=t,d=Ot(ut(s)),f=ye(n,"month",1,12),h=ye(i,"day",1,31),m=Rt(d,f,h,{hours:o,minutes:a,seconds:c,fractionalMilliseconds:u});return l.toUpperCase()!="Z"&&m.setTime(m.getTime()-qo(l)),m},Bo=new RegExp(/^(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d{2}) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d{1,2}):(\d{2}):(\d{2})(?:\.(\d+))? GMT$/),$o=new RegExp(/^(?:Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d{2})-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d{2}) (\d{1,2}):(\d{2}):(\d{2})(?:\.(\d+))? GMT$/),No=new RegExp(/^(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( [1-9]|\d{2}) (\d{1,2}):(\d{2}):(\d{2})(?:\.(\d+))? (\d{4})$/),ko=e=>{if(e==null)return;if(typeof e!="string")throw new TypeError("RFC-7231 date-times must be expressed as strings");let t=Bo.exec(e);if(t){const[r,s,n,i,o,a,c,u]=t;return Rt(Ot(ut(i)),Qt(n),ye(s,"day",1,31),{hours:o,minutes:a,seconds:c,fractionalMilliseconds:u})}if(t=$o.exec(e),t){const[r,s,n,i,o,a,c,u]=t;return Uo(Rt(_o(i),Qt(n),ye(s,"day",1,31),{hours:o,minutes:a,seconds:c,fractionalMilliseconds:u}))}if(t=No.exec(e),t){const[r,s,n,i,o,a,c,u]=t;return Rt(Ot(ut(u)),Qt(s),ye(n.trimLeft(),"day",1,31),{hours:i,minutes:o,seconds:a,fractionalMilliseconds:c})}throw new TypeError("Invalid RFC-7231 date-time value")},Po=e=>{if(e==null)return;let t;if(typeof e=="number")t=e;else if(typeof e=="string")t=Ao(e);else if(typeof e=="object"&&e.tag===1)t=e.value;else throw new TypeError("Epoch timestamps must be expressed as floating point numbers or their string representation");if(Number.isNaN(t)||t===1/0||t===-1/0)throw new TypeError("Epoch timestamps must be valid, non-Infinite, non-NaN numerics");return new Date(Math.round(t*1e3))},Rt=(e,t,r,s)=>{const n=t-1;return jo(e,n,r),new Date(Date.UTC(e,n,r,ye(s.hours,"hour",0,23),ye(s.minutes,"minute",0,59),ye(s.seconds,"seconds",0,60),zo(s.fractionalMilliseconds)))},_o=e=>{const t=new Date().getUTCFullYear(),r=Math.floor(t/100)*100+Ot(ut(e));return r<t?r+100:r},Fo=50*365*24*60*60*1e3,Uo=e=>e.getTime()-new Date().getTime()>Fo?new Date(Date.UTC(e.getUTCFullYear()-100,e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds())):e,Qt=e=>{const t=gr.indexOf(e);if(t<0)throw new TypeError(`Invalid month: ${e}`);return t+1},Ho=[31,28,31,30,31,30,31,31,30,31,30,31],jo=(e,t,r)=>{let s=Ho[t];if(t===1&&Lo(e)&&(s=29),r>s)throw new TypeError(`Invalid day for ${gr[t]} in ${e}: ${r}`)},Lo=e=>e%4===0&&(e%100!==0||e%400===0),ye=(e,t,r,s)=>{const n=Ro(ut(e));if(n<r||n>s)throw new TypeError(`${t} must be between ${r} and ${s}, inclusive`);return n},zo=e=>e==null?0:Co("0."+e)*1e3,qo=e=>{const t=e[0];let r=1;if(t=="+")r=1;else if(t=="-")r=-1;else throw new TypeError(`Offset direction, ${t}, must be "+" or "-"`);const s=Number(e.substring(1,3)),n=Number(e.substring(4,6));return r*(s*60+n)*60*1e3},ut=e=>{let t=0;for(;t<e.length-1&&e.charAt(t)==="0";)t++;return t===0?e:e.slice(t)},Lr=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),$=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0")),yr=()=>{if(Lr)return Lr();const e=new Uint8Array(16);return crypto.getRandomValues(e),e[6]=e[6]&15|64,e[8]=e[8]&63|128,$[e[0]]+$[e[1]]+$[e[2]]+$[e[3]]+"-"+$[e[4]]+$[e[5]]+"-"+$[e[6]]+$[e[7]]+"-"+$[e[8]]+$[e[9]]+"-"+$[e[10]]+$[e[11]]+$[e[12]]+$[e[13]]+$[e[14]]+$[e[15]]},Y=function(t){return Object.assign(new String(t),{deserializeJSON(){return JSON.parse(String(t))},toString(){return String(t)},toJSON(){return String(t)}})};Y.from=e=>e&&typeof e=="object"&&(e instanceof Y||"deserializeJSON"in e)?e:typeof e=="string"||Object.getPrototypeOf(e)===String.prototype?Y(String(e)):Y(JSON.stringify(e));Y.fromObject=Y.from;function Go(e){return(e.includes(",")||e.includes('"'))&&(e=`"${e.replace(/"/g,'\\"')}"`),e}const wr="(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun)(?:[ne|u?r]?s?day)?",Sr="(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)",br="(\\d?\\d):(\\d{2}):(\\d{2})(?:\\.(\\d+))?",ln="(\\d?\\d)",dn="(\\d{4})",Wo=new RegExp(/^(\d{4})-(\d\d)-(\d\d)[tT](\d\d):(\d\d):(\d\d)(\.(\d+))?(([-+]\d\d:\d\d)|[zZ])$/),Vo=new RegExp(`^${wr}, ${ln} ${Sr} ${dn} ${br} GMT$`),Jo=new RegExp(`^${wr}, ${ln}-${Sr}-(\\d\\d) ${br} GMT$`),Ko=new RegExp(`^${wr} ${Sr} ( [1-9]|\\d\\d) ${br} ${dn}$`),Xo=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Qo=e=>{if(e==null)return;let t=NaN;if(typeof e=="number")t=e;else if(typeof e=="string"){if(!/^-?\d*\.?\d+$/.test(e))throw new TypeError("parseEpochTimestamp - numeric string invalid.");t=Number.parseFloat(e)}else typeof e=="object"&&e.tag===1&&(t=e.value);if(isNaN(t)||Math.abs(t)===1/0)throw new TypeError("Epoch timestamps must be valid finite numbers.");return new Date(Math.round(t*1e3))},Yo=e=>{if(e==null)return;if(typeof e!="string")throw new TypeError("RFC3339 timestamps must be strings");const t=Wo.exec(e);if(!t)throw new TypeError(`Invalid RFC3339 timestamp format ${e}`);const[,r,s,n,i,o,a,,c,u]=t;ne(s,1,12),ne(n,1,31),ne(i,0,23),ne(o,0,59),ne(a,0,60);const l=new Date(Date.UTC(Number(r),Number(s)-1,Number(n),Number(i),Number(o),Number(a),Number(c)?Math.round(parseFloat(`0.${c}`)*1e3):0));if(l.setUTCFullYear(Number(r)),u.toUpperCase()!="Z"){const[,d,f,h]=/([+-])(\d\d):(\d\d)/.exec(u)||[void 0,"+",0,0],m=d==="-"?1:-1;l.setTime(l.getTime()+m*(Number(f)*60*60*1e3+Number(h)*60*1e3))}return l},Zo=e=>{if(e==null)return;if(typeof e!="string")throw new TypeError("RFC7231 timestamps must be strings.");let t,r,s,n,i,o,a,c;if((c=Vo.exec(e))?[,t,r,s,n,i,o,a]=c:(c=Jo.exec(e))?([,t,r,s,n,i,o,a]=c,s=(Number(s)+1900).toString()):(c=Ko.exec(e))&&([,r,t,n,i,o,a,s]=c),s&&o){const u=Date.UTC(Number(s),Xo.indexOf(r),Number(t),Number(n),Number(i),Number(o),a?Math.round(parseFloat(`0.${a}`)*1e3):0);ne(t,1,31),ne(n,0,23),ne(i,0,59),ne(o,0,60);const l=new Date(u);return l.setUTCFullYear(Number(s)),l}throw new TypeError(`Invalid RFC7231 date-time value ${e}.`)};function ne(e,t,r){const s=Number(e);if(s<t||s>r)throw new Error(`Value ${s} out of range [${t}, ${r}]`)}function ea(e,t,r){if(!Number.isInteger(r))throw new Error("Invalid number of delimiters ("+r+") for splitEvery.");const s=e.split(t),n=[];let i="";for(let o=0;o<s.length;o++)i===""?i=s[o]:i+=t+s[o],(o+1)%r===0&&(n.push(i),i="");return i!==""&&n.push(i),n}const fn=e=>{const t=e.length,r=[];let s=!1,n,i=0;for(let o=0;o<t;++o){const a=e[o];switch(a){case'"':n!=="\\"&&(s=!s);break;case",":s||(r.push(e.slice(i,o)),i=o+1);break}n=a}return r.push(e.slice(i)),r.map(o=>{o=o.trim();const a=o.length;return a<2?o:(o[0]==='"'&&o[a-1]==='"'&&(o=o.slice(1,a-1)),o.replace(/\\"/g,'"'))})},zr=/^-?\d*(\.\d+)?$/;class W{constructor(t,r){p(this,"string");p(this,"type");if(this.string=t,this.type=r,!zr.test(t))throw new Error('@smithy/core/serde - NumericValue must only contain [0-9], at most one decimal point ".", and an optional negation prefix "-".')}toString(){return this.string}static[Symbol.hasInstance](t){if(!t||typeof t!="object")return!1;const r=t;return W.prototype.isPrototypeOf(t)||r.type==="bigDecimal"&&zr.test(r.string)}}class Ut{constructor(){p(this,"serdeContext")}setSerdeContext(t){this.serdeContext=t}}class ta extends Ut{constructor(r){super();p(this,"options");this.options=r}getRequestType(){return F}getResponseType(){return We}setSerdeContext(r){this.serdeContext=r,this.serializer.setSerdeContext(r),this.deserializer.setSerdeContext(r),this.getPayloadCodec()&&this.getPayloadCodec().setSerdeContext(r)}updateServiceEndpoint(r,s){if("url"in s){r.protocol=s.url.protocol,r.hostname=s.url.hostname,r.port=s.url.port?Number(s.url.port):void 0,r.path=s.url.pathname,r.fragment=s.url.hash||void 0,r.username=s.url.username||void 0,r.password=s.url.password||void 0,r.query||(r.query={});for(const[n,i]of s.url.searchParams.entries())r.query[n]=i;return r}else return r.protocol=s.protocol,r.hostname=s.hostname,r.port=s.port?Number(s.port):void 0,r.path=s.path,r.query={...s.query},r}setHostPrefix(r,s,n){var a;const i=D.of(s.input),o=Ue(s.traits??{});if(o.endpoint){let c=(a=o.endpoint)==null?void 0:a[0];if(typeof c=="string"){const u=[...i.structIterator()].filter(([,l])=>l.getMergedTraits().hostLabel);for(const[l]of u){const d=n[l];if(typeof d!="string")throw new Error(`@smithy/core/schema - ${l} in input must be a string as hostLabel.`);c=c.replace(`{${l}}`,d)}r.hostname=c+r.hostname}}}deserializeMetadata(r){return{httpStatusCode:r.statusCode,requestId:r.headers["x-amzn-requestid"]??r.headers["x-amzn-request-id"]??r.headers["x-amz-request-id"],extendedRequestId:r.headers["x-amz-id-2"],cfId:r.headers["x-amz-cf-id"]}}async serializeEventStream({eventStream:r,requestSchema:s,initialRequest:n}){return(await this.loadEventStreamCapability()).serializeEventStream({eventStream:r,requestSchema:s,initialRequest:n})}async deserializeEventStream({response:r,responseSchema:s,initialResponseContainer:n}){return(await this.loadEventStreamCapability()).deserializeEventStream({response:r,responseSchema:s,initialResponseContainer:n})}async loadEventStreamCapability(){const{EventStreamSerde:r}=await Promise.resolve().then(()=>nd);return new r({marshaller:this.getEventStreamMarshaller(),serializer:this.serializer,deserializer:this.deserializer,serdeContext:this.serdeContext,defaultContentType:this.getDefaultContentType()})}getDefaultContentType(){throw new Error(`@smithy/core/protocols - ${this.constructor.name} getDefaultContentType() implementation missing.`)}async deserializeHttpMessage(r,s,n,i,o){return[]}getEventStreamMarshaller(){const r=this.serdeContext;if(!r.eventStreamMarshaller)throw new Error("@smithy/core - HttpProtocol: eventStreamMarshaller missing in serdeContext.");return r.eventStreamMarshaller}}class ra extends ta{async serializeRequest(t,r,s){const n={...r??{}},i=this.serializer,o={},a={},c=await s.endpoint(),u=D.of(t==null?void 0:t.input),l=u.getSchema();let d=!1,f;const h=new F({protocol:"",hostname:"",port:void 0,path:"",fragment:void 0,query:o,headers:a,body:void 0});if(c){this.updateServiceEndpoint(h,c),this.setHostPrefix(h,t,n);const m=Ue(t.traits);if(m.http){h.method=m.http[0];const[y,w]=m.http[1].split("?");h.path=="/"?h.path=y:h.path+=y;const S=new URLSearchParams(w??"");Object.assign(o,Object.fromEntries(S))}}for(const[m,y]of u.structIterator()){const w=y.getMergedTraits()??{},S=n[m];if(!(S==null&&!y.isIdempotencyToken()))if(w.httpPayload)y.isStreaming()?y.isStructSchema()?n[m]&&(f=await this.serializeEventStream({eventStream:n[m],requestSchema:u})):f=S:(i.write(y,S),f=i.flush()),delete n[m];else if(w.httpLabel){i.write(y,S);const b=i.flush();h.path.includes(`{${m}+}`)?h.path=h.path.replace(`{${m}+}`,b.split("/").map(Fr).join("/")):h.path.includes(`{${m}}`)&&(h.path=h.path.replace(`{${m}}`,Fr(b))),delete n[m]}else if(w.httpHeader)i.write(y,S),a[w.httpHeader.toLowerCase()]=String(i.flush()),delete n[m];else if(typeof w.httpPrefixHeaders=="string"){for(const[b,x]of Object.entries(S)){const C=w.httpPrefixHeaders+b;i.write([y.getValueSchema(),{httpHeader:C}],x),a[C.toLowerCase()]=i.flush()}delete n[m]}else w.httpQuery||w.httpQueryParams?(this.serializeQuery(y,S,o),delete n[m]):d=!0}return d&&n&&(i.write(l,n),f=i.flush()),h.headers=a,h.query=o,h.body=f,h}serializeQuery(t,r,s){const n=this.serializer,i=t.getMergedTraits();if(i.httpQueryParams){for(const[o,a]of Object.entries(r))if(!(o in s)){const c=t.getValueSchema();Object.assign(c.getMergedTraits(),{...i,httpQuery:o,httpQueryParams:void 0}),this.serializeQuery(c,a,s)}return}if(t.isListSchema()){const o=!!t.getMergedTraits().sparse,a=[];for(const c of r){n.write([t.getValueSchema(),i],c);const u=n.flush();(o||u!==void 0)&&a.push(u)}s[i.httpQuery]=a}else n.write([t,i],r),s[i.httpQuery]=n.flush()}async deserializeResponse(t,r,s){const n=this.deserializer,i=D.of(t.output),o={};if(s.statusCode>=300){const c=await Ze(s.body,r);throw c.byteLength>0&&Object.assign(o,await n.read(15,c)),await this.handleError(t,r,s,o,this.deserializeMetadata(s)),new Error("@smithy/core/protocols - HTTP Protocol error handler failed to throw.")}for(const c in s.headers){const u=s.headers[c];delete s.headers[c],s.headers[c.toLowerCase()]=u}const a=await this.deserializeHttpMessage(i,r,s,o);if(a.length){const c=await Ze(s.body,r);if(c.byteLength>0){const u=await n.read(i,c);for(const l of a)o[l]=u[l]}}else a.discardResponseBody&&await Ze(s.body,r);return o.$metadata=this.deserializeMetadata(s),o}async deserializeHttpMessage(t,r,s,n,i){let o;n instanceof Set?o=i:o=n;let a=!0;const c=this.deserializer,u=D.of(t),l=[];for(const[d,f]of u.structIterator()){const h=f.getMemberTraits();if(h.httpPayload){if(a=!1,f.isStreaming())f.isStructSchema()?o[d]=await this.deserializeEventStream({response:s,responseSchema:u}):o[d]=ho(s.body);else if(s.body){const y=await Ze(s.body,r);y.byteLength>0&&(o[d]=await c.read(f,y))}}else if(h.httpHeader){const m=String(h.httpHeader).toLowerCase(),y=s.headers[m];if(y!=null)if(f.isListSchema()){const w=f.getValueSchema();w.getMergedTraits().httpHeader=m;let S;w.isTimestampSchema()&&w.getSchema()===4?S=ea(y,",",2):S=fn(y);const b=[];for(const x of S)b.push(await c.read(w,x.trim()));o[d]=b}else o[d]=await c.read(f,y)}else if(h.httpPrefixHeaders!==void 0){o[d]={};for(const[m,y]of Object.entries(s.headers))if(m.startsWith(h.httpPrefixHeaders)){const w=f.getValueSchema();w.getMergedTraits().httpHeader=m,o[d][m.slice(h.httpPrefixHeaders.length)]=await c.read(w,y)}}else h.httpResponseCode?o[d]=s.statusCode:l.push(d)}return l.discardResponseBody=a,l}}function Ht(e,t){if(t.timestampFormat.useTrait&&e.isTimestampSchema()&&(e.getSchema()===5||e.getSchema()===6||e.getSchema()===7))return e.getSchema();const{httpLabel:r,httpPrefixHeaders:s,httpHeader:n,httpQuery:i}=e.getMergedTraits();return(t.httpBindings?typeof s=="string"||n?6:i||r?5:void 0:void 0)??t.timestampFormat.default}class sa extends Ut{constructor(r){super();p(this,"settings");this.settings=r}read(r,s){var i;const n=D.of(r);if(n.isListSchema())return fn(s).map(o=>this.read(n.getValueSchema(),o));if(n.isBlobSchema())return(((i=this.serdeContext)==null?void 0:i.base64Decoder)??Ve)(s);if(n.isTimestampSchema())switch(Ht(n,this.settings)){case 5:return Yo(s);case 6:return Zo(s);case 7:return Qo(s);default:return console.warn("Missing timestamp format, parsing value with Date constructor:",s),new Date(s)}if(n.isStringSchema()){const o=n.getMergedTraits().mediaType;let a=s;if(o)return n.getMergedTraits().httpHeader&&(a=this.base64ToUtf8(a)),(o==="application/json"||o.endsWith("+json"))&&(a=Y.from(a)),a}return n.isNumericSchema()?Number(s):n.isBigIntegerSchema()?BigInt(s):n.isBigDecimalSchema()?new W(s,"bigDecimal"):n.isBooleanSchema()?String(s).toLowerCase()==="true":s}base64ToUtf8(r){var s,n;return(((s=this.serdeContext)==null?void 0:s.utf8Encoder)??Be)((((n=this.serdeContext)==null?void 0:n.base64Decoder)??Ve)(r))}}class na extends Ut{constructor(r,s){super();p(this,"codecDeserializer");p(this,"stringDeserializer");this.codecDeserializer=r,this.stringDeserializer=new sa(s)}setSerdeContext(r){this.stringDeserializer.setSerdeContext(r),this.codecDeserializer.setSerdeContext(r),this.serdeContext=r}read(r,s){var a,c;const n=D.of(r),i=n.getMergedTraits(),o=((a=this.serdeContext)==null?void 0:a.utf8Encoder)??Be;if(i.httpHeader||i.httpResponseCode)return this.stringDeserializer.read(n,o(s));if(i.httpPayload){if(n.isBlobSchema()){const u=((c=this.serdeContext)==null?void 0:c.utf8Decoder)??we;return typeof s=="string"?u(s):s}else if(n.isStringSchema())return"byteLength"in s?o(s):s}return this.codecDeserializer.read(n,s)}}class ia extends Ut{constructor(r){super();p(this,"settings");p(this,"stringBuffer","");this.settings=r}write(r,s){var i,o;const n=D.of(r);switch(typeof s){case"object":if(s===null){this.stringBuffer="null";return}if(n.isTimestampSchema()){if(!(s instanceof Date))throw new Error(`@smithy/core/protocols - received non-Date value ${s} when schema expected Date in ${n.getName(!0)}`);switch(Ht(n,this.settings)){case 5:this.stringBuffer=s.toISOString().replace(".000Z","Z");break;case 6:this.stringBuffer=un(s);break;case 7:this.stringBuffer=String(s.getTime()/1e3);break;default:console.warn("Missing timestamp format, using epoch seconds",s),this.stringBuffer=String(s.getTime()/1e3)}return}if(n.isBlobSchema()&&"byteLength"in s){this.stringBuffer=(((i=this.serdeContext)==null?void 0:i.base64Encoder)??Oe)(s);return}if(n.isListSchema()&&Array.isArray(s)){let u="";for(const l of s){this.write([n.getValueSchema(),n.getMergedTraits()],l);const d=this.flush(),f=n.getValueSchema().isTimestampSchema()?d:Go(d);u!==""&&(u+=", "),u+=f}this.stringBuffer=u;return}this.stringBuffer=JSON.stringify(s,null,2);break;case"string":const a=n.getMergedTraits().mediaType;let c=s;if(a&&((a==="application/json"||a.endsWith("+json"))&&(c=Y.from(c)),n.getMergedTraits().httpHeader)){this.stringBuffer=(((o=this.serdeContext)==null?void 0:o.base64Encoder)??Oe)(c.toString());return}this.stringBuffer=s;break;default:n.isIdempotencyToken()?this.stringBuffer=yr():this.stringBuffer=String(s)}}flush(){const r=this.stringBuffer;return this.stringBuffer="",r}}class oa{constructor(t,r,s=new ia(r)){p(this,"codecSerializer");p(this,"stringSerializer");p(this,"buffer");this.codecSerializer=t,this.stringSerializer=s}setSerdeContext(t){this.codecSerializer.setSerdeContext(t),this.stringSerializer.setSerdeContext(t)}write(t,r){const s=D.of(t),n=s.getMergedTraits();if(n.httpHeader||n.httpLabel||n.httpQuery){this.stringSerializer.write(s,r),this.buffer=this.stringSerializer.flush();return}return this.codecSerializer.write(s,r)}flush(){if(this.buffer!==void 0){const t=this.buffer;return this.buffer=void 0,t}return this.codecSerializer.flush()}}class aa{constructor(t){p(this,"authSchemes",new Map);for(const[r,s]of Object.entries(t))s!==void 0&&this.authSchemes.set(r,s)}getIdentityProvider(t){return this.authSchemes.get(t)}}const ca=e=>function(r){return hn(r)&&r.expiration.getTime()-Date.now()<e},ua=3e5,la=ca(ua),hn=e=>e.expiration!==void 0,da=(e,t,r)=>{if(e===void 0)return;const s=typeof e!="function"?async()=>Promise.resolve(e):e;let n,i,o,a=!1;const c=async u=>{i||(i=s(u));try{n=await i,o=!0,a=!1}finally{i=void 0}return n};return t===void 0?async u=>((!o||u!=null&&u.forceRefresh)&&(n=await c(u)),n):async u=>((!o||u!=null&&u.forceRefresh)&&(n=await c(u)),a?n:r(n)?(t(n)&&await c(u),n):(a=!0,n))},fa=void 0;function ha(e){return e===void 0?!0:typeof e=="string"&&e.length<=50}function pa(e){const t=rt(e.userAgentAppId??fa),{customUserAgent:r}=e;return Object.assign(e,{customUserAgent:typeof r=="string"?[[r]]:r,userAgentAppId:async()=>{var n,i;const s=await t();if(!ha(s)){const o=((i=(n=e.logger)==null?void 0:n.constructor)==null?void 0:i.name)==="NoOpLogger"||!e.logger?console:e.logger;typeof s!="string"?o==null||o.warn("userAgentAppId must be a string or undefined."):s.length>50&&(o==null||o.warn("The provided userAgentAppId exceeds the maximum length of 50 characters."))}return s}})}class ma{constructor({size:t,params:r}){p(this,"capacity");p(this,"data",new Map);p(this,"parameters",[]);this.capacity=t??50,r&&(this.parameters=r)}get(t,r){const s=this.hash(t);if(s===!1)return r();if(!this.data.has(s)){if(this.data.size>this.capacity+10){const n=this.data.keys();let i=0;for(;;){const{value:o,done:a}=n.next();if(this.data.delete(o),a||++i>10)break}}this.data.set(s,r())}return this.data.get(s)}size(){return this.data.size}hash(t){let r="";const{parameters:s}=this;if(s.length===0)return!1;for(const n of s){const i=String(t[n]??"");if(i.includes("|;"))return!1;r+=i+"|;"}return r}}const ga=new RegExp("^(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}$"),pn=e=>ga.test(e)||e.startsWith("[")&&e.endsWith("]"),ya=new RegExp("^(?!.*-$)(?!-)[a-zA-Z0-9-]{1,63}$"),jt=(e,t=!1)=>{if(!t)return ya.test(e);const r=e.split(".");for(const s of r)if(!jt(s))return!1;return!0},Bt={},lt="endpoints";function Se(e){return typeof e!="object"||e==null?e:"ref"in e?`$${Se(e.ref)}`:"fn"in e?`${e.fn}(${(e.argv||[]).map(Se).join(", ")})`:JSON.stringify(e,null,2)}class U extends Error{constructor(t){super(t),this.name="EndpointError"}}const wa=(e,t)=>e===t,Sa=e=>{const t=e.split("."),r=[];for(const s of t){const n=s.indexOf("[");if(n!==-1){if(s.indexOf("]")!==s.length-1)throw new U(`Path: '${e}' does not end with ']'`);const i=s.slice(n+1,-1);if(Number.isNaN(parseInt(i)))throw new U(`Invalid array index: '${i}' in path: '${e}'`);n!==0&&r.push(s.slice(0,n)),r.push(i)}else r.push(s)}return r},mn=(e,t)=>Sa(t).reduce((r,s)=>{if(typeof r!="object")throw new U(`Index '${s}' in '${t}' not found in '${JSON.stringify(e)}'`);return Array.isArray(r)?r[parseInt(s)]:r[s]},e),ba=e=>e!=null,xa=e=>!e,Yt={[ot.HTTP]:80,[ot.HTTPS]:443},Ea=e=>{const t=(()=>{try{if(e instanceof URL)return e;if(typeof e=="object"&&"hostname"in e){const{hostname:f,port:h,protocol:m="",path:y="",query:w={}}=e,S=new URL(`${m}//${f}${h?`:${h}`:""}${y}`);return S.search=Object.entries(w).map(([b,x])=>`${b}=${x}`).join("&"),S}return new URL(e)}catch{return null}})();if(!t)return console.error(`Unable to parse ${JSON.stringify(e)} as a whatwg URL.`),null;const r=t.href,{host:s,hostname:n,pathname:i,protocol:o,search:a}=t;if(a)return null;const c=o.slice(0,-1);if(!Object.values(ot).includes(c))return null;const u=pn(n),l=r.includes(`${s}:${Yt[c]}`)||typeof e=="string"&&e.includes(`${s}:${Yt[c]}`),d=`${s}${l?`:${Yt[c]}`:""}`;return{scheme:c,authority:d,path:i,normalizedPath:i.endsWith("/")?i:`${i}/`,isIp:u}},Aa=(e,t)=>e===t,Ca=(e,t,r,s)=>t>=r||e.length<r?null:s?e.substring(e.length-r,e.length-t):e.substring(t,r),Ta=e=>encodeURIComponent(e).replace(/[!*'()]/g,t=>`%${t.charCodeAt(0).toString(16).toUpperCase()}`),Ra={booleanEquals:wa,getAttr:mn,isSet:ba,isValidHostLabel:jt,not:xa,parseURL:Ea,stringEquals:Aa,substring:Ca,uriEncode:Ta},gn=(e,t)=>{const r=[],s={...t.endpointParams,...t.referenceRecord};let n=0;for(;n<e.length;){const i=e.indexOf("{",n);if(i===-1){r.push(e.slice(n));break}r.push(e.slice(n,i));const o=e.indexOf("}",i);if(o===-1){r.push(e.slice(i));break}e[i+1]==="{"&&e[o+1]==="}"&&(r.push(e.slice(i+1,o)),n=o+2);const a=e.substring(i+1,o);if(a.includes("#")){const[c,u]=a.split("#");r.push(mn(s[c],u))}else r.push(s[a]);n=o+1}return r.join("")},va=({ref:e},t)=>({...t.endpointParams,...t.referenceRecord})[e],Lt=(e,t,r)=>{if(typeof e=="string")return gn(e,r);if(e.fn)return wn.callFunction(e,r);if(e.ref)return va(e,r);throw new U(`'${t}': ${String(e)} is not a string, function or reference.`)},yn=({fn:e,argv:t},r)=>{const s=t.map(i=>["boolean","number"].includes(typeof i)?i:wn.evaluateExpression(i,"arg",r)),n=e.split(".");return n[0]in Bt&&n[1]!=null?Bt[n[0]][n[1]](...s):Ra[e](...s)},wn={evaluateExpression:Lt,callFunction:yn},Da=({assign:e,...t},r)=>{var n,i;if(e&&e in r.referenceRecord)throw new U(`'${e}' is already defined in Reference Record.`);const s=yn(t,r);return(i=(n=r.logger)==null?void 0:n.debug)==null||i.call(n,`${lt} evaluateCondition: ${Se(t)} = ${Se(s)}`),{result:s===""?!0:!!s,...e!=null&&{toAssign:{name:e,value:s}}}},xr=(e=[],t)=>{var s,n;const r={};for(const i of e){const{result:o,toAssign:a}=Da(i,{...t,referenceRecord:{...t.referenceRecord,...r}});if(!o)return{result:o};a&&(r[a.name]=a.value,(n=(s=t.logger)==null?void 0:s.debug)==null||n.call(s,`${lt} assign: ${a.name} := ${Se(a.value)}`))}return{result:!0,referenceRecord:r}},Ia=(e,t)=>Object.entries(e).reduce((r,[s,n])=>({...r,[s]:n.map(i=>{const o=Lt(i,"Header value entry",t);if(typeof o!="string")throw new U(`Header '${s}' value '${o}' is not a string`);return o})}),{}),Sn=(e,t)=>Object.entries(e).reduce((r,[s,n])=>({...r,[s]:xn.getEndpointProperty(n,t)}),{}),bn=(e,t)=>{if(Array.isArray(e))return e.map(r=>bn(r,t));switch(typeof e){case"string":return gn(e,t);case"object":if(e===null)throw new U(`Unexpected endpoint property: ${e}`);return xn.getEndpointProperties(e,t);case"boolean":return e;default:throw new U(`Unexpected endpoint property type: ${typeof e}`)}},xn={getEndpointProperty:bn,getEndpointProperties:Sn},Ma=(e,t)=>{const r=Lt(e,"Endpoint URL",t);if(typeof r=="string")try{return new URL(r)}catch(s){throw console.error(`Failed to construct URL with ${r}`,s),s}throw new U(`Endpoint URL must be a string, got ${typeof r}`)},Oa=(e,t)=>{var l,d;const{conditions:r,endpoint:s}=e,{result:n,referenceRecord:i}=xr(r,t);if(!n)return;const o={...t,referenceRecord:{...t.referenceRecord,...i}},{url:a,properties:c,headers:u}=s;return(d=(l=t.logger)==null?void 0:l.debug)==null||d.call(l,`${lt} Resolving endpoint from template: ${Se(s)}`),{...u!=null&&{headers:Ia(u,o)},...c!=null&&{properties:Sn(c,o)},url:Ma(a,o)}},Ba=(e,t)=>{const{conditions:r,error:s}=e,{result:n,referenceRecord:i}=xr(r,t);if(n)throw new U(Lt(s,"Error",{...t,referenceRecord:{...t.referenceRecord,...i}}))},En=(e,t)=>{for(const r of e)if(r.type==="endpoint"){const s=Oa(r,t);if(s)return s}else if(r.type==="error")Ba(r,t);else if(r.type==="tree"){const s=An.evaluateTreeRule(r,t);if(s)return s}else throw new U(`Unknown endpoint rule: ${r}`);throw new U("Rules evaluation failed")},$a=(e,t)=>{const{conditions:r,rules:s}=e,{result:n,referenceRecord:i}=xr(r,t);if(n)return An.evaluateRules(s,{...t,referenceRecord:{...t.referenceRecord,...i}})},An={evaluateRules:En,evaluateTreeRule:$a},Na=(e,t)=>{var u,l,d,f;const{endpointParams:r,logger:s}=t,{parameters:n,rules:i}=e;(l=(u=t.logger)==null?void 0:u.debug)==null||l.call(u,`${lt} Initial EndpointParams: ${Se(r)}`);const o=Object.entries(n).filter(([,h])=>h.default!=null).map(([h,m])=>[h,m.default]);if(o.length>0)for(const[h,m]of o)r[h]=r[h]??m;const a=Object.entries(n).filter(([,h])=>h.required).map(([h])=>h);for(const h of a)if(r[h]==null)throw new U(`Missing required parameter: '${h}'`);const c=En(i,{endpointParams:r,logger:s,referenceRecord:{}});return(f=(d=t.logger)==null?void 0:d.debug)==null||f.call(d,`${lt} Resolved endpoint: ${Se(c)}`),c},Cn=(e,t=!1)=>{if(t){for(const r of e.split("."))if(!Cn(r))return!1;return!0}return!(!jt(e)||e.length<3||e.length>63||e!==e.toLowerCase()||pn(e))},qr=":",ka="/",Pa=e=>{const t=e.split(qr);if(t.length<6)return null;const[r,s,n,i,o,...a]=t;if(r!=="arn"||s===""||n===""||a.join(qr)==="")return null;const c=a.map(u=>u.split(ka)).flat();return{partition:s,service:n,region:i,accountId:o,resourceId:c}},_a=[{id:"aws",outputs:{dnsSuffix:"amazonaws.com",dualStackDnsSuffix:"api.aws",implicitGlobalRegion:"us-east-1",name:"aws",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^(us|eu|ap|sa|ca|me|af|il|mx)\\-\\w+\\-\\d+$",regions:{"af-south-1":{description:"Africa (Cape Town)"},"ap-east-1":{description:"Asia Pacific (Hong Kong)"},"ap-east-2":{description:"Asia Pacific (Taipei)"},"ap-northeast-1":{description:"Asia Pacific (Tokyo)"},"ap-northeast-2":{description:"Asia Pacific (Seoul)"},"ap-northeast-3":{description:"Asia Pacific (Osaka)"},"ap-south-1":{description:"Asia Pacific (Mumbai)"},"ap-south-2":{description:"Asia Pacific (Hyderabad)"},"ap-southeast-1":{description:"Asia Pacific (Singapore)"},"ap-southeast-2":{description:"Asia Pacific (Sydney)"},"ap-southeast-3":{description:"Asia Pacific (Jakarta)"},"ap-southeast-4":{description:"Asia Pacific (Melbourne)"},"ap-southeast-5":{description:"Asia Pacific (Malaysia)"},"ap-southeast-6":{description:"Asia Pacific (New Zealand)"},"ap-southeast-7":{description:"Asia Pacific (Thailand)"},"aws-global":{description:"aws global region"},"ca-central-1":{description:"Canada (Central)"},"ca-west-1":{description:"Canada West (Calgary)"},"eu-central-1":{description:"Europe (Frankfurt)"},"eu-central-2":{description:"Europe (Zurich)"},"eu-north-1":{description:"Europe (Stockholm)"},"eu-south-1":{description:"Europe (Milan)"},"eu-south-2":{description:"Europe (Spain)"},"eu-west-1":{description:"Europe (Ireland)"},"eu-west-2":{description:"Europe (London)"},"eu-west-3":{description:"Europe (Paris)"},"il-central-1":{description:"Israel (Tel Aviv)"},"me-central-1":{description:"Middle East (UAE)"},"me-south-1":{description:"Middle East (Bahrain)"},"mx-central-1":{description:"Mexico (Central)"},"sa-east-1":{description:"South America (Sao Paulo)"},"us-east-1":{description:"US East (N. Virginia)"},"us-east-2":{description:"US East (Ohio)"},"us-west-1":{description:"US West (N. California)"},"us-west-2":{description:"US West (Oregon)"}}},{id:"aws-cn",outputs:{dnsSuffix:"amazonaws.com.cn",dualStackDnsSuffix:"api.amazonwebservices.com.cn",implicitGlobalRegion:"cn-northwest-1",name:"aws-cn",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^cn\\-\\w+\\-\\d+$",regions:{"aws-cn-global":{description:"aws-cn global region"},"cn-north-1":{description:"China (Beijing)"},"cn-northwest-1":{description:"China (Ningxia)"}}},{id:"aws-eusc",outputs:{dnsSuffix:"amazonaws.eu",dualStackDnsSuffix:"api.amazonwebservices.eu",implicitGlobalRegion:"eusc-de-east-1",name:"aws-eusc",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^eusc\\-(de)\\-\\w+\\-\\d+$",regions:{"eusc-de-east-1":{description:"EU (Germany)"}}},{id:"aws-iso",outputs:{dnsSuffix:"c2s.ic.gov",dualStackDnsSuffix:"api.aws.ic.gov",implicitGlobalRegion:"us-iso-east-1",name:"aws-iso",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^us\\-iso\\-\\w+\\-\\d+$",regions:{"aws-iso-global":{description:"aws-iso global region"},"us-iso-east-1":{description:"US ISO East"},"us-iso-west-1":{description:"US ISO WEST"}}},{id:"aws-iso-b",outputs:{dnsSuffix:"sc2s.sgov.gov",dualStackDnsSuffix:"api.aws.scloud",implicitGlobalRegion:"us-isob-east-1",name:"aws-iso-b",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^us\\-isob\\-\\w+\\-\\d+$",regions:{"aws-iso-b-global":{description:"aws-iso-b global region"},"us-isob-east-1":{description:"US ISOB East (Ohio)"},"us-isob-west-1":{description:"US ISOB West"}}},{id:"aws-iso-e",outputs:{dnsSuffix:"cloud.adc-e.uk",dualStackDnsSuffix:"api.cloud-aws.adc-e.uk",implicitGlobalRegion:"eu-isoe-west-1",name:"aws-iso-e",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^eu\\-isoe\\-\\w+\\-\\d+$",regions:{"aws-iso-e-global":{description:"aws-iso-e global region"},"eu-isoe-west-1":{description:"EU ISOE West"}}},{id:"aws-iso-f",outputs:{dnsSuffix:"csp.hci.ic.gov",dualStackDnsSuffix:"api.aws.hci.ic.gov",implicitGlobalRegion:"us-isof-south-1",name:"aws-iso-f",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^us\\-isof\\-\\w+\\-\\d+$",regions:{"aws-iso-f-global":{description:"aws-iso-f global region"},"us-isof-east-1":{description:"US ISOF EAST"},"us-isof-south-1":{description:"US ISOF SOUTH"}}},{id:"aws-us-gov",outputs:{dnsSuffix:"amazonaws.com",dualStackDnsSuffix:"api.aws",implicitGlobalRegion:"us-gov-west-1",name:"aws-us-gov",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^us\\-gov\\-\\w+\\-\\d+$",regions:{"aws-us-gov-global":{description:"aws-us-gov global region"},"us-gov-east-1":{description:"AWS GovCloud (US-East)"},"us-gov-west-1":{description:"AWS GovCloud (US-West)"}}}],Fa={partitions:_a};let Ua=Fa;const Ha=e=>{const{partitions:t}=Ua;for(const s of t){const{regions:n,outputs:i}=s;for(const[o,a]of Object.entries(n))if(o===e)return{...i,...a}}for(const s of t){const{regionRegex:n,outputs:i}=s;if(new RegExp(n).test(e))return{...i}}const r=t.find(s=>s.id==="aws");if(!r)throw new Error("Provided region was not found in the partition array or regex, and default partition with id 'aws' doesn't exist.");return{...r.outputs}},Tn={isVirtualHostableS3Bucket:Cn,parseArn:Pa,partition:Ha};Bt.aws=Tn;function ja(e){const t={};if(e=e.replace(/^\?/,""),e)for(const r of e.split("&")){let[s,n=null]=r.split("=");s=decodeURIComponent(s),n&&(n=decodeURIComponent(n)),s in t?Array.isArray(t[s])?t[s].push(n):t[s]=[t[s],n]:t[s]=n}return t}const $t=e=>{if(typeof e=="string")return $t(new URL(e));const{hostname:t,pathname:r,port:s,protocol:n,search:i}=e;let o;return i&&(o=ja(i)),{hostname:t,port:s?parseInt(s):void 0,protocol:n,path:r,query:o}};function La(e,t,r){return e.$source||(e.$source={}),e.$source[t]=r,e}function V(e,t,r){e.__aws_sdk_context?e.__aws_sdk_context.features||(e.__aws_sdk_context.features={}):e.__aws_sdk_context={features:{}},e.__aws_sdk_context.features[t]=r}const Gr=e=>{var t,r;return We.isInstance(e)?((t=e.headers)==null?void 0:t.date)??((r=e.headers)==null?void 0:r.Date):void 0},Rn=e=>new Date(Date.now()+e),za=(e,t)=>Math.abs(Rn(t).getTime()-e)>=3e5,Wr=(e,t)=>{const r=Date.parse(e);return za(r,t)?r-Date.now():t},nt=(e,t)=>{if(!t)throw new Error(`Property \`${e}\` is not resolved for AWS SDK SigV4Auth`);return t},qa=async e=>{var u,l,d;const t=nt("context",e.context),r=nt("config",e.config),s=(d=(l=(u=t.endpointV2)==null?void 0:u.properties)==null?void 0:l.authSchemes)==null?void 0:d[0],i=await nt("signer",r.signer)(s),o=e==null?void 0:e.signingRegion,a=e==null?void 0:e.signingRegionSet,c=e==null?void 0:e.signingName;return{config:r,signer:i,signingRegion:o,signingRegionSet:a,signingName:c}};class Ga{async sign(t,r,s){var d;if(!F.isInstance(t))throw new Error("The request is not an instance of `HttpRequest` and cannot be signed");const n=await qa(s),{config:i,signer:o}=n;let{signingRegion:a,signingName:c}=n;const u=s.context;if(((d=u==null?void 0:u.authSchemes)==null?void 0:d.length)??!1){const[f,h]=u.authSchemes;(f==null?void 0:f.name)==="sigv4a"&&(h==null?void 0:h.name)==="sigv4"&&(a=(h==null?void 0:h.signingRegion)??a,c=(h==null?void 0:h.signingName)??c)}return await o.sign(t,{signingDate:Rn(i.systemClockOffset),signingRegion:a,signingService:c})}errorHandler(t){return r=>{const s=r.ServerTime??Gr(r.$response);if(s){const n=nt("config",t.config),i=n.systemClockOffset;n.systemClockOffset=Wr(s,n.systemClockOffset),n.systemClockOffset!==i&&r.$metadata&&(r.$metadata.clockSkewCorrected=!0)}throw r}}successHandler(t,r){const s=Gr(t);if(s){const n=nt("config",r.config);n.systemClockOffset=Wr(s,n.systemClockOffset)}}}const Wa=(e,t,r)=>{let s,n,i,o=!1;const a=async()=>{n||(n=e());try{s=await n,i=!0,o=!1}finally{n=void 0}return s};return async c=>((!i||c!=null&&c.forceRefresh)&&(s=await a()),s)},Va="X-Amz-Algorithm",Ja="X-Amz-Credential",vn="X-Amz-Date",Ka="X-Amz-SignedHeaders",Xa="X-Amz-Expires",Dn="X-Amz-Signature",In="X-Amz-Security-Token",Mn="authorization",On=vn.toLowerCase(),Qa="date",Ya=[Mn,On,Qa],Za=Dn.toLowerCase(),ur="x-amz-content-sha256",ec=In.toLowerCase(),tc={authorization:!0,"cache-control":!0,connection:!0,expect:!0,from:!0,"keep-alive":!0,"max-forwards":!0,pragma:!0,referer:!0,te:!0,trailer:!0,"transfer-encoding":!0,upgrade:!0,"user-agent":!0,"x-amzn-trace-id":!0},rc=/^proxy-/,sc=/^sec-/,Zt="AWS4-HMAC-SHA256",nc="AWS4-HMAC-SHA256-PAYLOAD",ic="UNSIGNED-PAYLOAD",oc=50,Bn="aws4_request",ac=60*60*24*7,xt={},er=[],tr=(e,t,r)=>`${e}/${t}/${r}/${Bn}`,cc=async(e,t,r,s,n)=>{const i=await Vr(e,t.secretAccessKey,t.accessKeyId),o=`${r}:${s}:${n}:${_(i)}:${t.sessionToken}`;if(o in xt)return xt[o];for(er.push(o);er.length>oc;)delete xt[er.shift()];let a=`AWS4${t.secretAccessKey}`;for(const c of[r,s,n,Bn])a=await Vr(e,a,c);return xt[o]=a},Vr=(e,t,r)=>{const s=new e(t);return s.update(at(r)),s.digest()},Jr=({headers:e},t,r)=>{const s={};for(const n of Object.keys(e).sort()){if(e[n]==null)continue;const i=n.toLowerCase();(i in tc||t!=null&&t.has(i)||rc.test(i)||sc.test(i))&&(!r||r&&!r.has(i))||(s[i]=e[n].trim().replace(/\s+/g," "))}return s},uc=e=>typeof ArrayBuffer=="function"&&e instanceof ArrayBuffer||Object.prototype.toString.call(e)==="[object ArrayBuffer]",rr=async({headers:e,body:t},r)=>{for(const s of Object.keys(e))if(s.toLowerCase()===ur)return e[s];if(t==null)return"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855";if(typeof t=="string"||ArrayBuffer.isView(t)||uc(t)){const s=new r;return s.update(at(t)),_(await s.digest())}return ic};class lc{format(t){const r=[];for(const i of Object.keys(t)){const o=we(i);r.push(Uint8Array.from([o.byteLength]),o,this.formatHeaderValue(t[i]))}const s=new Uint8Array(r.reduce((i,o)=>i+o.byteLength,0));let n=0;for(const i of r)s.set(i,n),n+=i.byteLength;return s}formatHeaderValue(t){switch(t.type){case"boolean":return Uint8Array.from([t.value?0:1]);case"byte":return Uint8Array.from([2,t.value]);case"short":const r=new DataView(new ArrayBuffer(3));return r.setUint8(0,3),r.setInt16(1,t.value,!1),new Uint8Array(r.buffer);case"integer":const s=new DataView(new ArrayBuffer(5));return s.setUint8(0,4),s.setInt32(1,t.value,!1),new Uint8Array(s.buffer);case"long":const n=new Uint8Array(9);return n[0]=5,n.set(t.value.bytes,1),n;case"binary":const i=new DataView(new ArrayBuffer(3+t.value.byteLength));i.setUint8(0,6),i.setUint16(1,t.value.byteLength,!1);const o=new Uint8Array(i.buffer);return o.set(t.value,3),o;case"string":const a=we(t.value),c=new DataView(new ArrayBuffer(3+a.byteLength));c.setUint8(0,7),c.setUint16(1,a.byteLength,!1);const u=new Uint8Array(c.buffer);return u.set(a,3),u;case"timestamp":const l=new Uint8Array(9);return l[0]=8,l.set(fc.fromNumber(t.value.valueOf()).bytes,1),l;case"uuid":if(!dc.test(t.value))throw new Error(`Invalid UUID received: ${t.value}`);const d=new Uint8Array(17);return d[0]=9,d.set(on(t.value.replace(/\-/g,"")),1),d}}}var Kr;(function(e){e[e.boolTrue=0]="boolTrue",e[e.boolFalse=1]="boolFalse",e[e.byte=2]="byte",e[e.short=3]="short",e[e.integer=4]="integer",e[e.long=5]="long",e[e.byteArray=6]="byteArray",e[e.string=7]="string",e[e.timestamp=8]="timestamp",e[e.uuid=9]="uuid"})(Kr||(Kr={}));const dc=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/;let fc=class $n{constructor(t){p(this,"bytes");if(this.bytes=t,t.byteLength!==8)throw new Error("Int64 buffers must be exactly 8 bytes")}static fromNumber(t){if(t>9223372036854776e3||t<-9223372036854776e3)throw new Error(`${t} is too large (or, if negative, too small) to represent as an Int64`);const r=new Uint8Array(8);for(let s=7,n=Math.abs(Math.round(t));s>-1&&n>0;s--,n/=256)r[s]=n;return t<0&&Xr(r),new $n(r)}valueOf(){const t=this.bytes.slice(0),r=t[0]&128;return r&&Xr(t),parseInt(_(t),16)*(r?-1:1)}toString(){return String(this.valueOf())}};function Xr(e){for(let t=0;t<8;t++)e[t]^=255;for(let t=7;t>-1&&(e[t]++,e[t]===0);t--);}const hc=(e,t)=>{e=e.toLowerCase();for(const r of Object.keys(t))if(e===r.toLowerCase())return!0;return!1},pc=(e,t={})=>{var n,i;const{headers:r,query:s={}}=F.clone(e);for(const o of Object.keys(r)){const a=o.toLowerCase();(a.slice(0,6)==="x-amz-"&&!((n=t.unhoistableHeaders)!=null&&n.has(a))||(i=t.hoistableHeaders)!=null&&i.has(a))&&(s[o]=r[o],delete r[o])}return{...e,headers:r,query:s}},Qr=e=>{e=F.clone(e);for(const t of Object.keys(e.headers))Ya.indexOf(t.toLowerCase())>-1&&delete e.headers[t];return e},mc=({query:e={}})=>{const t=[],r={};for(const s of Object.keys(e)){if(s.toLowerCase()===Za)continue;const n=Me(s);t.push(n);const i=e[s];typeof i=="string"?r[n]=`${n}=${Me(i)}`:Array.isArray(i)&&(r[n]=i.slice(0).reduce((o,a)=>o.concat([`${n}=${Me(a)}`]),[]).sort().join("&"))}return t.sort().map(s=>r[s]).filter(s=>s).join("&")},gc=e=>yc(e).toISOString().replace(/\.\d{3}Z$/,"Z"),yc=e=>typeof e=="number"?new Date(e*1e3):typeof e=="string"?Number(e)?new Date(Number(e)*1e3):new Date(e):e;class wc{constructor({applyChecksum:t,credentials:r,region:s,service:n,sha256:i,uriEscapePath:o=!0}){p(this,"service");p(this,"regionProvider");p(this,"credentialProvider");p(this,"sha256");p(this,"uriEscapePath");p(this,"applyChecksum");this.service=n,this.sha256=i,this.uriEscapePath=o,this.applyChecksum=typeof t=="boolean"?t:!0,this.regionProvider=ie(s),this.credentialProvider=ie(r)}createCanonicalRequest(t,r,s){const n=Object.keys(r).sort();return`${t.method}
${this.getCanonicalPath(t)}
${mc(t)}
${n.map(i=>`${i}:${r[i]}`).join(`
`)}

${n.join(";")}
${s}`}async createStringToSign(t,r,s,n){const i=new this.sha256;i.update(at(s));const o=await i.digest();return`${n}
${t}
${r}
${_(o)}`}getCanonicalPath({path:t}){if(this.uriEscapePath){const r=[];for(const i of t.split("/"))(i==null?void 0:i.length)!==0&&i!=="."&&(i===".."?r.pop():r.push(i));const s=`${t!=null&&t.startsWith("/")?"/":""}${r.join("/")}${r.length>0&&(t!=null&&t.endsWith("/"))?"/":""}`;return Me(s).replace(/%2F/g,"/")}return t}validateResolvedCredentials(t){if(typeof t!="object"||typeof t.accessKeyId!="string"||typeof t.secretAccessKey!="string")throw new Error("Resolved credential object is not valid")}formatDate(t){const r=gc(t).replace(/[\-:]/g,"");return{longDate:r,shortDate:r.slice(0,8)}}getCanonicalHeaderList(t){return Object.keys(t).sort().join(";")}}class Yr extends wc{constructor({applyChecksum:r,credentials:s,region:n,service:i,sha256:o,uriEscapePath:a=!0}){super({applyChecksum:r,credentials:s,region:n,service:i,sha256:o,uriEscapePath:a});p(this,"headerFormatter",new lc)}async presign(r,s={}){const{signingDate:n=new Date,expiresIn:i=3600,unsignableHeaders:o,unhoistableHeaders:a,signableHeaders:c,hoistableHeaders:u,signingRegion:l,signingService:d}=s,f=await this.credentialProvider();this.validateResolvedCredentials(f);const h=l??await this.regionProvider(),{longDate:m,shortDate:y}=this.formatDate(n);if(i>ac)return Promise.reject("Signature version 4 presigned URLs must have an expiration date less than one week in the future");const w=tr(y,h,d??this.service),S=pc(Qr(r),{unhoistableHeaders:a,hoistableHeaders:u});f.sessionToken&&(S.query[In]=f.sessionToken),S.query[Va]=Zt,S.query[Ja]=`${f.accessKeyId}/${w}`,S.query[vn]=m,S.query[Xa]=i.toString(10);const b=Jr(S,o,c);return S.query[Ka]=this.getCanonicalHeaderList(b),S.query[Dn]=await this.getSignature(m,w,this.getSigningKey(f,h,y,d),this.createCanonicalRequest(S,b,await rr(r,this.sha256))),S}async sign(r,s){return typeof r=="string"?this.signString(r,s):r.headers&&r.payload?this.signEvent(r,s):r.message?this.signMessage(r,s):this.signRequest(r,s)}async signEvent({headers:r,payload:s},{signingDate:n=new Date,priorSignature:i,signingRegion:o,signingService:a}){const c=o??await this.regionProvider(),{shortDate:u,longDate:l}=this.formatDate(n),d=tr(u,c,a??this.service),f=await rr({headers:{},body:s},this.sha256),h=new this.sha256;h.update(r);const m=_(await h.digest()),y=[nc,l,d,i,m,f].join(`
`);return this.signString(y,{signingDate:n,signingRegion:c,signingService:a})}async signMessage(r,{signingDate:s=new Date,signingRegion:n,signingService:i}){return this.signEvent({headers:this.headerFormatter.format(r.message.headers),payload:r.message.body},{signingDate:s,signingRegion:n,signingService:i,priorSignature:r.priorSignature}).then(a=>({message:r.message,signature:a}))}async signString(r,{signingDate:s=new Date,signingRegion:n,signingService:i}={}){const o=await this.credentialProvider();this.validateResolvedCredentials(o);const a=n??await this.regionProvider(),{shortDate:c}=this.formatDate(s),u=new this.sha256(await this.getSigningKey(o,a,c,i));return u.update(at(r)),_(await u.digest())}async signRequest(r,{signingDate:s=new Date,signableHeaders:n,unsignableHeaders:i,signingRegion:o,signingService:a}={}){const c=await this.credentialProvider();this.validateResolvedCredentials(c);const u=o??await this.regionProvider(),l=Qr(r),{longDate:d,shortDate:f}=this.formatDate(s),h=tr(f,u,a??this.service);l.headers[On]=d,c.sessionToken&&(l.headers[ec]=c.sessionToken);const m=await rr(l,this.sha256);!hc(ur,l.headers)&&this.applyChecksum&&(l.headers[ur]=m);const y=Jr(l,i,n),w=await this.getSignature(d,h,this.getSigningKey(c,u,f,a),this.createCanonicalRequest(l,y,m));return l.headers[Mn]=`${Zt} Credential=${c.accessKeyId}/${h}, SignedHeaders=${this.getCanonicalHeaderList(y)}, Signature=${w}`,l}async getSignature(r,s,n,i){const o=await this.createStringToSign(r,s,i,Zt),a=new this.sha256(await n);return a.update(at(o)),_(await a.digest())}getSigningKey(r,s,n,i){return cc(this.sha256,r,n,s,i||this.service)}}const Sc=e=>{let t=e.credentials,r=!!e.credentials,s;Object.defineProperty(e,"credentials",{set(u){u&&u!==t&&u!==s&&(r=!0),t=u;const l=bc(e,{credentials:t,credentialDefaultProvider:e.credentialDefaultProvider}),d=xc(e,l);r&&!d.attributed?(s=async f=>d(f).then(h=>La(h,"CREDENTIALS_CODE","e")),s.memoized=d.memoized,s.configBound=d.configBound,s.attributed=!0):s=d},get(){return s},enumerable:!0,configurable:!0}),e.credentials=t;const{signingEscapePath:n=!0,systemClockOffset:i=e.systemClockOffset||0,sha256:o}=e;let a;return e.signer?a=rt(e.signer):e.regionInfoProvider?a=()=>rt(e.region)().then(async u=>[await e.regionInfoProvider(u,{useFipsEndpoint:await e.useFipsEndpoint(),useDualstackEndpoint:await e.useDualstackEndpoint()})||{},u]).then(([u,l])=>{const{signingRegion:d,signingService:f}=u;e.signingRegion=e.signingRegion||d||l,e.signingName=e.signingName||f||e.serviceId;const h={...e,credentials:e.credentials,region:e.signingRegion,service:e.signingName,sha256:o,uriEscapePath:n},m=e.signerConstructor||Yr;return new m(h)}):a=async u=>{u=Object.assign({},{name:"sigv4",signingName:e.signingName||e.defaultSigningName,signingRegion:await rt(e.region)(),properties:{}},u);const l=u.signingRegion,d=u.signingName;e.signingRegion=e.signingRegion||l,e.signingName=e.signingName||d||e.serviceId;const f={...e,credentials:e.credentials,region:e.signingRegion,service:e.signingName,sha256:o,uriEscapePath:n},h=e.signerConstructor||Yr;return new h(f)},Object.assign(e,{systemClockOffset:i,signingEscapePath:n,signer:a})};function bc(e,{credentials:t,credentialDefaultProvider:r}){let s;return t?t!=null&&t.memoized?s=t:s=da(t,la,hn):r?s=rt(r(Object.assign({},e,{parentClientConfig:e}))):s=async()=>{throw new Error("@aws-sdk/core::resolveAwsSdkSigV4Config - `credentials` not provided and no credentialDefaultProvider was configured.")},s.memoized=!0,s}function xc(e,t){if(t.configBound)return t;const r=async s=>t({...s,callerClientConfig:e});return r.memoized=t.memoized,r.configBound=!0,r}const Zr=typeof TextEncoder=="function"?new TextEncoder:null,Ec=e=>{if(typeof e=="string"){if(Zr)return Zr.encode(e).byteLength;let t=e.length;for(let r=t-1;r>=0;r--){const s=e.charCodeAt(r);s>127&&s<=2047?t++:s>2047&&s<=65535&&(t+=2),s>=56320&&s<=57343&&r--}return t}else{if(typeof e.byteLength=="number")return e.byteLength;if(typeof e.size=="number")return e.size}throw new Error(`Body Length computation failed for ${e}`)},be=(e,t)=>{const r=[];if(e&&r.push(e),t)for(const s of t)r.push(s);return r},ce=(e,t)=>`${e||"anonymous"}${t&&t.length>0?` (a.k.a. ${t.join(",")})`:""}`,lr=()=>{let e=[],t=[],r=!1;const s=new Set,n=d=>d.sort((f,h)=>es[h.step]-es[f.step]||ts[h.priority||"normal"]-ts[f.priority||"normal"]),i=d=>{let f=!1;const h=m=>{const y=be(m.name,m.aliases);if(y.includes(d)){f=!0;for(const w of y)s.delete(w);return!1}return!0};return e=e.filter(h),t=t.filter(h),f},o=d=>{let f=!1;const h=m=>{if(m.middleware===d){f=!0;for(const y of be(m.name,m.aliases))s.delete(y);return!1}return!0};return e=e.filter(h),t=t.filter(h),f},a=d=>{var f;return e.forEach(h=>{d.add(h.middleware,{...h})}),t.forEach(h=>{d.addRelativeTo(h.middleware,{...h})}),(f=d.identifyOnResolve)==null||f.call(d,l.identifyOnResolve()),d},c=d=>{const f=[];return d.before.forEach(h=>{h.before.length===0&&h.after.length===0?f.push(h):f.push(...c(h))}),f.push(d),d.after.reverse().forEach(h=>{h.before.length===0&&h.after.length===0?f.push(h):f.push(...c(h))}),f},u=(d=!1)=>{const f=[],h=[],m={};return e.forEach(w=>{const S={...w,before:[],after:[]};for(const b of be(S.name,S.aliases))m[b]=S;f.push(S)}),t.forEach(w=>{const S={...w,before:[],after:[]};for(const b of be(S.name,S.aliases))m[b]=S;h.push(S)}),h.forEach(w=>{if(w.toMiddleware){const S=m[w.toMiddleware];if(S===void 0){if(d)return;throw new Error(`${w.toMiddleware} is not found when adding ${ce(w.name,w.aliases)} middleware ${w.relation} ${w.toMiddleware}`)}w.relation==="after"&&S.after.push(w),w.relation==="before"&&S.before.push(w)}}),n(f).map(c).reduce((w,S)=>(w.push(...S),w),[])},l={add:(d,f={})=>{const{name:h,override:m,aliases:y}=f,w={step:"initialize",priority:"normal",middleware:d,...f},S=be(h,y);if(S.length>0){if(S.some(b=>s.has(b))){if(!m)throw new Error(`Duplicate middleware name '${ce(h,y)}'`);for(const b of S){const x=e.findIndex(R=>{var v;return R.name===b||((v=R.aliases)==null?void 0:v.some(O=>O===b))});if(x===-1)continue;const C=e[x];if(C.step!==w.step||w.priority!==C.priority)throw new Error(`"${ce(C.name,C.aliases)}" middleware with ${C.priority} priority in ${C.step} step cannot be overridden by "${ce(h,y)}" middleware with ${w.priority} priority in ${w.step} step.`);e.splice(x,1)}}for(const b of S)s.add(b)}e.push(w)},addRelativeTo:(d,f)=>{const{name:h,override:m,aliases:y}=f,w={middleware:d,...f},S=be(h,y);if(S.length>0){if(S.some(b=>s.has(b))){if(!m)throw new Error(`Duplicate middleware name '${ce(h,y)}'`);for(const b of S){const x=t.findIndex(R=>{var v;return R.name===b||((v=R.aliases)==null?void 0:v.some(O=>O===b))});if(x===-1)continue;const C=t[x];if(C.toMiddleware!==w.toMiddleware||C.relation!==w.relation)throw new Error(`"${ce(C.name,C.aliases)}" middleware ${C.relation} "${C.toMiddleware}" middleware cannot be overridden by "${ce(h,y)}" middleware ${w.relation} "${w.toMiddleware}" middleware.`);t.splice(x,1)}}for(const b of S)s.add(b)}t.push(w)},clone:()=>a(lr()),use:d=>{d.applyToStack(l)},remove:d=>typeof d=="string"?i(d):o(d),removeByTag:d=>{let f=!1;const h=m=>{const{tags:y,name:w,aliases:S}=m;if(y&&y.includes(d)){const b=be(w,S);for(const x of b)s.delete(x);return f=!0,!1}return!0};return e=e.filter(h),t=t.filter(h),f},concat:d=>{var h;const f=a(lr());return f.use(d),f.identifyOnResolve(r||f.identifyOnResolve()||(((h=d.identifyOnResolve)==null?void 0:h.call(d))??!1)),f},applyToStack:a,identify:()=>u(!0).map(d=>{const f=d.step??d.relation+" "+d.toMiddleware;return ce(d.name,d.aliases)+" - "+f}),identifyOnResolve(d){return typeof d=="boolean"&&(r=d),r},resolve:(d,f)=>{for(const h of u().map(m=>m.middleware).reverse())d=h(d,f);return r&&console.log(l.identify()),d}};return l},es={initialize:5,serialize:4,build:3,finalizeRequest:2,deserialize:1},ts={high:3,normal:2,low:1};class Ac{constructor(t){p(this,"config");p(this,"middlewareStack",lr());p(this,"initConfig");p(this,"handlers");this.config=t}send(t,r,s){const n=typeof r!="function"?r:void 0,i=typeof r=="function"?r:s,o=n===void 0&&this.config.cacheMiddleware===!0;let a;if(o){this.handlers||(this.handlers=new WeakMap);const c=this.handlers;c.has(t.constructor)?a=c.get(t.constructor):(a=t.resolveMiddleware(this.middlewareStack,this.config,n),c.set(t.constructor,a))}else delete this.handlers,a=t.resolveMiddleware(this.middlewareStack,this.config,n);if(i)a(t).then(c=>i(null,c.output),c=>i(c)).catch(()=>{});else return a(t).then(c=>c.output)}destroy(){var t,r,s;(s=(r=(t=this.config)==null?void 0:t.requestHandler)==null?void 0:r.destroy)==null||s.call(r),delete this.handlers}}const rs=(e,t={})=>{Object.entries(t).filter(([,s])=>s!==void 0).forEach(([s,n])=>{(e[s]==null||e[s]==="")&&(e[s]=n)});const r=e.message||e.Message||"UnknownError";return e.message=r,delete e.Message,e},Cc=e=>{switch(e){case"standard":return{retryMode:"standard",connectionTimeout:3100};case"in-region":return{retryMode:"standard",connectionTimeout:1100};case"cross-region":return{retryMode:"standard",connectionTimeout:3100};case"mobile":return{retryMode:"standard",connectionTimeout:3e4};default:return{}}},Tc=e=>{const t=[];for(const r in Mt){const s=Mt[r];e[s]!==void 0&&t.push({algorithmId:()=>s,checksumConstructor:()=>e[s]})}return{addChecksumAlgorithm(r){t.push(r)},checksumAlgorithms(){return t}}},Rc=e=>{const t={};return e.checksumAlgorithms().forEach(r=>{t[r.algorithmId()]=r.checksumConstructor()}),t},vc=e=>({setRetryStrategy(t){e.retryStrategy=t},retryStrategy(){return e.retryStrategy}}),Dc=e=>{const t={};return t.retryStrategy=e.retryStrategy(),t},Ic=e=>Object.assign(Tc(e),vc(e)),Mc=e=>Object.assign(Rc(e),Dc(e));class Nn{trace(){}debug(){}info(){}warn(){}error(){}}class Oc{constructor(t=!1){p(this,"queryCompat");this.queryCompat=t}resolveRestContentType(t,r){const s=r.getMemberSchemas(),n=Object.values(s).find(i=>!!i.getMergedTraits().httpPayload);if(n){const i=n.getMergedTraits().mediaType;return i||(n.isStringSchema()?"text/plain":n.isBlobSchema()?"application/octet-stream":t)}else if(!r.isUnitSchema()&&Object.values(s).find(o=>{const{httpQuery:a,httpQueryParams:c,httpHeader:u,httpLabel:l,httpPrefixHeaders:d}=o.getMergedTraits();return!a&&!c&&!u&&!l&&d===void 0}))return t}async getErrorSchemaOrThrowBaseException(t,r,s,n,i,o){let a=r,c=t;t.includes("#")&&([a,c]=t.split("#"));const u={$metadata:i,$fault:s.statusCode<500?"client":"server"},l=ct.for(a);try{return{errorSchema:(o==null?void 0:o(l,c))??l.getSchema(t),errorMetadata:u}}catch{n.message=n.message??n.Message??"UnknownError";const f=ct.for("smithy.ts.sdk.synthetic."+a),h=f.getBaseException();if(h){const m=f.getErrorCtor(h)??Error;throw this.decorateServiceException(Object.assign(new m({name:c}),u),n)}throw this.decorateServiceException(Object.assign(new Error(c),u),n)}}decorateServiceException(t,r={}){if(this.queryCompat){const s=t.Message??r.Message,n=rs(t,r);return s&&(n.Message=s,n.message=s),n}return rs(t,r)}setQueryCompatError(t,r){var n;const s=(n=r.headers)==null?void 0:n["x-amzn-query-error"];if(t!==void 0&&s!=null){const[i,o]=s.split(";"),a=Object.entries(t),c={Code:i,Type:o};Object.assign(t,c);for(const[u,l]of a)c[u]=l;delete c.__type,t.Error=c}}queryCompatOutput(t,r){t.Error&&(r.Error=t.Error),t.Type&&(r.Type=t.Type),t.Code&&(r.Code=t.Code)}}class Er{constructor(){p(this,"serdeContext")}setSerdeContext(t){this.serdeContext=t}}function*Bc(e,t){if(e.isUnitSchema())return;const r=e.getSchema();for(let s=0;s<r[4].length;++s){const n=r[4][s],i=r[5][s],o=new D([i,0],n);!(n in t)&&!o.isIdempotencyToken()||(yield[n,o])}}function*$c(e,t,r){if(e.isUnitSchema())return;const s=e.getSchema();let n=Object.keys(t).filter(i=>i!=="__type").length;for(let i=0;i<s[4].length&&n!==0;++i){const o=s[4][i],a=s[5][i],c=new D([a,0],o);let u=o;r&&(u=c.getMergedTraits()[r]??o),u in t&&(yield[o,c],n-=1)}}function Nc(e,t,r){if(r!=null&&r.source){const s=r.source;if(typeof t=="number"&&(t>Number.MAX_SAFE_INTEGER||t<Number.MIN_SAFE_INTEGER||s!==String(t)))return s.includes(".")?new W(s,"bigDecimal"):BigInt(s)}return t}const kc=(e,t)=>Ze(e,t).then(r=>((t==null?void 0:t.utf8Encoder)??Be)(r)),Pc=(e,t)=>kc(e,t).then(r=>{if(r.length)try{return JSON.parse(r)}catch(s){throw(s==null?void 0:s.name)==="SyntaxError"&&Object.defineProperty(s,"$responseBodyText",{value:r}),s}return{}}),_c=(e,t)=>{const r=(i,o)=>Object.keys(i).find(a=>a.toLowerCase()===o.toLowerCase()),s=i=>{let o=i;return typeof o=="number"&&(o=o.toString()),o.indexOf(",")>=0&&(o=o.split(",")[0]),o.indexOf(":")>=0&&(o=o.split(":")[0]),o.indexOf("#")>=0&&(o=o.split("#")[1]),o},n=r(e.headers,"x-amzn-errortype");if(n!==void 0)return s(e.headers[n]);if(t&&typeof t=="object"){const i=r(t,"code");if(i&&t[i]!==void 0)return s(t[i]);if(t.__type!==void 0)return s(t.__type)}};class Fc extends Er{constructor(r){super();p(this,"settings");this.settings=r}async read(r,s){return this._read(r,typeof s=="string"?JSON.parse(s,Nc):await Pc(s,this.serdeContext))}readObject(r,s){return this._read(r,s)}_read(r,s){const n=s!==null&&typeof s=="object",i=D.of(r);if(n){if(i.isStructSchema()){const a={};for(const[c,u]of $c(i,s,this.settings.jsonName?"jsonName":!1)){const l=this.settings.jsonName?u.getMergedTraits().jsonName??c:c,d=this._read(u,s[l]);d!=null&&(a[c]=d)}return a}if(Array.isArray(s)&&i.isListSchema()){const a=i.getValueSchema(),c=[],u=!!i.getMergedTraits().sparse;for(const l of s)(u||l!=null)&&c.push(this._read(a,l));return c}if(i.isMapSchema()){const a=i.getValueSchema(),c={},u=!!i.getMergedTraits().sparse;for(const[l,d]of Object.entries(s))(u||d!=null)&&(c[l]=this._read(a,d));return c}}if(i.isBlobSchema()&&typeof s=="string")return Ve(s);const o=i.getMergedTraits().mediaType;if(i.isStringSchema()&&typeof s=="string"&&o)return o==="application/json"||o.endsWith("+json")?Y.from(s):s;if(i.isTimestampSchema()&&s!=null)switch(Ht(i,this.settings)){case 5:return Oo(s);case 6:return ko(s);case 7:return Po(s);default:return console.warn("Missing timestamp format, parsing value with Date constructor:",s),new Date(s)}if(i.isBigIntegerSchema()&&(typeof s=="number"||typeof s=="string"))return BigInt(s);if(i.isBigDecimalSchema()&&s!=null){if(s instanceof W)return s;const a=s;return a.type==="bigDecimal"&&"string"in a?new W(a.string,a.type):new W(String(s),"bigDecimal")}if(i.isNumericSchema()&&typeof s=="string"){switch(s){case"Infinity":return 1/0;case"-Infinity":return-1/0;case"NaN":return NaN}return s}if(i.isDocumentSchema())if(n){const a=Array.isArray(s)?[]:{};for(const[c,u]of Object.entries(s))u instanceof W?a[c]=u:a[c]=this._read(i,u);return a}else return structuredClone(s);return s}}const ss="";class Uc{constructor(){p(this,"values",new Map);p(this,"counter",0);p(this,"stage",0)}createReplacer(){if(this.stage===1)throw new Error("@aws-sdk/core/protocols - JsonReplacer already created.");if(this.stage===2)throw new Error("@aws-sdk/core/protocols - JsonReplacer exhausted.");return this.stage=1,(t,r)=>{if(r instanceof W){const s=`${ss+"nv"+this.counter++}_`+r.string;return this.values.set(`"${s}"`,r.string),s}if(typeof r=="bigint"){const s=r.toString(),n=`${ss+"b"+this.counter++}_`+s;return this.values.set(`"${n}"`,s),n}return r}}replaceInJson(t){if(this.stage===0)throw new Error("@aws-sdk/core/protocols - JsonReplacer not created yet.");if(this.stage===2)throw new Error("@aws-sdk/core/protocols - JsonReplacer exhausted.");if(this.stage=2,this.counter===0)return t;for(const[r,s]of this.values)t=t.replace(r,s);return t}}class Hc extends Er{constructor(r){super();p(this,"settings");p(this,"buffer");p(this,"useReplacer",!1);p(this,"rootSchema");this.settings=r}write(r,s){this.rootSchema=D.of(r),this.buffer=this._write(this.rootSchema,s)}writeDiscriminatedDocument(r,s){this.write(r,s),typeof this.buffer=="object"&&(this.buffer.__type=D.of(r).getName(!0))}flush(){const{rootSchema:r,useReplacer:s}=this;if(this.rootSchema=void 0,this.useReplacer=!1,r!=null&&r.isStructSchema()||r!=null&&r.isDocumentSchema()){if(!s)return JSON.stringify(this.buffer);const n=new Uc;return n.replaceInJson(JSON.stringify(this.buffer,n.createReplacer(),0))}return this.buffer}_write(r,s,n){var a,c;const i=s!==null&&typeof s=="object",o=D.of(r);if(i){if(o.isStructSchema()){const u={};for(const[l,d]of Bc(o,s)){const f=this._write(d,s[l],o);if(f!==void 0){const h=d.getMergedTraits().jsonName,m=this.settings.jsonName?h??l:l;u[m]=f}}return u}if(Array.isArray(s)&&o.isListSchema()){const u=o.getValueSchema(),l=[],d=!!o.getMergedTraits().sparse;for(const f of s)(d||f!=null)&&l.push(this._write(u,f));return l}if(o.isMapSchema()){const u=o.getValueSchema(),l={},d=!!o.getMergedTraits().sparse;for(const[f,h]of Object.entries(s))(d||h!=null)&&(l[f]=this._write(u,h));return l}if(s instanceof Uint8Array&&(o.isBlobSchema()||o.isDocumentSchema()))return o===this.rootSchema?s:(((a=this.serdeContext)==null?void 0:a.base64Encoder)??Oe)(s);if(s instanceof Date&&(o.isTimestampSchema()||o.isDocumentSchema()))switch(Ht(o,this.settings)){case 5:return s.toISOString().replace(".000Z","Z");case 6:return un(s);case 7:return s.getTime()/1e3;default:return console.warn("Missing timestamp format, using epoch seconds",s),s.getTime()/1e3}s instanceof W&&(this.useReplacer=!0)}if(!(s===null&&(n!=null&&n.isStructSchema()))){if(o.isStringSchema()){if(typeof s>"u"&&o.isIdempotencyToken())return yr();const u=o.getMergedTraits().mediaType;return s!=null&&u&&(u==="application/json"||u.endsWith("+json"))?Y.from(s):s}if(typeof s=="number"&&o.isNumericSchema())return Math.abs(s)===1/0||isNaN(s)?String(s):s;if(typeof s=="string"&&o.isBlobSchema())return o===this.rootSchema?s:(((c=this.serdeContext)==null?void 0:c.base64Encoder)??Oe)(s);if(typeof s=="bigint"&&(this.useReplacer=!0),o.isDocumentSchema())if(i){const u=Array.isArray(s)?[]:{};for(const[l,d]of Object.entries(s))d instanceof W?(this.useReplacer=!0,u[l]=d):u[l]=this._write(o,d);return u}else return structuredClone(s);return s}}}class jc extends Er{constructor(r){super();p(this,"settings");this.settings=r}createSerializer(){const r=new Hc(this.settings);return r.setSerdeContext(this.serdeContext),r}createDeserializer(){const r=new Fc(this.settings);return r.setSerdeContext(this.serdeContext),r}}class Lc extends ra{constructor({defaultNamespace:r}){super({defaultNamespace:r});p(this,"serializer");p(this,"deserializer");p(this,"codec");p(this,"mixin",new Oc);const s={timestampFormat:{useTrait:!0,default:7},httpBindings:!0,jsonName:!0};this.codec=new jc(s),this.serializer=new oa(this.codec.createSerializer(),s),this.deserializer=new na(this.codec.createDeserializer(),s)}getShapeId(){return"aws.protocols#restJson1"}getPayloadCodec(){return this.codec}setSerdeContext(r){this.codec.setSerdeContext(r),super.setSerdeContext(r)}async serializeRequest(r,s,n){const i=await super.serializeRequest(r,s,n),o=D.of(r.input);if(!i.headers["content-type"]){const a=this.mixin.resolveRestContentType(this.getDefaultContentType(),o);a&&(i.headers["content-type"]=a)}return i.body==null&&i.headers["content-type"]===this.getDefaultContentType()&&(i.body="{}"),i}async deserializeResponse(r,s,n){const i=await super.deserializeResponse(r,s,n),o=D.of(r.output);for(const[a,c]of o.structIterator())c.getMemberTraits().httpPayload&&!(a in i)&&(i[a]=null);return i}async handleError(r,s,n,i,o){const a=_c(n,i)??"Unknown",{errorSchema:c,errorMetadata:u}=await this.mixin.getErrorSchemaOrThrowBaseException(a,this.options.defaultNamespace,n,i,o),l=D.of(c),d=i.message??i.Message??"Unknown",f=ct.for(c[1]).getErrorCtor(c)??Error,h=new f(d);await this.deserializeHttpMessage(c,s,n,i);const m={};for(const[y,w]of l.structIterator()){const S=w.getMergedTraits().jsonName??y;m[y]=this.codec.createDeserializer().readObject(w,i[S])}throw this.mixin.decorateServiceException(Object.assign(h,u,{$fault:l.getMergedTraits().error,message:d},m),i)}getDefaultContentType(){return"application/json"}}const zc=/\d{12}\.ddb/;async function qc(e,t,r){var i,o,a,c,u,l,d;const s=r.request;if(((i=s==null?void 0:s.headers)==null?void 0:i["smithy-protocol"])==="rpc-v2-cbor"&&V(e,"PROTOCOL_RPC_V2_CBOR","M"),typeof t.retryStrategy=="function"){const f=await t.retryStrategy();typeof f.acquireInitialRetryToken=="function"?(a=(o=f.constructor)==null?void 0:o.name)!=null&&a.includes("Adaptive")?V(e,"RETRY_MODE_ADAPTIVE","F"):V(e,"RETRY_MODE_STANDARD","E"):V(e,"RETRY_MODE_LEGACY","D")}if(typeof t.accountIdEndpointMode=="function"){const f=e.endpointV2;switch(String((c=f==null?void 0:f.url)==null?void 0:c.hostname).match(zc)&&V(e,"ACCOUNT_ID_ENDPOINT","O"),await((u=t.accountIdEndpointMode)==null?void 0:u.call(t))){case"disabled":V(e,"ACCOUNT_ID_MODE_DISABLED","Q");break;case"preferred":V(e,"ACCOUNT_ID_MODE_PREFERRED","P");break;case"required":V(e,"ACCOUNT_ID_MODE_REQUIRED","R");break}}const n=(d=(l=e.__smithy_context)==null?void 0:l.selectedHttpAuthScheme)==null?void 0:d.identity;if(n!=null&&n.$source){const f=n;f.accountId&&V(e,"RESOLVED_ACCOUNT_ID","T");for(const[h,m]of Object.entries(f.$source??{}))V(e,h,m)}}const ns="user-agent",sr="x-amz-user-agent",is=" ",nr="/",Gc=/[^!$%&'*+\-.^_`|~\w]/g,Wc=/[^!$%&'*+\-.^_`|~\w#]/g,os="-",Vc=1024;function Jc(e){let t="";for(const r in e){const s=e[r];if(t.length+s.length+1<=Vc){t.length?t+=","+s:t+=s;continue}break}return t}const Kc=e=>(t,r)=>async s=>{var h,m,y,w;const{request:n}=s;if(!F.isInstance(n))return t(s);const{headers:i}=n,o=((h=r==null?void 0:r.userAgent)==null?void 0:h.map(Et))||[],a=(await e.defaultUserAgentProvider()).map(Et);await qc(r,e,s);const c=r;a.push(`m/${Jc(Object.assign({},(m=r.__smithy_context)==null?void 0:m.features,(y=c.__aws_sdk_context)==null?void 0:y.features))}`);const u=((w=e==null?void 0:e.customUserAgent)==null?void 0:w.map(Et))||[],l=await e.userAgentAppId();l&&a.push(Et(["app",`${l}`]));const d=[].concat([...a,...o,...u]).join(is),f=[...a.filter(S=>S.startsWith("aws-sdk-")),...u].join(is);return e.runtime!=="browser"?(f&&(i[sr]=i[sr]?`${i[ns]} ${f}`:f),i[ns]=d):i[sr]=d,t({...s,request:n})},Et=e=>{var o;const t=e[0].split(nr).map(a=>a.replace(Gc,os)).join(nr),r=(o=e[1])==null?void 0:o.replace(Wc,os),s=t.indexOf(nr),n=t.substring(0,s);let i=t.substring(s+1);return n==="api"&&(i=i.toLowerCase()),[n,i,r].filter(a=>a&&a.length>0).reduce((a,c,u)=>{switch(u){case 0:return c;case 1:return`${a}/${c}`;default:return`${a}#${c}`}},"")},Xc={name:"getUserAgentMiddleware",step:"build",priority:"low",tags:["SET_USER_AGENT","USER_AGENT"],override:!0},Qc=e=>({applyToStack:t=>{t.add(Kc(e),Xc)}}),Yc=!1,Zc=!1,as=new Set,eu=(e,t=jt)=>{if(!as.has(e)&&!t(e))if(e==="*")console.warn('@smithy/config-resolver WARN - Please use the caller region instead of "*". See "sigv4a" in https://github.com/aws/aws-sdk-js-v3/blob/main/supplemental-docs/CLIENTS.md.');else throw new Error(`Region not accepted: region="${e}" is not a valid hostname component.`);else as.add(e)},kn=e=>typeof e=="string"&&(e.startsWith("fips-")||e.endsWith("-fips")),tu=e=>kn(e)?["fips-aws-global","aws-fips"].includes(e)?"us-east-1":e.replace(/fips-(dkr-|prod-)?|-fips/,""):e,ru=e=>{const{region:t,useFipsEndpoint:r}=e;if(!t)throw new Error("Region is missing");return Object.assign(e,{region:async()=>{const s=typeof t=="function"?await t():t,n=tu(s);return eu(n),n},useFipsEndpoint:async()=>{const s=typeof t=="string"?t:await t();return kn(s)?!0:typeof r!="function"?Promise.resolve(!!r):r()}})},su=e=>Object.assign(e,{eventStreamMarshaller:e.eventStreamSerdeProvider(e)}),cs="content-length";function nu(e){return t=>async r=>{const s=r.request;if(F.isInstance(s)){const{body:n,headers:i}=s;if(n&&Object.keys(i).map(o=>o.toLowerCase()).indexOf(cs)===-1)try{const o=e(n);s.headers={...s.headers,[cs]:String(o)}}catch{}}return t({...r,request:s})}}const iu={step:"build",tags:["SET_CONTENT_LENGTH","CONTENT_LENGTH"],name:"contentLengthMiddleware",override:!0},ou=e=>({applyToStack:t=>{t.add(nu(e.bodyLengthChecker),iu)}}),au=async e=>{},cu=e=>typeof e=="object"?"url"in e?$t(e.url):e:$t(e),uu=e=>{const t=e.tls??!0,{endpoint:r,useDualstackEndpoint:s,useFipsEndpoint:n}=e,i=r!=null?async()=>cu(await ie(r)()):void 0,a=Object.assign(e,{endpoint:i,tls:t,isCustomEndpoint:!!r,useDualstackEndpoint:ie(s??!1),useFipsEndpoint:ie(n??!1)});let c;return a.serviceConfiguredEndpoint=async()=>(e.serviceId&&!c&&(c=au(e.serviceId)),c),a};var Je;(function(e){e.STANDARD="standard",e.ADAPTIVE="adaptive"})(Je||(Je={}));const Nt=3,lu=Je.STANDARD,du=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException","TransactionInProgressException"],fu=["TimeoutError","RequestTimeout","RequestTimeoutException"],hu=[500,502,503,504],pu=["ECONNRESET","ECONNREFUSED","EPIPE","ETIMEDOUT"],mu=["EHOSTUNREACH","ENETUNREACH","ENOTFOUND"],gu=e=>(e==null?void 0:e.$retryable)!==void 0,yu=e=>{var t;return(t=e.$metadata)==null?void 0:t.clockSkewCorrected},wu=e=>{const t=new Set(["Failed to fetch","NetworkError when attempting to fetch resource","The Internet connection appears to be offline","Load failed","Network request failed"]);return e&&e instanceof TypeError?t.has(e.message):!1},Pn=e=>{var t,r;return((t=e.$metadata)==null?void 0:t.httpStatusCode)===429||du.includes(e.name)||((r=e.$retryable)==null?void 0:r.throttling)==!0},Ar=(e,t=0)=>{var r;return gu(e)||yu(e)||fu.includes(e.name)||pu.includes((e==null?void 0:e.code)||"")||mu.includes((e==null?void 0:e.code)||"")||hu.includes(((r=e.$metadata)==null?void 0:r.httpStatusCode)||0)||wu(e)||e.cause!==void 0&&t<=10&&Ar(e.cause,t+1)},Su=e=>{var t;if(((t=e.$metadata)==null?void 0:t.httpStatusCode)!==void 0){const r=e.$metadata.httpStatusCode;return 500<=r&&r<=599&&!Ar(e)}return!1},_t=class _t{constructor(t){p(this,"beta");p(this,"minCapacity");p(this,"minFillRate");p(this,"scaleConstant");p(this,"smooth");p(this,"currentCapacity",0);p(this,"enabled",!1);p(this,"lastMaxRate",0);p(this,"measuredTxRate",0);p(this,"requestCount",0);p(this,"fillRate");p(this,"lastThrottleTime");p(this,"lastTimestamp",0);p(this,"lastTxRateBucket");p(this,"maxCapacity");p(this,"timeWindow",0);this.beta=(t==null?void 0:t.beta)??.7,this.minCapacity=(t==null?void 0:t.minCapacity)??1,this.minFillRate=(t==null?void 0:t.minFillRate)??.5,this.scaleConstant=(t==null?void 0:t.scaleConstant)??.4,this.smooth=(t==null?void 0:t.smooth)??.8;const r=this.getCurrentTimeInSeconds();this.lastThrottleTime=r,this.lastTxRateBucket=Math.floor(this.getCurrentTimeInSeconds()),this.fillRate=this.minFillRate,this.maxCapacity=this.minCapacity}getCurrentTimeInSeconds(){return Date.now()/1e3}async getSendToken(){return this.acquireTokenBucket(1)}async acquireTokenBucket(t){if(this.enabled){if(this.refillTokenBucket(),t>this.currentCapacity){const r=(t-this.currentCapacity)/this.fillRate*1e3;await new Promise(s=>_t.setTimeoutFn(s,r))}this.currentCapacity=this.currentCapacity-t}}refillTokenBucket(){const t=this.getCurrentTimeInSeconds();if(!this.lastTimestamp){this.lastTimestamp=t;return}const r=(t-this.lastTimestamp)*this.fillRate;this.currentCapacity=Math.min(this.maxCapacity,this.currentCapacity+r),this.lastTimestamp=t}updateClientSendingRate(t){let r;if(this.updateMeasuredRate(),Pn(t)){const n=this.enabled?Math.min(this.measuredTxRate,this.fillRate):this.measuredTxRate;this.lastMaxRate=n,this.calculateTimeWindow(),this.lastThrottleTime=this.getCurrentTimeInSeconds(),r=this.cubicThrottle(n),this.enableTokenBucket()}else this.calculateTimeWindow(),r=this.cubicSuccess(this.getCurrentTimeInSeconds());const s=Math.min(r,2*this.measuredTxRate);this.updateTokenBucketRate(s)}calculateTimeWindow(){this.timeWindow=this.getPrecise(Math.pow(this.lastMaxRate*(1-this.beta)/this.scaleConstant,1/3))}cubicThrottle(t){return this.getPrecise(t*this.beta)}cubicSuccess(t){return this.getPrecise(this.scaleConstant*Math.pow(t-this.lastThrottleTime-this.timeWindow,3)+this.lastMaxRate)}enableTokenBucket(){this.enabled=!0}updateTokenBucketRate(t){this.refillTokenBucket(),this.fillRate=Math.max(t,this.minFillRate),this.maxCapacity=Math.max(t,this.minCapacity),this.currentCapacity=Math.min(this.currentCapacity,this.maxCapacity)}updateMeasuredRate(){const t=this.getCurrentTimeInSeconds(),r=Math.floor(t*2)/2;if(this.requestCount++,r>this.lastTxRateBucket){const s=this.requestCount/(r-this.lastTxRateBucket);this.measuredTxRate=this.getPrecise(s*this.smooth+this.measuredTxRate*(1-this.smooth)),this.requestCount=0,this.lastTxRateBucket=r}}getPrecise(t){return parseFloat(t.toFixed(8))}};p(_t,"setTimeoutFn",setTimeout);let dr=_t;const fr=100,_n=20*1e3,bu=500,us=500,xu=5,Eu=10,Au=1,Cu="amz-sdk-invocation-id",Tu="amz-sdk-request",Ru=()=>{let e=fr;return{computeNextBackoffDelay:s=>Math.floor(Math.min(_n,Math.random()*2**s*e)),setDelayBase:s=>{e=s}}},ls=({retryDelay:e,retryCount:t,retryCost:r})=>({getRetryCount:()=>t,getRetryDelay:()=>Math.min(_n,e),getRetryCost:()=>r});class Fn{constructor(t){p(this,"maxAttempts");p(this,"mode",Je.STANDARD);p(this,"capacity",us);p(this,"retryBackoffStrategy",Ru());p(this,"maxAttemptsProvider");this.maxAttempts=t,this.maxAttemptsProvider=typeof t=="function"?t:async()=>t}async acquireInitialRetryToken(t){return ls({retryDelay:fr,retryCount:0})}async refreshRetryTokenForRetry(t,r){const s=await this.getMaxAttempts();if(this.shouldRetry(t,r,s)){const n=r.errorType;this.retryBackoffStrategy.setDelayBase(n==="THROTTLING"?bu:fr);const i=this.retryBackoffStrategy.computeNextBackoffDelay(t.getRetryCount()),o=r.retryAfterHint?Math.max(r.retryAfterHint.getTime()-Date.now()||0,i):i,a=this.getCapacityCost(n);return this.capacity-=a,ls({retryDelay:o,retryCount:t.getRetryCount()+1,retryCost:a})}throw new Error("No retry token available")}recordSuccess(t){this.capacity=Math.max(us,this.capacity+(t.getRetryCost()??Au))}getCapacity(){return this.capacity}async getMaxAttempts(){try{return await this.maxAttemptsProvider()}catch{return console.warn(`Max attempts provider could not resolve. Using default of ${Nt}`),Nt}}shouldRetry(t,r,s){return t.getRetryCount()+1<s&&this.capacity>=this.getCapacityCost(r.errorType)&&this.isRetryableError(r.errorType)}getCapacityCost(t){return t==="TRANSIENT"?Eu:xu}isRetryableError(t){return t==="THROTTLING"||t==="TRANSIENT"}}class vu{constructor(t,r){p(this,"maxAttemptsProvider");p(this,"rateLimiter");p(this,"standardRetryStrategy");p(this,"mode",Je.ADAPTIVE);this.maxAttemptsProvider=t;const{rateLimiter:s}=r??{};this.rateLimiter=s??new dr,this.standardRetryStrategy=new Fn(t)}async acquireInitialRetryToken(t){return await this.rateLimiter.getSendToken(),this.standardRetryStrategy.acquireInitialRetryToken(t)}async refreshRetryTokenForRetry(t,r){return this.rateLimiter.updateClientSendingRate(r),this.standardRetryStrategy.refreshRetryTokenForRetry(t,r)}recordSuccess(t){this.rateLimiter.updateClientSendingRate({}),this.standardRetryStrategy.recordSuccess(t)}}const Du=e=>e instanceof Error?e:e instanceof Object?Object.assign(new Error,e):typeof e=="string"?new Error(e):new Error(`AWS SDK error wrapper for ${e}`),Iu=e=>{const{retryStrategy:t,retryMode:r,maxAttempts:s}=e,n=ie(s??Nt);return Object.assign(e,{maxAttempts:n,retryStrategy:async()=>t||(await ie(r)()===Je.ADAPTIVE?new vu(n):new Fn(n))})},Mu=e=>(e==null?void 0:e.body)instanceof ReadableStream,Ou=e=>(t,r)=>async s=>{var o;let n=await e.retryStrategy();const i=await e.maxAttempts();if(Bu(n)){n=n;let a=await n.acquireInitialRetryToken(r.partition_id),c=new Error,u=0,l=0;const{request:d}=s,f=F.isInstance(d);for(f&&(d.headers[Cu]=yr());;)try{f&&(d.headers[Tu]=`attempt=${u+1}; max=${i}`);const{response:h,output:m}=await t(s);return n.recordSuccess(a),m.$metadata.attempts=u+1,m.$metadata.totalRetryDelay=l,{response:h,output:m}}catch(h){const m=$u(h);if(c=Du(h),f&&Mu(d))throw(o=r.logger instanceof Nn?console:r.logger)==null||o.warn("An error was encountered in a non-retryable streaming request."),c;try{a=await n.refreshRetryTokenForRetry(a,m)}catch{throw c.$metadata||(c.$metadata={}),c.$metadata.attempts=u+1,c.$metadata.totalRetryDelay=l,c}u=a.getRetryCount();const y=a.getRetryDelay();l+=y,await new Promise(w=>setTimeout(w,y))}}else return n=n,n!=null&&n.mode&&(r.userAgent=[...r.userAgent||[],["cfg/retry-mode",n.mode]]),n.retry(t,s)},Bu=e=>typeof e.acquireInitialRetryToken<"u"&&typeof e.refreshRetryTokenForRetry<"u"&&typeof e.recordSuccess<"u",$u=e=>{const t={error:e,errorType:Nu(e)},r=_u(e.$response);return r&&(t.retryAfterHint=r),t},Nu=e=>Pn(e)?"THROTTLING":Ar(e)?"TRANSIENT":Su(e)?"SERVER_ERROR":"CLIENT_ERROR",ku={name:"retryMiddleware",tags:["RETRY"],step:"finalizeRequest",priority:"high",override:!0},Pu=e=>({applyToStack:t=>{t.add(Ou(e),ku)}}),_u=e=>{if(!We.isInstance(e))return;const t=Object.keys(e.headers).find(i=>i.toLowerCase()==="retry-after");if(!t)return;const r=e.headers[t],s=Number(r);return Number.isNaN(s)?new Date(r):new Date(s*1e3)},Fu=async(e,t,r)=>({operation:St(t).operation,region:await ie(e.region)()||(()=>{throw new Error("expected `region` to be configured for `aws.auth#sigv4`")})()});function Uu(e){return{schemeId:"aws.auth#sigv4",signingProperties:{name:"bedrock",region:e.region},propertiesExtractor:(t,r)=>({signingProperties:{config:t,context:r}})}}const Hu=e=>{const t=[];switch(e.operation){default:t.push(Uu(e))}return t},ju=e=>{const t=Sc(e);return Object.assign(t,{authSchemePreference:ie(e.authSchemePreference??[])})},Lu=e=>Object.assign(e,{useDualstackEndpoint:e.useDualstackEndpoint??!1,useFipsEndpoint:e.useFipsEndpoint??!1,defaultSigningName:"bedrock"}),zu="3.943.0",qu={version:zu},Gu=e=>new TextEncoder().encode(e);var Wu=typeof Buffer<"u"&&Buffer.from?function(e){return Buffer.from(e,"utf8")}:Gu;function dt(e){return e instanceof Uint8Array?e:typeof e=="string"?Wu(e):ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(e)}function hr(e){return typeof e=="string"?e.length===0:e.byteLength===0}function Vu(e){if(!Uint32Array.from){for(var t=new Uint32Array(e.length),r=0;r<e.length;)t[r]=e[r],r+=1;return t}return Uint32Array.from(e)}var Un={name:"SHA-256"},ds={name:"HMAC",hash:Un},Ju=new Uint8Array([227,176,196,66,152,252,28,20,154,251,244,200,153,111,185,36,39,174,65,228,100,155,147,76,164,149,153,27,120,82,184,85]);const Ku={};function vt(){return typeof window<"u"?window:typeof self<"u"?self:Ku}var Xu=function(){function e(t){this.toHash=new Uint8Array(0),this.secret=t,this.reset()}return e.prototype.update=function(t){if(!hr(t)){var r=dt(t),s=new Uint8Array(this.toHash.byteLength+r.byteLength);s.set(this.toHash,0),s.set(r,this.toHash.byteLength),this.toHash=s}},e.prototype.digest=function(){var t=this;return this.key?this.key.then(function(r){return vt().crypto.subtle.sign(ds,r,t.toHash).then(function(s){return new Uint8Array(s)})}):hr(this.toHash)?Promise.resolve(Ju):Promise.resolve().then(function(){return vt().crypto.subtle.digest(Un,t.toHash)}).then(function(r){return Promise.resolve(new Uint8Array(r))})},e.prototype.reset=function(){var t=this;this.toHash=new Uint8Array(0),this.secret&&this.secret!==void 0&&(this.key=new Promise(function(r,s){vt().crypto.subtle.importKey("raw",dt(t.secret),ds,!1,["sign"]).then(r,s)}),this.key.catch(function(){}))},e}();function Qu(e,t,r,s){function n(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function a(l){try{u(s.next(l))}catch(d){o(d)}}function c(l){try{u(s.throw(l))}catch(d){o(d)}}function u(l){l.done?i(l.value):n(l.value).then(a,c)}u((s=s.apply(e,t||[])).next())})}function Yu(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},s,n,i,o=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return c([u,l])}}function c(u){if(s)throw new TypeError("Generator is already executing.");for(;o&&(o=0,u[0]&&(r=0)),r;)try{if(s=1,n&&(i=u[0]&2?n.return:u[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,u[1])).done)return i;switch(n=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,n=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){r.label=u[1];break}if(u[0]===6&&r.label<i[1]){r.label=i[1],i=u;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(u);break}i[2]&&r.ops.pop(),r.trys.pop();continue}u=t.call(e,r)}catch(l){u=[6,l],n=0}finally{s=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function Zu(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],s=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&s>=e.length&&(e=void 0),{value:e&&e[s++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}var L=64,el=32,tl=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),rl=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],sl=Math.pow(2,53)-1,Dt=function(){function e(){this.state=Int32Array.from(rl),this.temp=new Int32Array(64),this.buffer=new Uint8Array(64),this.bufferLength=0,this.bytesHashed=0,this.finished=!1}return e.prototype.update=function(t){if(this.finished)throw new Error("Attempted to update an already finished hash.");var r=0,s=t.byteLength;if(this.bytesHashed+=s,this.bytesHashed*8>sl)throw new Error("Cannot hash more than 2^53 - 1 bits");for(;s>0;)this.buffer[this.bufferLength++]=t[r++],s--,this.bufferLength===L&&(this.hashBuffer(),this.bufferLength=0)},e.prototype.digest=function(){if(!this.finished){var t=this.bytesHashed*8,r=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.byteLength),s=this.bufferLength;if(r.setUint8(this.bufferLength++,128),s%L>=L-8){for(var n=this.bufferLength;n<L;n++)r.setUint8(n,0);this.hashBuffer(),this.bufferLength=0}for(var n=this.bufferLength;n<L-8;n++)r.setUint8(n,0);r.setUint32(L-8,Math.floor(t/4294967296),!0),r.setUint32(L-4,t),this.hashBuffer(),this.finished=!0}for(var i=new Uint8Array(el),n=0;n<8;n++)i[n*4]=this.state[n]>>>24&255,i[n*4+1]=this.state[n]>>>16&255,i[n*4+2]=this.state[n]>>>8&255,i[n*4+3]=this.state[n]>>>0&255;return i},e.prototype.hashBuffer=function(){for(var t=this,r=t.buffer,s=t.state,n=s[0],i=s[1],o=s[2],a=s[3],c=s[4],u=s[5],l=s[6],d=s[7],f=0;f<L;f++){if(f<16)this.temp[f]=(r[f*4]&255)<<24|(r[f*4+1]&255)<<16|(r[f*4+2]&255)<<8|r[f*4+3]&255;else{var h=this.temp[f-2],m=(h>>>17|h<<15)^(h>>>19|h<<13)^h>>>10;h=this.temp[f-15];var y=(h>>>7|h<<25)^(h>>>18|h<<14)^h>>>3;this.temp[f]=(m+this.temp[f-7]|0)+(y+this.temp[f-16]|0)}var w=(((c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))+(c&u^~c&l)|0)+(d+(tl[f]+this.temp[f]|0)|0)|0,S=((n>>>2|n<<30)^(n>>>13|n<<19)^(n>>>22|n<<10))+(n&i^n&o^i&o)|0;d=l,l=u,u=c,c=a+w|0,a=o,o=i,i=n,n=w+S|0}s[0]+=n,s[1]+=i,s[2]+=o,s[3]+=a,s[4]+=c,s[5]+=u,s[6]+=l,s[7]+=d},e}(),nl=function(){function e(t){this.secret=t,this.hash=new Dt,this.reset()}return e.prototype.update=function(t){if(!(hr(t)||this.error))try{this.hash.update(dt(t))}catch(r){this.error=r}},e.prototype.digestSync=function(){if(this.error)throw this.error;return this.outer?(this.outer.finished||this.outer.update(this.hash.digest()),this.outer.digest()):this.hash.digest()},e.prototype.digest=function(){return Qu(this,void 0,void 0,function(){return Yu(this,function(t){return[2,this.digestSync()]})})},e.prototype.reset=function(){if(this.hash=new Dt,this.secret){this.outer=new Dt;var t=il(this.secret),r=new Uint8Array(L);r.set(t);for(var s=0;s<L;s++)t[s]^=54,r[s]^=92;this.hash.update(t),this.outer.update(r);for(var s=0;s<t.byteLength;s++)t[s]=0}},e}();function il(e){var t=dt(e);if(t.byteLength>L){var r=new Dt;r.update(t),t=r.digest()}var s=new Uint8Array(L);return s.set(t),s}var ol=["decrypt","digest","encrypt","exportKey","generateKey","importKey","sign","verify"];function al(e){if(cl(e)&&typeof e.crypto.subtle=="object"){var t=e.crypto.subtle;return ul(t)}return!1}function cl(e){if(typeof e=="object"&&typeof e.crypto=="object"){var t=e.crypto.getRandomValues;return typeof t=="function"}return!1}function ul(e){return e&&ol.every(function(t){return typeof e[t]=="function"})}var ll=function(){function e(t){al(vt())?this.hash=new Xu(t):this.hash=new nl(t)}return e.prototype.update=function(t,r){this.hash.update(dt(t))},e.prototype.digest=function(){return this.hash.digest()},e.prototype.reset=function(){this.hash.reset()},e}();const dl=({serviceId:e,clientVersion:t})=>async r=>{var h,m,y;const s=typeof window<"u"?window.navigator:void 0,n=(s==null?void 0:s.userAgent)??"",i=((h=s==null?void 0:s.userAgentData)==null?void 0:h.platform)??fs.os(n)??"other",o=void 0,a=((m=s==null?void 0:s.userAgentData)==null?void 0:m.brands)??[],c=a[a.length-1],u=(c==null?void 0:c.brand)??fs.browser(n)??"unknown",l=(c==null?void 0:c.version)??"unknown",d=[["aws-sdk-js",t],["ua","2.1"],[`os/${i}`,o],["lang/js"],["md/browser",`${u}_${l}`]];e&&d.push([`api/${e}`,t]);const f=await((y=r==null?void 0:r.userAgentAppId)==null?void 0:y.call(r));return f&&d.push([`app/${f}`]),d},fs={os(e){if(/iPhone|iPad|iPod/.test(e))return"iOS";if(/Macintosh|Mac OS X/.test(e))return"macOS";if(/Windows NT/.test(e))return"Windows";if(/Android/.test(e))return"Android";if(/Linux/.test(e))return"Linux"},browser(e){if(/EdgiOS|EdgA|Edg\//.test(e))return"Microsoft Edge";if(/Firefox\//.test(e))return"Firefox";if(/Chrome\//.test(e))return"Chrome";if(/Safari\//.test(e))return"Safari"}};var Hn=function(){function e(){this.checksum=4294967295}return e.prototype.update=function(t){var r,s;try{for(var n=Zu(t),i=n.next();!i.done;i=n.next()){var o=i.value;this.checksum=this.checksum>>>8^hl[(this.checksum^o)&255]}}catch(a){r={error:a}}finally{try{i&&!i.done&&(s=n.return)&&s.call(n)}finally{if(r)throw r.error}}return this},e.prototype.digest=function(){return(this.checksum^4294967295)>>>0},e}(),fl=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],hl=Vu(fl);class it{constructor(t){p(this,"bytes");if(this.bytes=t,t.byteLength!==8)throw new Error("Int64 buffers must be exactly 8 bytes")}static fromNumber(t){if(t>9223372036854776e3||t<-9223372036854776e3)throw new Error(`${t} is too large (or, if negative, too small) to represent as an Int64`);const r=new Uint8Array(8);for(let s=7,n=Math.abs(Math.round(t));s>-1&&n>0;s--,n/=256)r[s]=n;return t<0&&hs(r),new it(r)}valueOf(){const t=this.bytes.slice(0),r=t[0]&128;return r&&hs(t),parseInt(_(t),16)*(r?-1:1)}toString(){return String(this.valueOf())}}function hs(e){for(let t=0;t<8;t++)e[t]^=255;for(let t=7;t>-1&&(e[t]++,e[t]===0);t--);}class pl{constructor(t,r){p(this,"toUtf8");p(this,"fromUtf8");this.toUtf8=t,this.fromUtf8=r}format(t){const r=[];for(const i of Object.keys(t)){const o=this.fromUtf8(i);r.push(Uint8Array.from([o.byteLength]),o,this.formatHeaderValue(t[i]))}const s=new Uint8Array(r.reduce((i,o)=>i+o.byteLength,0));let n=0;for(const i of r)s.set(i,n),n+=i.byteLength;return s}formatHeaderValue(t){switch(t.type){case"boolean":return Uint8Array.from([t.value?0:1]);case"byte":return Uint8Array.from([2,t.value]);case"short":const r=new DataView(new ArrayBuffer(3));return r.setUint8(0,3),r.setInt16(1,t.value,!1),new Uint8Array(r.buffer);case"integer":const s=new DataView(new ArrayBuffer(5));return s.setUint8(0,4),s.setInt32(1,t.value,!1),new Uint8Array(s.buffer);case"long":const n=new Uint8Array(9);return n[0]=5,n.set(t.value.bytes,1),n;case"binary":const i=new DataView(new ArrayBuffer(3+t.value.byteLength));i.setUint8(0,6),i.setUint16(1,t.value.byteLength,!1);const o=new Uint8Array(i.buffer);return o.set(t.value,3),o;case"string":const a=this.fromUtf8(t.value),c=new DataView(new ArrayBuffer(3+a.byteLength));c.setUint8(0,7),c.setUint16(1,a.byteLength,!1);const u=new Uint8Array(c.buffer);return u.set(a,3),u;case"timestamp":const l=new Uint8Array(9);return l[0]=8,l.set(it.fromNumber(t.value.valueOf()).bytes,1),l;case"uuid":if(!Al.test(t.value))throw new Error(`Invalid UUID received: ${t.value}`);const d=new Uint8Array(17);return d[0]=9,d.set(on(t.value.replace(/\-/g,"")),1),d}}parse(t){const r={};let s=0;for(;s<t.byteLength;){const n=t.getUint8(s++),i=this.toUtf8(new Uint8Array(t.buffer,t.byteOffset+s,n));switch(s+=n,t.getUint8(s++)){case 0:r[i]={type:ms,value:!0};break;case 1:r[i]={type:ms,value:!1};break;case 2:r[i]={type:ml,value:t.getInt8(s++)};break;case 3:r[i]={type:gl,value:t.getInt16(s,!1)},s+=2;break;case 4:r[i]={type:yl,value:t.getInt32(s,!1)},s+=4;break;case 5:r[i]={type:wl,value:new it(new Uint8Array(t.buffer,t.byteOffset+s,8))},s+=8;break;case 6:const o=t.getUint16(s,!1);s+=2,r[i]={type:Sl,value:new Uint8Array(t.buffer,t.byteOffset+s,o)},s+=o;break;case 7:const a=t.getUint16(s,!1);s+=2,r[i]={type:bl,value:this.toUtf8(new Uint8Array(t.buffer,t.byteOffset+s,a))},s+=a;break;case 8:r[i]={type:xl,value:new Date(new it(new Uint8Array(t.buffer,t.byteOffset+s,8)).valueOf())},s+=8;break;case 9:const c=new Uint8Array(t.buffer,t.byteOffset+s,16);s+=16,r[i]={type:El,value:`${_(c.subarray(0,4))}-${_(c.subarray(4,6))}-${_(c.subarray(6,8))}-${_(c.subarray(8,10))}-${_(c.subarray(10))}`};break;default:throw new Error("Unrecognized header type tag")}}return r}}var ps;(function(e){e[e.boolTrue=0]="boolTrue",e[e.boolFalse=1]="boolFalse",e[e.byte=2]="byte",e[e.short=3]="short",e[e.integer=4]="integer",e[e.long=5]="long",e[e.byteArray=6]="byteArray",e[e.string=7]="string",e[e.timestamp=8]="timestamp",e[e.uuid=9]="uuid"})(ps||(ps={}));const ms="boolean",ml="byte",gl="short",yl="integer",wl="long",Sl="binary",bl="string",xl="timestamp",El="uuid",Al=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/,jn=4,ue=jn*2,Ae=4,Cl=ue+Ae*2;function Tl({byteLength:e,byteOffset:t,buffer:r}){if(e<Cl)throw new Error("Provided message too short to accommodate event stream message overhead");const s=new DataView(r,t,e),n=s.getUint32(0,!1);if(e!==n)throw new Error("Reported message length does not match received message length");const i=s.getUint32(jn,!1),o=s.getUint32(ue,!1),a=s.getUint32(e-Ae,!1),c=new Hn().update(new Uint8Array(r,t,ue));if(o!==c.digest())throw new Error(`The prelude checksum specified in the message (${o}) does not match the calculated CRC32 checksum (${c.digest()})`);if(c.update(new Uint8Array(r,t+ue,e-(ue+Ae))),a!==c.digest())throw new Error(`The message checksum (${c.digest()}) did not match the expected value of ${a}`);return{headers:new DataView(r,t+ue+Ae,i),body:new Uint8Array(r,t+ue+Ae+i,n-i-(ue+Ae+Ae))}}class Rl{constructor(t,r){p(this,"headerMarshaller");p(this,"messageBuffer");p(this,"isEndOfStream");this.headerMarshaller=new pl(t,r),this.messageBuffer=[],this.isEndOfStream=!1}feed(t){this.messageBuffer.push(this.decode(t))}endOfStream(){this.isEndOfStream=!0}getMessage(){const t=this.messageBuffer.pop(),r=this.isEndOfStream;return{getMessage(){return t},isEndOfStream(){return r}}}getAvailableMessages(){const t=this.messageBuffer;this.messageBuffer=[];const r=this.isEndOfStream;return{getMessages(){return t},isEndOfStream(){return r}}}encode({headers:t,body:r}){const s=this.headerMarshaller.format(t),n=s.byteLength+r.byteLength+16,i=new Uint8Array(n),o=new DataView(i.buffer,i.byteOffset,i.byteLength),a=new Hn;return o.setUint32(0,n,!1),o.setUint32(4,s.byteLength,!1),o.setUint32(8,a.update(i.subarray(0,8)).digest(),!1),i.set(s,12),i.set(r,s.byteLength+12),o.setUint32(n-4,a.update(i.subarray(8,n-4)).digest(),!1),i}decode(t){const{headers:r,body:s}=Tl(t);return{headers:this.headerMarshaller.parse(r),body:s}}formatHeaders(t){return this.headerMarshaller.format(t)}}class vl{constructor(t){p(this,"options");this.options=t}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(const t of this.options.inputStream)yield this.options.decoder.decode(t)}}class Dl{constructor(t){p(this,"options");this.options=t}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(const t of this.options.messageStream)yield this.options.encoder.encode(t);this.options.includeEndFrame&&(yield new Uint8Array(0))}}class Il{constructor(t){p(this,"options");this.options=t}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(const t of this.options.messageStream){const r=await this.options.deserializer(t);r!==void 0&&(yield r)}}}class Ml{constructor(t){p(this,"options");this.options=t}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(const t of this.options.inputStream)yield this.options.serializer(t)}}function Ol(e){let t=0,r=0,s=null,n=null;const i=a=>{if(typeof a!="number")throw new Error("Attempted to allocate an event message where size was not a number: "+a);t=a,r=4,s=new Uint8Array(a),new DataView(s.buffer).setUint32(0,a,!1)},o=async function*(){const a=e[Symbol.asyncIterator]();for(;;){const{value:c,done:u}=await a.next();if(u){if(t)if(t===r)yield s;else throw new Error("Truncated event message received.");else return;return}const l=c.length;let d=0;for(;d<l;){if(!s){const h=l-d;n||(n=new Uint8Array(4));const m=Math.min(4-r,h);if(n.set(c.slice(d,d+m),r),r+=m,d+=m,r<4)break;i(new DataView(n.buffer).getUint32(0,!1)),n=null}const f=Math.min(t-r,l-d);s.set(c.slice(d,d+f),r),r+=f,d+=f,t&&t===r&&(yield s,s=null,t=0,r=0)}}};return{[Symbol.asyncIterator]:o}}function Bl(e,t){return async function(r){const{value:s}=r.headers[":message-type"];if(s==="error"){const n=new Error(r.headers[":error-message"].value||"UnknownError");throw n.name=r.headers[":error-code"].value,n}else if(s==="exception"){const n=r.headers[":exception-type"].value,i={[n]:r},o=await e(i);if(o.$unknown){const a=new Error(t(r.body));throw a.name=n,a}throw o[n]}else if(s==="event"){const n={[r.headers[":event-type"].value]:r},i=await e(n);return i.$unknown?void 0:i}else throw Error(`Unrecognizable event type: ${r.headers[":event-type"].value}`)}}let $l=class{constructor({utf8Encoder:t,utf8Decoder:r}){p(this,"eventStreamCodec");p(this,"utfEncoder");this.eventStreamCodec=new Rl(t,r),this.utfEncoder=t}deserialize(t,r){const s=Ol(t);return new Il({messageStream:new vl({inputStream:s,decoder:this.eventStreamCodec}),deserializer:Bl(r,this.utfEncoder)})}serialize(t,r){return new Dl({messageStream:new Ml({inputStream:t,serializer:r}),encoder:this.eventStreamCodec,includeEndFrame:!0})}};const Nl=e=>({[Symbol.asyncIterator]:async function*(){const t=e.getReader();try{for(;;){const{done:r,value:s}=await t.read();if(r)return;yield s}}finally{t.releaseLock()}}}),kl=e=>{const t=e[Symbol.asyncIterator]();return new ReadableStream({async pull(r){const{done:s,value:n}=await t.next();if(s)return r.close();r.enqueue(n)}})};class Pl{constructor({utf8Encoder:t,utf8Decoder:r}){p(this,"universalMarshaller");this.universalMarshaller=new $l({utf8Decoder:r,utf8Encoder:t})}deserialize(t,r){const s=_l(t)?Nl(t):t;return this.universalMarshaller.deserialize(s,r)}serialize(t,r){const s=this.universalMarshaller.serialize(t,r);return typeof ReadableStream=="function"?kl(s):s}}const _l=e=>typeof ReadableStream=="function"&&e instanceof ReadableStream,Fl=e=>new Pl(e),Ul=e=>()=>Promise.reject(e),Ln="required",X="fn",Q="argv",Ke="ref",gs=!0,ys="isSet",ft="booleanEquals",ke="error",Ye="endpoint",k="tree",Cr="PartitionResult",ws={[Ln]:!1,type:"string"},Ss={[Ln]:!0,default:!1,type:"boolean"},bs={[Ke]:"Endpoint"},zn={[X]:ft,[Q]:[{[Ke]:"UseFIPS"},!0]},qn={[X]:ft,[Q]:[{[Ke]:"UseDualStack"},!0]},J={},xs={[X]:"getAttr",[Q]:[{[Ke]:Cr},"supportsFIPS"]},Es={[X]:ft,[Q]:[!0,{[X]:"getAttr",[Q]:[{[Ke]:Cr},"supportsDualStack"]}]},As=[zn],Cs=[qn],Ts=[{[Ke]:"Region"}],Hl={parameters:{Region:ws,UseDualStack:Ss,UseFIPS:Ss,Endpoint:ws},rules:[{conditions:[{[X]:ys,[Q]:[bs]}],rules:[{conditions:As,error:"Invalid Configuration: FIPS and custom endpoint are not supported",type:ke},{rules:[{conditions:Cs,error:"Invalid Configuration: Dualstack and custom endpoint are not supported",type:ke},{endpoint:{url:bs,properties:J,headers:J},type:Ye}],type:k}],type:k},{rules:[{conditions:[{[X]:ys,[Q]:Ts}],rules:[{conditions:[{[X]:"aws.partition",[Q]:Ts,assign:Cr}],rules:[{conditions:[zn,qn],rules:[{conditions:[{[X]:ft,[Q]:[gs,xs]},Es],rules:[{rules:[{endpoint:{url:"https://bedrock-agent-runtime-fips.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:J,headers:J},type:Ye}],type:k}],type:k},{error:"FIPS and DualStack are enabled, but this partition does not support one or both",type:ke}],type:k},{conditions:As,rules:[{conditions:[{[X]:ft,[Q]:[xs,gs]}],rules:[{rules:[{endpoint:{url:"https://bedrock-agent-runtime-fips.{Region}.{PartitionResult#dnsSuffix}",properties:J,headers:J},type:Ye}],type:k}],type:k},{error:"FIPS is enabled but this partition does not support FIPS",type:ke}],type:k},{conditions:Cs,rules:[{conditions:[Es],rules:[{rules:[{endpoint:{url:"https://bedrock-agent-runtime.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:J,headers:J},type:Ye}],type:k}],type:k},{error:"DualStack is enabled but this partition does not support DualStack",type:ke}],type:k},{rules:[{endpoint:{url:"https://bedrock-agent-runtime.{Region}.{PartitionResult#dnsSuffix}",properties:J,headers:J},type:Ye}],type:k}],type:k}],type:k},{error:"Invalid Configuration: Missing Region",type:ke}],type:k}]},jl=Hl,Ll=new ma({size:50,params:["Endpoint","Region","UseDualStack","UseFIPS"]}),zl=(e,t={})=>Ll.get(e,()=>Na(jl,{endpointParams:e,logger:t.logger}));Bt.aws=Tn;const ql=e=>({apiVersion:"2023-07-26",base64Decoder:(e==null?void 0:e.base64Decoder)??Ve,base64Encoder:(e==null?void 0:e.base64Encoder)??Oe,disableHostPrefix:(e==null?void 0:e.disableHostPrefix)??!1,endpointProvider:(e==null?void 0:e.endpointProvider)??zl,extensions:(e==null?void 0:e.extensions)??[],httpAuthSchemeProvider:(e==null?void 0:e.httpAuthSchemeProvider)??Hu,httpAuthSchemes:(e==null?void 0:e.httpAuthSchemes)??[{schemeId:"aws.auth#sigv4",identityProvider:t=>t.getIdentityProvider("aws.auth#sigv4"),signer:new Ga}],logger:(e==null?void 0:e.logger)??new Nn,protocol:(e==null?void 0:e.protocol)??new Lc({defaultNamespace:"com.amazonaws.bedrockagentruntime"}),serviceId:(e==null?void 0:e.serviceId)??"Bedrock Agent Runtime",urlParser:(e==null?void 0:e.urlParser)??$t,utf8Decoder:(e==null?void 0:e.utf8Decoder)??we,utf8Encoder:(e==null?void 0:e.utf8Encoder)??Be}),Gl=["in-region","cross-region","mobile","standard","legacy"],Wl=({defaultsMode:e}={})=>Wa(async()=>{const t=typeof e=="function"?await e():e;switch(t==null?void 0:t.toLowerCase()){case"auto":return Promise.resolve(Vl()?"mobile":"standard");case"mobile":case"in-region":case"cross-region":case"standard":case"legacy":return Promise.resolve(t==null?void 0:t.toLocaleLowerCase());case void 0:return Promise.resolve("legacy");default:throw new Error(`Invalid parameter for "defaultsMode", expect ${Gl.join(", ")}, got ${t}`)}}),Vl=()=>{var t;const e=window==null?void 0:window.navigator;if(e!=null&&e.connection){const{effectiveType:r,rtt:s,downlink:n}=e==null?void 0:e.connection;if(typeof r=="string"&&r!=="4g"||Number(s)>100||Number(n)<10)return!0}return((t=e==null?void 0:e.userAgentData)==null?void 0:t.mobile)||typeof(e==null?void 0:e.maxTouchPoints)=="number"&&(e==null?void 0:e.maxTouchPoints)>1},Jl=e=>{const t=Wl(e),r=()=>t().then(Cc),s=ql(e);return{...s,...e,runtime:"browser",defaultsMode:t,bodyLengthChecker:(e==null?void 0:e.bodyLengthChecker)??Ec,credentialDefaultProvider:(e==null?void 0:e.credentialDefaultProvider)??(n=>()=>Promise.reject(new Error("Credential is missing"))),defaultUserAgentProvider:(e==null?void 0:e.defaultUserAgentProvider)??dl({serviceId:s.serviceId,clientVersion:qu.version}),eventStreamSerdeProvider:(e==null?void 0:e.eventStreamSerdeProvider)??Fl,maxAttempts:(e==null?void 0:e.maxAttempts)??Nt,region:(e==null?void 0:e.region)??Ul("Region is missing"),requestHandler:mr.create((e==null?void 0:e.requestHandler)??r),retryMode:(e==null?void 0:e.retryMode)??(async()=>(await r()).retryMode||lu),sha256:(e==null?void 0:e.sha256)??ll,streamCollector:(e==null?void 0:e.streamCollector)??sn,useDualstackEndpoint:(e==null?void 0:e.useDualstackEndpoint)??(()=>Promise.resolve(Yc)),useFipsEndpoint:(e==null?void 0:e.useFipsEndpoint)??(()=>Promise.resolve(Zc))}},Kl=e=>({setRegion(t){e.region=t},region(){return e.region}}),Xl=e=>({region:e.region()}),Ql=e=>{const t=e.httpAuthSchemes;let r=e.httpAuthSchemeProvider,s=e.credentials;return{setHttpAuthScheme(n){const i=t.findIndex(o=>o.schemeId===n.schemeId);i===-1?t.push(n):t.splice(i,1,n)},httpAuthSchemes(){return t},setHttpAuthSchemeProvider(n){r=n},httpAuthSchemeProvider(){return r},setCredentials(n){s=n},credentials(){return s}}},Yl=e=>({httpAuthSchemes:e.httpAuthSchemes(),httpAuthSchemeProvider:e.httpAuthSchemeProvider(),credentials:e.credentials()}),Zl=(e,t)=>{const r=Object.assign(Kl(e),Ic(e),Pi(e),Ql(e));return t.forEach(s=>s.configure(r)),Object.assign(e,Xl(r),Mc(r),_i(r),Yl(r))};class ed extends Ac{constructor(...[r]){const s=Jl(r||{});super(s);p(this,"config");this.initConfig=s;const n=Lu(s),i=pa(n),o=Iu(i),a=ru(o),c=a,u=uu(c),l=su(u),d=ju(l),f=Zl(d,(r==null?void 0:r.extensions)||[]);this.config=f,this.middlewareStack.use(wo(this.config)),this.middlewareStack.use(Qc(this.config)),this.middlewareStack.use(Pu(this.config)),this.middlewareStack.use(ou(this.config)),this.middlewareStack.use(ji(this.config)),this.middlewareStack.use(qi(this.config)),this.middlewareStack.use(Vi(this.config)),this.middlewareStack.use(Yi(this.config,{httpAuthSchemeParametersProvider:Fu,identityProviderConfigProvider:async h=>new aa({"aws.auth#sigv4":h.credentials})})),this.middlewareStack.use(so(this.config))}destroy(){super.destroy()}}var Rs={};const $e=new en;$e.get("*",ki({root:"./"}));$e.use("/api/*",Ti());const td="ap-northeast-1";new ed({region:td,credentials:{accessKeyId:Rs.AWS_ACCESS_KEY_ID||"",secretAccessKey:Rs.AWS_SECRET_ACCESS_KEY||""}});const Tr="https://6zzt3d5iej.execute-api.ap-northeast-1.amazonaws.com";$e.post("/api/omikuji",async e=>{try{const t=await e.req.json(),r=await fetch(`${Tr}/api/omikuji`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok)throw new Error(`Lambda API error: ${r.status}`);const s=await r.json();return e.json(s)}catch(t){return console.error("Omikuji API error:",t),e.json({error:""},500)}});$e.post("/api/chat",async e=>{try{const t=await e.req.json();if(!t.message)return e.json({error:""},400);const r=await fetch(`${Tr}/api/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok)throw new Error(`Lambda API error: ${r.status}`);const s=await r.json();return e.json(s)}catch(t){return console.error("Chat API error:",t),e.json({error:""},500)}});$e.get("/api/health",async e=>{try{const r=await(await fetch(`${Tr}/api/health`)).json();return e.json(r)}catch{return e.json({status:"error",message:"Lambda API unavailable"},500)}});$e.get("/",e=>e.redirect("/index.html"));const vs=new en,rd=Object.assign({"/src/index.tsx":$e});let Gn=!1;for(const[,e]of Object.entries(rd))e&&(vs.route("/",e),vs.notFound(e.notFoundHandler),Gn=!0);if(!Gn)throw new Error("Can't import modules from ['/src/index.tsx','/app/server.ts']");class sd{constructor({marshaller:t,serializer:r,deserializer:s,serdeContext:n,defaultContentType:i}){p(this,"marshaller");p(this,"serializer");p(this,"deserializer");p(this,"serdeContext");p(this,"defaultContentType");this.marshaller=t,this.serializer=r,this.deserializer=s,this.serdeContext=n,this.defaultContentType=i}async serializeEventStream({eventStream:t,requestSchema:r,initialRequest:s}){const n=this.marshaller,i=r.getEventStreamMember(),o=r.getMemberSchema(i),a=this.serializer,c=this.defaultContentType,u=Symbol("initialRequestMarker"),l={async*[Symbol.asyncIterator](){if(s){const d={":event-type":{type:"string",value:"initial-request"},":message-type":{type:"string",value:"event"},":content-type":{type:"string",value:c}};a.write(r,s);const f=a.flush();yield{[u]:!0,headers:d,body:f}}for await(const d of t)yield d}};return n.serialize(l,d=>{if(d[u])return{headers:d.headers,body:d.body};const f=Object.keys(d).find(b=>b!=="__type")??"",{additionalHeaders:h,body:m,eventType:y,explicitPayloadContentType:w}=this.writeEventBody(f,o,d);return{headers:{":event-type":{type:"string",value:y},":message-type":{type:"string",value:"event"},":content-type":{type:"string",value:w??c},...h},body:m}})}async deserializeEventStream({response:t,responseSchema:r,initialResponseContainer:s}){var f;const n=this.marshaller,i=r.getEventStreamMember(),a=r.getMemberSchema(i).getMemberSchemas(),c=Symbol("initialResponseMarker"),u=n.deserialize(t.body,async h=>{var w,S;const m=Object.keys(h).find(b=>b!=="__type")??"",y=h[m].body;if(m==="initial-response"){const b=await this.deserializer.read(r,y);return delete b[i],{[c]:!0,...b}}else if(m in a){const b=a[m];if(b.isStructSchema()){const x={};let C=!1;for(const[R,v]of b.structIterator()){const{eventHeader:O,eventPayload:H}=v.getMergedTraits();if(C=C||!!(O||H),H)v.isBlobSchema()?x[R]=y:v.isStringSchema()?x[R]=(((w=this.serdeContext)==null?void 0:w.utf8Encoder)??Be)(y):v.isStructSchema()&&(x[R]=await this.deserializer.read(v,y));else if(O){const Z=(S=h[m].headers[R])==null?void 0:S.value;Z!=null&&(v.isNumericSchema()?Z&&typeof Z=="object"&&"bytes"in Z?x[R]=BigInt(Z.toString()):x[R]=Number(Z):x[R]=Z)}}if(C)return{[m]:x}}return{[m]:await this.deserializer.read(b,y)}}else return{$unknown:h}}),l=u[Symbol.asyncIterator](),d=await l.next();if(d.done)return u;if((f=d.value)!=null&&f[c]){if(!r)throw new Error("@smithy::core/protocols - initial-response event encountered in event stream but no response schema given.");for(const[h,m]of Object.entries(d.value))s[h]=m}return{async*[Symbol.asyncIterator](){var h;for((h=d==null?void 0:d.value)!=null&&h[c]||(yield d.value);;){const{done:m,value:y}=await l.next();if(m)break;yield y}}}}writeEventBody(t,r,s){var f;const n=this.serializer;let i=t,o=null,a;const c=r.getSchema()[4].includes(t),u={};if(c){const h=r.getMemberSchema(t);if(h.isStructSchema()){for(const[m,y]of h.structIterator()){const{eventHeader:w,eventPayload:S}=y.getMergedTraits();if(S)o=m;else if(w){const b=s[t][m];let x="binary";y.isNumericSchema()?(-2)**31<=b&&b<=2**31-1?x="integer":x="long":y.isTimestampSchema()?x="timestamp":y.isStringSchema()?x="string":y.isBooleanSchema()&&(x="boolean"),b!=null&&(u[m]={type:x,value:b},delete s[t][m])}}if(o!==null){const m=h.getMemberSchema(o);m.isBlobSchema()?a="application/octet-stream":m.isStringSchema()&&(a="text/plain"),n.write(m,s[t][o])}else n.write(h,s[t])}else throw new Error("@smithy/core/event-streams - non-struct member not supported in event stream union.")}else{const[h,m]=s[t];i=h,n.write(15,m)}const l=n.flush();return{body:typeof l=="string"?(((f=this.serdeContext)==null?void 0:f.utf8Decoder)??we)(l):l,eventType:i,explicitPayloadContentType:a,additionalHeaders:u}}}const nd=Object.freeze(Object.defineProperty({__proto__:null,EventStreamSerde:sd},Symbol.toStringTag,{value:"Module"}));export{vs as default};
